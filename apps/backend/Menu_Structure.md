这是一个非常关键的**“商业变现”**环节设计。你之前的表结构解决了“卖什么（商品）”和“多少钱（价格）”的问题，但确实遗漏了**“分给谁多少钱（分佣）”**的配置。

在 SaaS + 分销体系中，**分佣比例的设置通常跟随 SKU（规格）走**，并且分为 **“总部指导”** 和 **“门店执行”** 两个层面。

下面我将从**菜单设计**、**分佣字段扩展**、**前后端开发流程**三个维度为你提供详细方案。

---

### 🟢 第一部分：前端菜单结构设计 (Menu Structure)

由于你的系统分为 **总公司平台端 (Platform Admin)** 和 **分公司/租户端 (Tenant Admin)**，菜单是完全隔离的。

#### 1. 总公司平台端 (Platform Admin)

**目标**：管理标准库，定义行业规范，设置指导分佣价。

| 菜单路径 (Route Path)         | 菜单名称 (Menu Name) | 页面功能描述                            | 对应数据表         |
|:------------------------- |:---------------- |:--------------------------------- |:------------- |
| `/pms`                    | **商品中心**         | 顶级目录                              | -             |
| ├── `/pms/category`       | **类目管理**         | 维护分类树，绑定实物/服务类型，配置规格模板            | `PmsCategory` |
| ├── `/pms/brand`          | **品牌管理**         | 维护品牌库 (雅马哈、戴森等)                   | `PmsBrand`    |
| ├── `/pms/global-product` | **标准商品库**        | **核心**。发布 Global SPU，设置**默认分佣比例** | `PmsProduct`  |
| └── `/pms/attribute`      | **参数规格模板**       | (可选) 管理通用的规格库                     | -             |

#### 2. 分公司/租户端 (Tenant Admin)

**目标**：选品上架，修改售价，设置**实际分佣比例**，管理库存。

| 菜单路径 (Route Path)           | 菜单名称 (Menu Name) | 页面功能描述                  | 对应数据表                    |
|:--------------------------- |:---------------- |:----------------------- |:------------------------ |
| `/store`                    | **门店经营**         | 顶级目录                    | -                        |
| ├── `/store/product/market` | **选品中心**         | 展示总部发布的商品，点击“上架/导入”     | `PmsProduct` (Read Only) |
| ├── `/store/product/list`   | **我的商品**         | 管理已上架商品，**改价、改分佣、改库存**  | `PmsTenantProduct`       |
| ├── `/store/stock`          | **库存管理**         | (实物)入库出库 / (服务)排班设置     | `PmsTenantSku`           |
| └── `/store/marketing`      | **营销活动**         | 拼团秒杀配置 (这是玩法的入口，不是基础分佣) | `MktPromotion`           |

---

### 🟡 第二部分：数据库字段整改 (Schema Update)

**核心问题**：分佣比例在哪里设置？
**答案**：**必须沉淀在 SKU 级别**。

* 因为不同的规格利润不同（例如：吉他单琴利润薄，大礼包利润厚），所以不能只在商品主图设置一个比例。
* 需要支持 **“比例分佣”** 和 **“固定金额分佣”** 两种模式。

请将以下更新同步到 `schema.prisma`：

#### 1. 新增枚举：分佣模式

```prisma
enum DistributionMode {
  RATIO   // 按比例 (如: 销售额的 10%)
  FIXED   // 按固定金额 (如: 每单固定分 10 元)
  NONE    // 不参与分销 (如: 特价引流品)
}
```

#### 2. 修改 `PmsGlobalSku` (总部建议配置)

总部给出的只是一个“建议值”或“底线”。

```prisma
model PmsGlobalSku {
  // ... 原有字段 ...

  // --- [新增] 总部指导分佣配置 ---
  distMode  DistributionMode @default(RATIO) @map("dist_mode")

  // 指导比例 (0.10 代表 10%) 或 指导金额 (10.00元)
  guideRate Decimal          @default(0.00) @db.Decimal(10, 2) @map("guide_rate") 
}
```

#### 3. 修改 `PmsTenantSku` (门店实际配置)

**这是计算佣金时真正读取的字段！**

```prisma
model PmsTenantSku {
  // ... 原有字段 ...

  // --- [新增] 门店实际分佣配置 ---
  // 门店有权修改这个比例 (通常不能低于总部设定的底线，后端可做校验)
  distMode  DistributionMode @default(RATIO) @map("dist_mode")

  // 实际执行比例 (例如总部建议 10%，门店想多推销，设为 15%)
  distRate  Decimal          @default(0.00) @db.Decimal(10, 2) @map("dist_rate") 
}
```

---

### 🔵 第三部分：详细开发方案 (前后端 + 产品视角)

我们以 **“上架商品并设置分佣”** 为主线，拆解三个阶段的交互。

#### 阶段一：总部发布标准商品 (Global)

**🕵️ 产品视角**：

> “总部在录入商品时，不仅要定指导价，还要定一个**‘默认分佣策略’**。这样分公司上架时不用每个都手填，直接继承，除非他想改。”

**💻 前端视角 (Vue3 + NaiveUI)**：

1. **SKU 表格组件**：在原有的“价格”、“规格”列后面，新增两列：
   * **分销模式**：下拉框 (按比例 / 固定金额 / 不分销)。
   * **指导分佣值**：输入框 (输入 10 代表 10% 或 10元)。
2. **批量填充**：提供“一键设置所有 SKU 分佣比例”的功能，方便操作。

**⚙️ 后端视角 (NestJS)**：

* 接收 DTO 时，校验 `guideRate` 不能超过 100% (如果是比例模式)。
* 将数据存入 `PmsGlobalSku`。

---

#### 阶段二：分公司选品与定价 (Tenant Import)

**这是设置分佣比例最关键的时刻！**

**🕵️ 产品视角**：

> “我是店长，我从商品库导入了‘吉他’。
> 
> 1. 我要把价格从 999 改成 1099（因为我这租金贵）。
> 2. 系统默认分佣是 10%，我觉得这利润够，就保持 10% 不动。
> 3. 或者，为了刺激分销员推这款琴，我把分佣手动改成 15%。”

**💻 前端视角 (Vue3)**：

* **交互界面**：**“上架编辑弹窗”**。
* **数据回显**：
  * 读取 `GlobalSku` 的 `guidePrice` (999) 和 `guideRate` (10%)。
  * 默认填入到输入框中。
* **用户操作**：
  * 店长修改 `price` 输入框为 1099。
  * 店长修改 `distRate` 输入框为 15 (即 15%)。
  * 前端实时计算预估佣金展示：`1099 * 15% ≈ 164.85元` (给店长一个心理预期)。

**⚙️ 后端视角 (NestJS)**：

* **API**: `POST /store/product/import`
* **逻辑**：
  * 保存数据到 `PmsTenantSku`。
  * **风控校验**：检查 `(price - cost) > (price * distRate)`。即：**卖价减去成本，必须大于佣金支出**，否则系统报错提示“亏本设置”，防止店长手滑填错。

---

#### 阶段三：下单与结算 (Calculation)

**🕵️ 产品视角**：

> “分销员小王卖出这把吉他，成交价 1099。系统要按店长设置的 15% 给他算钱。”

**⚙️ 后端视角 (Order Service)**：
当订单支付成功触发结算时：

```typescript
// 伪代码逻辑
async calculateCommission(orderItem) {
  // 1. 找到对应的门店SKU配置
  const tenantSku = await prisma.pmsTenantSku.findUnique({
    where: { id: orderItem.skuId }
  });

  let commission = 0;

  // 2. 判断模式
  if (tenantSku.distMode === 'RATIO') {
    // 比例模式: 实付金额 * 比例 (如 1099 * 0.15)
    commission = orderItem.payAmount * tenantSku.distRate;
  } 
  else if (tenantSku.distMode === 'FIXED') {
    // 固定金额模式: 直接给 10 块
    commission = tenantSku.distRate; 
  }

  // 3. 写入流水表 DistributionRecord
  return commission;
}
```

### 🟣 总结

1. **菜单名**：平台端叫 **“标准商品库”**，租户端叫 **“我的商品”** 或 **“选品中心”**。
2. **设置时机**：
   * **初次定义**：在总部发布商品时（设置默认值）。
   * **最终决定**：在租户**上架/编辑**商品时（设置执行值）。
3. **新增字段**：`distMode` (模式) 和 `distRate` (数值)，必须加在 SKU 表上，不能加在 Product 表上（因为不同规格利润不同）。
4. **开发重点**：前端要在上架弹窗里把这个账算清楚给店长看；后端要做亏本校验。
