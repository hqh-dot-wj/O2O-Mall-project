# å¹³å°æŠ½æˆä¸å¤šç§Ÿæˆ·æ¶æ„è¯´æ˜

## ğŸ“‹ ç›®å½•
1. [å¹³å°æŠ½æˆæ¦‚å¿µ](#å¹³å°æŠ½æˆæ¦‚å¿µ)
2. [è¶…çº§ç®¡ç†å‘˜ç§Ÿæˆ· vs æ™®é€šç§Ÿæˆ·](#è¶…çº§ç®¡ç†å‘˜ç§Ÿæˆ·-vs-æ™®é€šç§Ÿæˆ·)
3. [èµ„é‡‘æµå‘](#èµ„é‡‘æµå‘)
4. [ä¸‰ç§ä¸šåŠ¡æ¨¡å¼](#ä¸‰ç§ä¸šåŠ¡æ¨¡å¼)
5. [å®ç°å»ºè®®](#å®ç°å»ºè®®)

---

## ğŸ’° å¹³å°æŠ½æˆæ¦‚å¿µ

### ä»€ä¹ˆæ˜¯å¹³å°æŠ½æˆï¼Ÿ

å¹³å°æŠ½æˆæ˜¯æŒ‡**å¹³å°æ–¹ï¼ˆç³»ç»Ÿè¿è¥å•†ï¼‰ä»æ¯ç¬”äº¤æ˜“ä¸­æ”¶å–çš„æœåŠ¡è´¹**ã€‚

### å½“å‰ç³»ç»Ÿä¸­çš„è§’è‰²

åœ¨ä½ çš„å¤šç§Ÿæˆ·SaaSç³»ç»Ÿä¸­ï¼š

| è§’è‰² | ç§Ÿæˆ·ID | è¯´æ˜ |
|------|--------|------|
| **å¹³å°æ–¹** | `000000` | è¶…çº§ç®¡ç†å‘˜ç§Ÿæˆ·ï¼Œç³»ç»Ÿè¿è¥å•† |
| **é—¨åº—/å•†å®¶** | `100001`, `100002`... | æ™®é€šç§Ÿæˆ·ï¼Œä½¿ç”¨ç³»ç»Ÿçš„å•†å®¶ |
| **æ¶ˆè´¹è€…** | - | Cç«¯ç”¨æˆ·ï¼Œåœ¨é—¨åº—æ¶ˆè´¹ |

### èµ„é‡‘æµå‘ç¤ºä¾‹

```
æ¶ˆè´¹è€…æ”¯ä»˜ Â¥100
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è®¢å•æ€»æ”¶å…¥ Â¥100                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”œâ”€ å¹³å°æŠ½æˆï¼ˆ5%ï¼‰ï¼šÂ¥5          â”‚  â†’ å¹³å°æ–¹ï¼ˆç§Ÿæˆ·000000ï¼‰
â”‚  â””â”€ é—¨åº—æ”¶å…¥ï¼ˆ95%ï¼‰ï¼šÂ¥95        â”‚  â†’ é—¨åº—ï¼ˆç§Ÿæˆ·100001ï¼‰
â”‚     â”œâ”€ åˆ†ä½£æ”¯å‡ºï¼šÂ¥10            â”‚  â†’ æ¨èäºº
â”‚     â””â”€ é—¨åº—å‡€åˆ©æ¶¦ï¼šÂ¥85          â”‚  â†’ é—¨åº—æœ€ç»ˆæ”¶å…¥
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¢ è¶…çº§ç®¡ç†å‘˜ç§Ÿæˆ· vs æ™®é€šç§Ÿæˆ·

### è¶…çº§ç®¡ç†å‘˜ç§Ÿæˆ·ï¼ˆ`000000`ï¼‰

**å®šä¹‰ä½ç½®ï¼š** `apps/backend/src/common/tenant/tenant.context.ts`
```typescript
static readonly SUPER_TENANT_ID = '000000';
```

**ç‰¹æƒï¼š**
1. âœ… å¯ä»¥æŸ¥çœ‹æ‰€æœ‰ç§Ÿæˆ·çš„æ•°æ®
2. âœ… å¯ä»¥ç®¡ç†æ‰€æœ‰ç§Ÿæˆ·
3. âœ… å¯ä»¥åˆ‡æ¢åˆ°ä»»æ„ç§Ÿæˆ·è§†è§’
4. âœ… ä¸å—ç§Ÿæˆ·éš”ç¦»é™åˆ¶
5. âœ… å¯ä»¥é…ç½®å…¨å±€ç³»ç»Ÿå‚æ•°

**ç”¨é€”ï¼š**
- ç³»ç»Ÿè¿è¥å•†
- å¹³å°ç®¡ç†å‘˜
- æ•°æ®åˆ†æå’Œç›‘æ§
- å…¨å±€é…ç½®ç®¡ç†

**æ”¶å…¥æ¥æºï¼š**
- ç§Ÿæˆ·è®¢é˜…è´¹ï¼ˆæœˆè´¹/å¹´è´¹ï¼‰
- äº¤æ˜“æŠ½æˆï¼ˆå¦‚æœå¯ç”¨ï¼‰
- å¢å€¼æœåŠ¡è´¹

### æ™®é€šç§Ÿæˆ·ï¼ˆ`100001`, `100002`...ï¼‰

**ç‰¹ç‚¹ï¼š**
1. âŒ åªèƒ½æŸ¥çœ‹è‡ªå·±çš„æ•°æ®
2. âŒ ä¸èƒ½è®¿é—®å…¶ä»–ç§Ÿæˆ·æ•°æ®
3. âœ… æ•°æ®å®Œå…¨éš”ç¦»
4. âœ… ç‹¬ç«‹çš„ç”¨æˆ·ä½“ç³»
5. âœ… ç‹¬ç«‹çš„å•†å“å’Œè®¢å•

**ç”¨é€”ï¼š**
- é—¨åº—/å•†å®¶
- ç‹¬ç«‹è¿è¥
- æœåŠ¡è‡ªå·±çš„å®¢æˆ·

**æ”¶å…¥æ¥æºï¼š**
- è®¢å•æ”¶å…¥ï¼ˆæ‰£é™¤å¹³å°æŠ½æˆåï¼‰
- ä¼šå‘˜è´¹
- å¢å€¼æœåŠ¡

---

## ğŸ’¸ èµ„é‡‘æµå‘

### å®Œæ•´çš„èµ„é‡‘æµå‘å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ¶ˆè´¹è€…æ”¯ä»˜ Â¥4,030                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    è®¢å•æ€»æ”¶å…¥ Â¥4,030                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  ç¬¬ä¸€å±‚åˆ†é…ï¼šå¹³å° vs é—¨åº—                                    â”‚
â”‚  â”œâ”€ å¹³å°æŠ½æˆï¼ˆ10%ï¼‰ï¼šÂ¥403                                    â”‚
â”‚  â”‚  â””â”€ è¿›å…¥å¹³å°è´¦æˆ·ï¼ˆç§Ÿæˆ·000000ï¼‰                           â”‚
â”‚  â”‚                                                            â”‚
â”‚  â””â”€ é—¨åº—æ¯›æ”¶å…¥ï¼ˆ90%ï¼‰ï¼šÂ¥3,627                               â”‚
â”‚     â””â”€ è¿›å…¥é—¨åº—è´¦æˆ·ï¼ˆç§Ÿæˆ·100001ï¼‰                           â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              é—¨åº—æ”¶å…¥çš„äºŒæ¬¡åˆ†é… Â¥3,627                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  ç¬¬äºŒå±‚åˆ†é…ï¼šåˆ†ä½£ vs é—¨åº—å‡€åˆ©æ¶¦                              â”‚
â”‚  â”œâ”€ åˆ†ä½£æ”¯å‡ºï¼šÂ¥442                                           â”‚
â”‚  â”‚  â”œâ”€ å¼ ä¸‰ï¼ˆä¸€çº§+äºŒçº§ï¼‰ï¼šÂ¥238                              â”‚
â”‚  â”‚  â”œâ”€ æå››ï¼ˆä¸€çº§ï¼‰ï¼šÂ¥136                                   â”‚
â”‚  â”‚  â””â”€ ç‹äº”ï¼ˆä¸€çº§ï¼‰ï¼šÂ¥68                                    â”‚
â”‚  â”‚                                                            â”‚
â”‚  â””â”€ é—¨åº—å‡€åˆ©æ¶¦ï¼šÂ¥3,185                                       â”‚
â”‚     â””â”€ é—¨åº—æœ€ç»ˆæ”¶å…¥                                          â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å„æ–¹æ”¶å…¥æ±‡æ€»

| è§’è‰² | æ”¶å…¥ | å æ¯” | è¯´æ˜ |
|------|------|------|------|
| **å¹³å°æ–¹ï¼ˆ000000ï¼‰** | Â¥403 | 10% | å¹³å°æŠ½æˆ |
| **é—¨åº—ï¼ˆ100001ï¼‰** | Â¥3,185 | 79% | æ‰£é™¤åˆ†ä½£åçš„å‡€åˆ©æ¶¦ |
| **æ¨èäººï¼ˆå¼ ä¸‰ï¼‰** | Â¥238 | 5.9% | ä¸€çº§+äºŒçº§åˆ†ä½£ |
| **æ¨èäººï¼ˆæå››ï¼‰** | Â¥136 | 3.4% | ä¸€çº§åˆ†ä½£ |
| **æ¨èäººï¼ˆç‹äº”ï¼‰** | Â¥68 | 1.7% | ä¸€çº§åˆ†ä½£ |
| **æ€»è®¡** | Â¥4,030 | 100% | - |

---

## ğŸ¯ ä¸‰ç§ä¸šåŠ¡æ¨¡å¼

### æ¨¡å¼1ï¼šçº¯SaaSå·¥å…·ï¼ˆæ¨èï¼‰

**ç‰¹ç‚¹ï¼š**
- âŒ æ— äº¤æ˜“æŠ½æˆ
- âœ… è®¢é˜…è´¹æ”¶å…¥
- âœ… é—¨åº—è·å¾—100%è®¢å•æ”¶å…¥

**æ”¶å…¥æ¨¡å‹ï¼š**
```
å¹³å°æ”¶å…¥ = ç§Ÿæˆ·æ•° Ã— è®¢é˜…è´¹
é—¨åº—æ”¶å…¥ = è®¢å•æ”¶å…¥ - åˆ†ä½£æ”¯å‡º
```

**ä¼˜ç‚¹ï¼š**
- é—¨åº—åˆ©æ¶¦æœ€å¤§åŒ–
- å¸å¼•æ›´å¤šå•†å®¶å…¥é©»
- å•†å®¶æ»¡æ„åº¦é«˜

**ç¼ºç‚¹ï¼š**
- å¹³å°æ”¶å…¥ä¾èµ–è®¢é˜…
- éœ€è¦æŒç»­æä¾›ä»·å€¼

**é€‚ç”¨åœºæ™¯ï¼š**
- å·¥å…·å‹SaaS
- ä¼ä¸šæœåŠ¡
- ç§åŸŸæµé‡è¿è¥

**ä¾‹å­ï¼š**
- Shopifyï¼ˆåŸºç¡€ç‰ˆï¼‰
- æœ‰èµï¼ˆæ ‡å‡†ç‰ˆï¼‰
- å¾®ç›Ÿ

---

### æ¨¡å¼2ï¼šSaaS + äº¤æ˜“æŠ½æˆï¼ˆæ··åˆï¼‰

**ç‰¹ç‚¹ï¼š**
- âœ… ä½æ¯”ä¾‹æŠ½æˆï¼ˆ3-10%ï¼‰
- âœ… è®¢é˜…è´¹ + äº¤æ˜“æŠ½æˆ
- âœ… åŒé‡æ”¶å…¥æ¥æº

**æ”¶å…¥æ¨¡å‹ï¼š**
```
å¹³å°æ”¶å…¥ = (ç§Ÿæˆ·æ•° Ã— è®¢é˜…è´¹) + (æ€»äº¤æ˜“é¢ Ã— æŠ½æˆæ¯”ä¾‹)
é—¨åº—æ”¶å…¥ = (è®¢å•æ”¶å…¥ Ã— (1 - æŠ½æˆæ¯”ä¾‹)) - åˆ†ä½£æ”¯å‡º
```

**ä¼˜ç‚¹ï¼š**
- å¹³å°æ”¶å…¥æ›´ç¨³å®š
- ä¸å•†å®¶å…±åŒæˆé•¿
- æ¿€åŠ±å¹³å°æä¾›æ›´å¥½æœåŠ¡

**ç¼ºç‚¹ï¼š**
- éœ€è¦æä¾›æ”¯ä»˜é€šé“
- èµ„é‡‘ç»“ç®—å¤æ‚
- éœ€è¦è´¢åŠ¡åˆè§„

**é€‚ç”¨åœºæ™¯ï¼š**
- äº¤æ˜“å‹SaaS
- ç”µå•†å¹³å°
- æœ¬åœ°ç”Ÿæ´»æœåŠ¡

**ä¾‹å­ï¼š**
- ç¾å›¢ï¼ˆ3-5%ï¼‰
- é¥¿äº†ä¹ˆï¼ˆ5-8%ï¼‰
- å¾®ä¿¡æ”¯ä»˜ï¼ˆ0.6%ï¼‰

---

### æ¨¡å¼3ï¼šçº¯å¹³å°æ¨¡å¼

**ç‰¹ç‚¹ï¼š**
- âœ… é«˜æ¯”ä¾‹æŠ½æˆï¼ˆ20-30%ï¼‰
- âŒ æ— è®¢é˜…è´¹æˆ–ä½è®¢é˜…è´¹
- âœ… æä¾›æµé‡å’Œç”¨æˆ·

**æ”¶å…¥æ¨¡å‹ï¼š**
```
å¹³å°æ”¶å…¥ = æ€»äº¤æ˜“é¢ Ã— æŠ½æˆæ¯”ä¾‹
é—¨åº—æ”¶å…¥ = (è®¢å•æ”¶å…¥ Ã— (1 - æŠ½æˆæ¯”ä¾‹)) - åˆ†ä½£æ”¯å‡º
```

**ä¼˜ç‚¹ï¼š**
- å¹³å°æ”¶å…¥ä¸GMVç›´æ¥æŒ‚é’©
- æ¿€åŠ±å¹³å°å¸¦æ¥æ›´å¤šæµé‡
- è§„æ¨¡æ•ˆåº”æ˜æ˜¾

**ç¼ºç‚¹ï¼š**
- å•†å®¶åˆ©æ¶¦å‹åŠ›å¤§
- éœ€è¦å¼ºå¤§çš„æµé‡èƒ½åŠ›
- ç«äº‰æ¿€çƒˆ

**é€‚ç”¨åœºæ™¯ï¼š**
- ç”µå•†å¹³å°
- å¤–å–å¹³å°
- åˆ°åº—æœåŠ¡å¹³å°

**ä¾‹å­ï¼š**
- æ·˜å®ï¼ˆ5-10%ï¼‰
- äº¬ä¸œï¼ˆ8-15%ï¼‰
- æŠ–éŸ³å°åº—ï¼ˆ2-10%ï¼‰

---

## ğŸ› ï¸ å®ç°å»ºè®®

### 1. é…ç½®åŒ–æŠ½æˆæ¯”ä¾‹

åœ¨ `SysTenant` è¡¨ä¸­æ·»åŠ å­—æ®µï¼š

```prisma
model SysTenant {
  // ... ç°æœ‰å­—æ®µ
  
  // å¹³å°æŠ½æˆé…ç½®
  commissionRate  Decimal @default(0.00) @map("commission_rate") @db.Decimal(5, 2) // æŠ½æˆæ¯”ä¾‹ï¼ˆ%ï¼‰
  commissionMode  String  @default("NONE") @map("commission_mode") // NONE, FIXED, TIERED
  
  // ç»“ç®—é…ç½®
  settlementCycle Int     @default(7) @map("settlement_cycle") // ç»“ç®—å‘¨æœŸï¼ˆå¤©ï¼‰
  minWithdraw     Decimal @default(100.00) @map("min_withdraw") @db.Decimal(10, 2) // æœ€ä½æç°é‡‘é¢
}
```

### 2. åˆ›å»ºå¹³å°æ”¶å…¥è¡¨

```prisma
model FinPlatformIncome {
  id          BigInt   @id @default(autoincrement())
  orderId     String   @map("order_id")
  tenantId    String   @map("tenant_id") // æ¥æºç§Ÿæˆ·
  
  orderAmount Decimal  @db.Decimal(10, 2) // è®¢å•é‡‘é¢
  rate        Decimal  @db.Decimal(5, 2)  // æŠ½æˆæ¯”ä¾‹
  amount      Decimal  @db.Decimal(10, 2) // æŠ½æˆé‡‘é¢
  
  status      String   @default("PENDING") // PENDING, SETTLED
  settleTime  DateTime? @map("settle_time")
  
  createTime  DateTime @default(now()) @map("create_time")
  
  @@index([tenantId, status])
  @@map("fin_platform_income")
}
```

### 3. è®¢å•åˆ›å»ºæ—¶è®¡ç®—æŠ½æˆ

```typescript
async function createOrder(orderData: CreateOrderDto) {
  // 1. è·å–ç§Ÿæˆ·æŠ½æˆé…ç½®
  const tenant = await prisma.sysTenant.findUnique({
    where: { tenantId: orderData.tenantId }
  });
  
  const commissionRate = Number(tenant.commissionRate) / 100;
  
  // 2. è®¡ç®—é‡‘é¢åˆ†é…
  const orderAmount = orderData.totalAmount;
  const platformCommission = orderAmount * commissionRate;
  const storeRevenue = orderAmount - platformCommission;
  
  // 3. åˆ›å»ºè®¢å•
  const order = await prisma.omsOrder.create({
    data: {
      ...orderData,
      platformCommission, // æ–°å¢å­—æ®µ
      storeRevenue,       // æ–°å¢å­—æ®µ
    }
  });
  
  // 4. å¦‚æœæœ‰æŠ½æˆï¼Œåˆ›å»ºå¹³å°æ”¶å…¥è®°å½•
  if (platformCommission > 0) {
    await prisma.finPlatformIncome.create({
      data: {
        orderId: order.id,
        tenantId: orderData.tenantId,
        orderAmount,
        rate: tenant.commissionRate,
        amount: platformCommission,
        status: 'PENDING',
      }
    });
  }
  
  return order;
}
```

### 4. ç»“ç®—æµç¨‹

```typescript
// å®šæ—¶ä»»åŠ¡ï¼šæ¯å¤©ç»“ç®—
async function settlePlatformIncome() {
  const pendingIncomes = await prisma.finPlatformIncome.findMany({
    where: {
      status: 'PENDING',
      createTime: {
        lte: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000) // 7å¤©å‰
      }
    }
  });
  
  for (const income of pendingIncomes) {
    await prisma.finPlatformIncome.update({
      where: { id: income.id },
      data: {
        status: 'SETTLED',
        settleTime: new Date(),
      }
    });
  }
}
```

---

## ğŸ“Š æ•°æ®æŸ¥è¯¢ç¤ºä¾‹

### æŸ¥è¯¢å¹³å°æ€»æ”¶å…¥

```typescript
// è¶…çº§ç®¡ç†å‘˜ï¼ˆ000000ï¼‰æŸ¥è¯¢æ‰€æœ‰ç§Ÿæˆ·çš„å¹³å°æ”¶å…¥
const platformIncome = await prisma.finPlatformIncome.aggregate({
  _sum: {
    amount: true,
  },
  where: {
    status: 'SETTLED',
    createTime: {
      gte: startDate,
      lte: endDate,
    }
  }
});

console.log(`å¹³å°æ€»æ”¶å…¥ï¼šÂ¥${platformIncome._sum.amount}`);
```

### æŸ¥è¯¢é—¨åº—å‡€æ”¶å…¥

```typescript
// æ™®é€šç§Ÿæˆ·ï¼ˆ100001ï¼‰æŸ¥è¯¢è‡ªå·±çš„å‡€æ”¶å…¥
const storeIncome = await prisma.omsOrder.aggregate({
  _sum: {
    storeRevenue: true, // æ‰£é™¤å¹³å°æŠ½æˆåçš„æ”¶å…¥
  },
  where: {
    tenantId: '100001',
    payStatus: 'PAID',
    createTime: {
      gte: startDate,
      lte: endDate,
    }
  }
});

// å‡å»åˆ†ä½£æ”¯å‡º
const commissions = await prisma.finCommission.aggregate({
  _sum: {
    amount: true,
  },
  where: {
    tenantId: '100001',
    status: 'SETTLED',
  }
});

const netIncome = Number(storeIncome._sum.storeRevenue) - Number(commissions._sum.amount);
console.log(`é—¨åº—å‡€æ”¶å…¥ï¼šÂ¥${netIncome}`);
```

---

## ğŸ¯ æ¨èæ–¹æ¡ˆ

æ ¹æ®ä½ çš„ç³»ç»Ÿç‰¹ç‚¹ï¼Œæˆ‘æ¨èï¼š

### é˜¶æ®µ1ï¼šçº¯SaaSæ¨¡å¼ï¼ˆå½“å‰ï¼‰
- âŒ æš‚ä¸å¯ç”¨å¹³å°æŠ½æˆ
- âœ… ä¸“æ³¨äºåŠŸèƒ½å®Œå–„
- âœ… å¸å¼•å•†å®¶å…¥é©»
- âœ… ç§¯ç´¯ç”¨æˆ·å’Œæ•°æ®

### é˜¶æ®µ2ï¼šæ··åˆæ¨¡å¼ï¼ˆæˆç†Ÿåï¼‰
- âœ… å¯ç”¨ä½æ¯”ä¾‹æŠ½æˆï¼ˆ3-5%ï¼‰
- âœ… æä¾›æ”¯ä»˜é€šé“
- âœ… æä¾›è¥é”€å·¥å…·
- âœ… æä¾›æ•°æ®åˆ†æ

### é˜¶æ®µ3ï¼šå¹³å°æ¨¡å¼ï¼ˆè§„æ¨¡åŒ–ï¼‰
- âœ… æ ¹æ®GMVè°ƒæ•´æŠ½æˆ
- âœ… æä¾›æµé‡æ”¯æŒ
- âœ… å»ºç«‹ç”Ÿæ€ä½“ç³»

---

## ğŸ“ æ€»ç»“

1. **å¹³å°æŠ½æˆ** = å¹³å°æ–¹ä»æ¯ç¬”äº¤æ˜“ä¸­æ”¶å–çš„æœåŠ¡è´¹
2. **è¶…çº§ç®¡ç†å‘˜ç§Ÿæˆ·ï¼ˆ000000ï¼‰** = å¹³å°æ–¹ï¼Œå¯ä»¥æŸ¥çœ‹æ‰€æœ‰æ•°æ®
3. **æ™®é€šç§Ÿæˆ·ï¼ˆ100001...ï¼‰** = é—¨åº—/å•†å®¶ï¼Œæ•°æ®éš”ç¦»
4. **èµ„é‡‘æµå‘**ï¼šæ¶ˆè´¹è€… â†’ å¹³å°æŠ½æˆ + é—¨åº—æ”¶å…¥ â†’ åˆ†ä½£ + é—¨åº—å‡€åˆ©æ¶¦
5. **å»ºè®®**ï¼šä»çº¯SaaSæ¨¡å¼å¼€å§‹ï¼Œé€æ­¥è¿‡æ¸¡åˆ°æ··åˆæ¨¡å¼

---

## ç›¸å…³æ–‡æ¡£

- [ç«¯åˆ°ç«¯æµ‹è¯•æŒ‡å—](./E2E_TEST_GUIDE.md)
- [åˆ†ä½£é…ç½®è¯´æ˜](./COMMISSION_CONFIG.md)
- [å¤šç§Ÿæˆ·æ¶æ„](./MULTI_TENANT_ARCHITECTURE.md)
