# ä¼˜æƒ åˆ¸å’Œç§¯åˆ†ç³»ç»Ÿå®ç°æ€»ç»“

## ğŸ“‹ å®ç°æ¦‚è¿°

æœ¬æ–‡æ¡£æ€»ç»“äº†ä¼˜æƒ åˆ¸å’Œç§¯åˆ†ç³»ç»Ÿçš„å®Œæ•´å®ç°ï¼ŒåŒ…æ‹¬æ•°æ®åº“è®¾è®¡ã€æ¨¡å—ç»“æ„ã€API æ¥å£å’Œæ ¸å¿ƒåŠŸèƒ½ã€‚

**å®ç°è¿›åº¦**: æ ¸å¿ƒåŠŸèƒ½å·²å…¨éƒ¨å®Œæˆ âœ…

- âœ… Task 1: æ•°æ®åº“è®¾è®¡ï¼ˆ8å¼ è¡¨ï¼Œ10ä¸ªæšä¸¾ï¼Œ25ä¸ªç´¢å¼•ï¼‰
- âœ… Task 2-6: ä¼˜æƒ åˆ¸ç³»ç»Ÿï¼ˆæ¨¡æ¿ã€å‘æ”¾ã€ä½¿ç”¨ã€ç»Ÿè®¡ã€å®šæ—¶ä»»åŠ¡ï¼‰
- âœ… Task 7-11: ç§¯åˆ†ç³»ç»Ÿï¼ˆè§„åˆ™ã€è´¦æˆ·ã€ç­¾åˆ°ã€ä»»åŠ¡ã€ç»Ÿè®¡ã€å®šæ—¶ä»»åŠ¡ï¼‰
- âœ… Task 13: è®¢å•é›†æˆï¼ˆä¼˜æƒ è®¡ç®—ã€ç”Ÿå‘½å‘¨æœŸå¤„ç†ï¼‰
- âœ… Task 16: æ¨¡å—èšåˆï¼ˆCouponModuleã€PointsModuleã€MarketingModuleï¼‰

**å¾…å®Œæˆ**: æµ‹è¯•ã€ä¼˜åŒ–ã€æ–‡æ¡£ï¼ˆTasks 14-15, 17-20ï¼‰

## âœ… å·²å®ŒæˆåŠŸèƒ½

### 1. æ•°æ®åº“è®¾è®¡ï¼ˆTask 1ï¼‰âœ…

#### ä¼˜æƒ åˆ¸ç›¸å…³è¡¨ï¼ˆ4å¼ ï¼‰

- `mkt_coupon_template`: ä¼˜æƒ åˆ¸æ¨¡æ¿è¡¨
- `mkt_user_coupon`: ç”¨æˆ·ä¼˜æƒ åˆ¸è¡¨
- `mkt_coupon_usage`: ä¼˜æƒ åˆ¸ä½¿ç”¨è®°å½•è¡¨
- æ‰©å±• `oms_order`: è®¢å•è¡¨ï¼ˆæ–°å¢ä¼˜æƒ åˆ¸å’Œç§¯åˆ†å­—æ®µï¼‰

#### ç§¯åˆ†ç›¸å…³è¡¨ï¼ˆ4å¼ ï¼‰

- `mkt_points_rule`: ç§¯åˆ†è§„åˆ™é…ç½®è¡¨
- `mkt_points_account`: ç§¯åˆ†è´¦æˆ·è¡¨
- `mkt_points_transaction`: ç§¯åˆ†äº¤æ˜“è®°å½•è¡¨
- `mkt_points_task`: ç§¯åˆ†ä»»åŠ¡é…ç½®è¡¨
- `mkt_user_task_completion`: ç”¨æˆ·ä»»åŠ¡å®Œæˆè®°å½•è¡¨

#### æšä¸¾ç±»å‹ï¼ˆ10ä¸ªï¼‰

- `CouponType`: ä¼˜æƒ åˆ¸ç±»å‹ï¼ˆæ»¡å‡/æŠ˜æ‰£/å…‘æ¢ï¼‰
- `CouponStatus`: ä¼˜æƒ åˆ¸çŠ¶æ€
- `UserCouponStatus`: ç”¨æˆ·ä¼˜æƒ åˆ¸çŠ¶æ€
- `CouponValidityType`: æœ‰æ•ˆæœŸç±»å‹
- `CouponDistributionType`: å‘æ”¾ç±»å‹
- `PointsTransactionType`: ç§¯åˆ†äº¤æ˜“ç±»å‹
- `PointsTransactionStatus`: ç§¯åˆ†äº¤æ˜“çŠ¶æ€

### 2. ä¼˜æƒ åˆ¸ç³»ç»Ÿï¼ˆTasks 2-6ï¼‰âœ…

#### 2.1 ä¼˜æƒ åˆ¸æ¨¡æ¿æ¨¡å—

**æ–‡ä»¶ä½ç½®**: `apps/backend/src/module/marketing/coupon/template/`

**åŠŸèƒ½**:

- âœ… åˆ›å»ºä¼˜æƒ åˆ¸æ¨¡æ¿ï¼ˆæ”¯æŒæ»¡å‡/æŠ˜æ‰£/å…‘æ¢ä¸‰ç§ç±»å‹ï¼‰
- âœ… æ›´æ–°ä¼˜æƒ åˆ¸æ¨¡æ¿
- âœ… åœç”¨ä¼˜æƒ åˆ¸æ¨¡æ¿
- âœ… æŸ¥è¯¢æ¨¡æ¿åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰
- âœ… æŸ¥è¯¢æ¨¡æ¿è¯¦æƒ…ï¼ˆå«ç»Ÿè®¡ä¿¡æ¯ï¼‰
- âœ… æ¨¡æ¿é…ç½®éªŒè¯

**API æ¥å£**:

```
POST   /admin/marketing/coupon/templates      åˆ›å»ºæ¨¡æ¿
PUT    /admin/marketing/coupon/templates/:id  æ›´æ–°æ¨¡æ¿
DELETE /admin/marketing/coupon/templates/:id  åœç”¨æ¨¡æ¿
GET    /admin/marketing/coupon/templates      æŸ¥è¯¢åˆ—è¡¨
GET    /admin/marketing/coupon/templates/:id  æŸ¥è¯¢è¯¦æƒ…
```

#### 2.2 ä¼˜æƒ åˆ¸å‘æ”¾æ¨¡å—

**æ–‡ä»¶ä½ç½®**: `apps/backend/src/module/marketing/coupon/distribution/`

**åŠŸèƒ½**:

- âœ… æ‰‹åŠ¨å‘æ”¾ä¼˜æƒ åˆ¸ï¼ˆç®¡ç†å‘˜ï¼‰
- âœ… ç”¨æˆ·ä¸»åŠ¨é¢†å–ä¼˜æƒ åˆ¸
- âœ… è®¢å•èµ é€ä¼˜æƒ åˆ¸
- âœ… é¢†å–èµ„æ ¼æ£€æŸ¥
- âœ… åº“å­˜æ‰£å‡ï¼ˆä½¿ç”¨ Redis åˆ†å¸ƒå¼é”ï¼‰
- âœ… æœ‰æ•ˆæœŸè®¡ç®—

**API æ¥å£**:

```
POST /admin/marketing/coupon/distribute/manual  æ‰‹åŠ¨å‘æ”¾
POST /client/marketing/coupon/claim/:templateId ç”¨æˆ·é¢†å–
GET  /client/marketing/coupon/available         å¯ç”¨ä¼˜æƒ åˆ¸
```

**æŠ€æœ¯äº®ç‚¹**:

- ä½¿ç”¨ Redis åˆ†å¸ƒå¼é”é˜²æ­¢è¶…å‘
- ä½¿ç”¨äº‹åŠ¡ä¿è¯åº“å­˜æ‰£å‡çš„åŸå­æ€§
- æ”¯æŒé‡è¯•æœºåˆ¶ï¼ˆæœ€å¤š3æ¬¡ï¼‰

#### 2.3 ä¼˜æƒ åˆ¸ä½¿ç”¨æ¨¡å—

**æ–‡ä»¶ä½ç½®**: `apps/backend/src/module/marketing/coupon/usage/`

**åŠŸèƒ½**:

- âœ… æŸ¥è¯¢å¯ç”¨ä¼˜æƒ åˆ¸
- âœ… éªŒè¯ä¼˜æƒ åˆ¸
- âœ… è®¡ç®—ä¼˜æƒ é‡‘é¢ï¼ˆæ”¯æŒä¸‰ç§ç±»å‹ï¼‰
- âœ… é”å®šä¼˜æƒ åˆ¸ï¼ˆè®¢å•åˆ›å»ºï¼‰
- âœ… ä½¿ç”¨ä¼˜æƒ åˆ¸ï¼ˆè®¢å•æ”¯ä»˜ï¼‰
- âœ… è§£é”ä¼˜æƒ åˆ¸ï¼ˆè®¢å•å–æ¶ˆï¼‰
- âœ… é€€è¿˜ä¼˜æƒ åˆ¸ï¼ˆè®¢å•é€€æ¬¾ï¼‰

**ä¼˜æƒ è®¡ç®—é€»è¾‘**:

```typescript
// æ»¡å‡åˆ¸
discount = discountAmount;

// æŠ˜æ‰£åˆ¸
discount = (orderAmount * discountPercent) / 100;
discount = min(discount, maxDiscountAmount);

// å…‘æ¢åˆ¸
discount = orderAmount(å…¨é¢æŠµæ‰£);
```

#### 2.4 ä¼˜æƒ åˆ¸ç»Ÿè®¡å’Œç®¡ç†

**æ–‡ä»¶ä½ç½®**: `apps/backend/src/module/marketing/coupon/statistics/` å’Œ `management/`

**åŠŸèƒ½**:

- âœ… æŸ¥è¯¢ä½¿ç”¨è®°å½•
- âœ… ç»Ÿè®¡æ ¸é”€ç‡
- âœ… å¯¼å‡ºä½¿ç”¨è®°å½•
- âœ… å®šæ—¶æ¸…ç†è¿‡æœŸä¼˜æƒ åˆ¸ï¼ˆæ¯å¤©å‡Œæ™¨2ç‚¹ï¼‰

**API æ¥å£**:

```
GET /admin/marketing/coupon/user-coupons    ç”¨æˆ·ä¼˜æƒ åˆ¸åˆ—è¡¨
GET /admin/marketing/coupon/usage-records   ä½¿ç”¨è®°å½•
GET /admin/marketing/coupon/statistics      ç»Ÿè®¡æ•°æ®
GET /admin/marketing/coupon/export          å¯¼å‡ºè®°å½•
GET /client/marketing/coupon/my-coupons     æˆ‘çš„ä¼˜æƒ åˆ¸
```

### 3. ç§¯åˆ†ç³»ç»Ÿï¼ˆTasks 7-11ï¼‰âœ…

#### 3.1 ç§¯åˆ†è§„åˆ™æ¨¡å—

**æ–‡ä»¶ä½ç½®**: `apps/backend/src/module/marketing/points/rule/`

**åŠŸèƒ½**:

- âœ… è·å–ç§¯åˆ†è§„åˆ™é…ç½®
- âœ… æ›´æ–°ç§¯åˆ†è§„åˆ™é…ç½®
- âœ… è®¡ç®—æ¶ˆè´¹ç§¯åˆ†
- âœ… è®¡ç®—ç§¯åˆ†æŠµæ‰£é‡‘é¢
- âœ… éªŒè¯ç§¯åˆ†ä½¿ç”¨é™åˆ¶

**è§„åˆ™é…ç½®é¡¹**:

- æ¶ˆè´¹ç§¯åˆ†ï¼šæ¯æ¶ˆè´¹Nå…ƒè·å¾—Mç§¯åˆ†
- ç­¾åˆ°ç§¯åˆ†ï¼šæ¯æ—¥ç­¾åˆ°è·å¾—å›ºå®šç§¯åˆ†
- ç§¯åˆ†æœ‰æ•ˆæœŸï¼šæ”¯æŒæ°¸ä¹…æœ‰æ•ˆæˆ–æŒ‡å®šå¤©æ•°
- ç§¯åˆ†æŠµæ‰£ï¼šNç§¯åˆ†æŠµæ‰£Må…ƒ
- æŠµæ‰£é™åˆ¶ï¼šæœ€ä½ä½¿ç”¨ç§¯åˆ†ã€æœ€å¤§æŠµæ‰£æ¯”ä¾‹

**API æ¥å£**:

```
GET /admin/marketing/points/rules  è·å–è§„åˆ™
PUT /admin/marketing/points/rules  æ›´æ–°è§„åˆ™
```

#### 3.2 ç§¯åˆ†è´¦æˆ·æ¨¡å—

**æ–‡ä»¶ä½ç½®**: `apps/backend/src/module/marketing/points/account/`

**åŠŸèƒ½**:

- âœ… è·å–æˆ–åˆ›å»ºç§¯åˆ†è´¦æˆ·
- âœ… æŸ¥è¯¢ç§¯åˆ†ä½™é¢
- âœ… å¢åŠ ç§¯åˆ†
- âœ… æ‰£å‡ç§¯åˆ†ï¼ˆä½¿ç”¨ä¹è§‚é”ï¼‰
- âœ… å†»ç»“ç§¯åˆ†
- âœ… è§£å†»ç§¯åˆ†
- âœ… æŸ¥è¯¢ç§¯åˆ†æ˜ç»†
- âœ… æŸ¥è¯¢å³å°†è¿‡æœŸç§¯åˆ†

**è´¦æˆ·å­—æ®µ**:

- `totalPoints`: æ€»ç§¯åˆ†ï¼ˆç´¯è®¡è·å¾—ï¼‰
- `availablePoints`: å¯ç”¨ç§¯åˆ†
- `frozenPoints`: å†»ç»“ç§¯åˆ†
- `usedPoints`: å·²ä½¿ç”¨ç§¯åˆ†
- `expiredPoints`: å·²è¿‡æœŸç§¯åˆ†
- `version`: ç‰ˆæœ¬å·ï¼ˆä¹è§‚é”ï¼‰

**API æ¥å£**:

```
GET  /client/marketing/points/balance       æŸ¥è¯¢ä½™é¢
GET  /client/marketing/points/transactions  æŸ¥è¯¢æ˜ç»†
GET  /client/marketing/points/expiring      å³å°†è¿‡æœŸ
POST /admin/marketing/points/adjust         è°ƒæ•´ç§¯åˆ†
GET  /admin/marketing/points/accounts       è´¦æˆ·åˆ—è¡¨
GET  /admin/marketing/points/transactions   äº¤æ˜“è®°å½•
```

**æŠ€æœ¯äº®ç‚¹**:

- ä½¿ç”¨ä¹è§‚é”ï¼ˆversionå­—æ®µï¼‰é˜²æ­¢å¹¶å‘æ‰£å‡é—®é¢˜
- æ”¯æŒé‡è¯•æœºåˆ¶ï¼ˆæœ€å¤š3æ¬¡ï¼‰
- è¯¦ç»†çš„äº¤æ˜“è®°å½•ï¼ˆbalanceBefore/balanceAfterï¼‰

#### 3.3 ç§¯åˆ†ç­¾åˆ°æ¨¡å—

**æ–‡ä»¶ä½ç½®**: `apps/backend/src/module/marketing/points/signin/`

**åŠŸèƒ½**:

- âœ… ç”¨æˆ·ç­¾åˆ°
- âœ… æŸ¥è¯¢ç­¾åˆ°çŠ¶æ€
- âœ… è®¡ç®—è¿ç»­ç­¾åˆ°å¤©æ•°
- âœ… ç»Ÿè®¡æœ¬æœˆç­¾åˆ°å¤©æ•°

**API æ¥å£**:

```
POST /client/marketing/points/signin        ç­¾åˆ°
GET  /client/marketing/points/signin/status ç­¾åˆ°çŠ¶æ€
```

#### 3.4 ç§¯åˆ†ä»»åŠ¡æ¨¡å—

**æ–‡ä»¶ä½ç½®**: `apps/backend/src/module/marketing/points/task/`

**åŠŸèƒ½**:

- âœ… åˆ›å»ºç§¯åˆ†ä»»åŠ¡
- âœ… æ›´æ–°ç§¯åˆ†ä»»åŠ¡
- âœ… æŸ¥è¯¢ä»»åŠ¡åˆ—è¡¨
- âœ… åˆ é™¤ç§¯åˆ†ä»»åŠ¡
- âœ… å®Œæˆä»»åŠ¡å¹¶å‘æ”¾ç§¯åˆ†
- âœ… æ£€æŸ¥ä»»åŠ¡èµ„æ ¼
- âœ… æŸ¥è¯¢ç”¨æˆ·å®Œæˆè®°å½•

**ä»»åŠ¡é…ç½®é¡¹**:

- `taskKey`: ä»»åŠ¡æ ‡è¯†ï¼ˆå”¯ä¸€ï¼‰
- `taskName`: ä»»åŠ¡åç§°
- `taskDescription`: ä»»åŠ¡æè¿°
- `pointsReward`: ç§¯åˆ†å¥–åŠ±
- `completionCondition`: å®Œæˆæ¡ä»¶ï¼ˆJSONï¼‰
- `isRepeatable`: æ˜¯å¦å¯é‡å¤å®Œæˆ
- `maxCompletions`: æœ€å¤§å®Œæˆæ¬¡æ•°
- `isEnabled`: æ˜¯å¦å¯ç”¨

**API æ¥å£**:

```
POST   /admin/marketing/points/tasks                åˆ›å»ºä»»åŠ¡
PUT    /admin/marketing/points/tasks/:id            æ›´æ–°ä»»åŠ¡
GET    /admin/marketing/points/tasks                æŸ¥è¯¢åˆ—è¡¨
DELETE /admin/marketing/points/tasks/:id            åˆ é™¤ä»»åŠ¡
GET    /client/marketing/points/tasks               å¯ç”¨ä»»åŠ¡
POST   /client/marketing/points/tasks/:taskKey/complete  å®Œæˆä»»åŠ¡
GET    /client/marketing/points/tasks/my-completions     å®Œæˆè®°å½•
```

**ä¸šåŠ¡é€»è¾‘**:

- ä»»åŠ¡å®Œæˆæ—¶è‡ªåŠ¨å‘æ”¾ç§¯åˆ†
- æ”¯æŒä¸€æ¬¡æ€§ä»»åŠ¡å’Œå¯é‡å¤ä»»åŠ¡
- æ”¯æŒå®Œæˆæ¬¡æ•°é™åˆ¶
- è®°å½•å®Œæˆæ—¶é—´å’Œå¥–åŠ±ç§¯åˆ†

#### 3.5 ç§¯åˆ†ç»Ÿè®¡å’Œç®¡ç†

**æ–‡ä»¶ä½ç½®**: `apps/backend/src/module/marketing/points/statistics/` å’Œ `management/`

**åŠŸèƒ½**:

- âœ… ç§¯åˆ†å‘æ”¾ç»Ÿè®¡ï¼ˆæŒ‰ç±»å‹ï¼‰
- âœ… ç§¯åˆ†ä½¿ç”¨ç»Ÿè®¡ï¼ˆæŒ‰ç±»å‹ï¼‰
- âœ… ç§¯åˆ†ä½™é¢ç»Ÿè®¡
- âœ… ç§¯åˆ†è¿‡æœŸç»Ÿè®¡
- âœ… ç§¯åˆ†æ’è¡Œæ¦œ
- âœ… å¯¼å‡ºç§¯åˆ†æ˜ç»†
- âœ… å®šæ—¶å¤„ç†è¿‡æœŸç§¯åˆ†ï¼ˆæ¯å¤©å‡Œæ™¨2ç‚¹ï¼‰

**API æ¥å£**:

```
GET /admin/marketing/points/statistics/earn    å‘æ”¾ç»Ÿè®¡
GET /admin/marketing/points/statistics/use     ä½¿ç”¨ç»Ÿè®¡
GET /admin/marketing/points/statistics/balance ä½™é¢ç»Ÿè®¡
GET /admin/marketing/points/statistics/expire  è¿‡æœŸç»Ÿè®¡
GET /admin/marketing/points/ranking            æ’è¡Œæ¦œ
GET /admin/marketing/points/export             å¯¼å‡ºæ˜ç»†
```

### 4. è®¢å•é›†æˆæ¨¡å—ï¼ˆTask 13ï¼‰

**æ–‡ä»¶ä½ç½®**: `apps/backend/src/module/marketing/integration/`

**åŠŸèƒ½**:

- âœ… è®¡ç®—è®¢å•ä¼˜æƒ ï¼ˆä¼˜æƒ åˆ¸+ç§¯åˆ†ï¼‰
- âœ… è®¢å•åˆ›å»ºå¤„ç†ï¼ˆé”å®šä¼˜æƒ åˆ¸ã€å†»ç»“ç§¯åˆ†ï¼‰
- âœ… è®¢å•æ”¯ä»˜å¤„ç†ï¼ˆä½¿ç”¨ä¼˜æƒ åˆ¸ã€æ‰£å‡ç§¯åˆ†ã€å‘æ”¾æ¶ˆè´¹ç§¯åˆ†ï¼‰
- âœ… è®¢å•å–æ¶ˆå¤„ç†ï¼ˆè§£é”ä¼˜æƒ åˆ¸ã€è§£å†»ç§¯åˆ†ï¼‰
- âœ… è®¢å•é€€æ¬¾å¤„ç†ï¼ˆé€€è¿˜ä¼˜æƒ åˆ¸ã€é€€è¿˜ç§¯åˆ†ã€æ‰£å‡æ¶ˆè´¹ç§¯åˆ†ï¼‰

**API æ¥å£**:

```
POST /client/order/calculate-discount  è®¡ç®—è®¢å•ä¼˜æƒ 
```

**ä¼˜æƒ è®¡ç®—é¡ºåº**:

1. è®¡ç®—è®¢å•åŸä»·
2. åº”ç”¨ä¼˜æƒ åˆ¸æŠµæ‰£
3. åº”ç”¨ç§¯åˆ†æŠµæ‰£ï¼ˆåœ¨ä¼˜æƒ åˆ¸åçš„é‡‘é¢åŸºç¡€ä¸Šï¼‰
4. ç¡®ä¿æœ€ç»ˆé‡‘é¢ä¸ä¸ºè´Ÿæ•°

**ä¸šåŠ¡æµç¨‹**:

```
è®¢å•åˆ›å»º â†’ é”å®šä¼˜æƒ åˆ¸ + å†»ç»“ç§¯åˆ†
è®¢å•æ”¯ä»˜ â†’ ä½¿ç”¨ä¼˜æƒ åˆ¸ + æ‰£å‡ç§¯åˆ† + å‘æ”¾æ¶ˆè´¹ç§¯åˆ†
è®¢å•å–æ¶ˆ â†’ è§£é”ä¼˜æƒ åˆ¸ + è§£å†»ç§¯åˆ†
è®¢å•é€€æ¬¾ â†’ é€€è¿˜ä¼˜æƒ åˆ¸ + é€€è¿˜ç§¯åˆ† + æ‰£å‡æ¶ˆè´¹ç§¯åˆ†
```

## ğŸ“ æ¨¡å—ç»“æ„

```
apps/backend/src/module/marketing/
â”œâ”€â”€ coupon/                    # ä¼˜æƒ åˆ¸æ¨¡å—
â”‚   â”œâ”€â”€ template/             # æ¨¡æ¿ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ dto/
â”‚   â”‚   â”œâ”€â”€ vo/
â”‚   â”‚   â”œâ”€â”€ template.repository.ts
â”‚   â”‚   â”œâ”€â”€ template.service.ts
â”‚   â”‚   â”œâ”€â”€ template.controller.ts
â”‚   â”‚   â””â”€â”€ template.module.ts
â”‚   â”œâ”€â”€ distribution/         # å‘æ”¾ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ dto/
â”‚   â”‚   â”œâ”€â”€ user-coupon.repository.ts
â”‚   â”‚   â”œâ”€â”€ redis-lock.service.ts
â”‚   â”‚   â”œâ”€â”€ distribution.service.ts
â”‚   â”‚   â”œâ”€â”€ distribution.controller.ts
â”‚   â”‚   â””â”€â”€ distribution.module.ts
â”‚   â”œâ”€â”€ usage/                # ä½¿ç”¨ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ dto/
â”‚   â”‚   â”œâ”€â”€ usage.repository.ts
â”‚   â”‚   â”œâ”€â”€ usage.service.ts
â”‚   â”‚   â””â”€â”€ usage.module.ts
â”‚   â”œâ”€â”€ statistics/           # ç»Ÿè®¡æœåŠ¡
â”‚   â”‚   â””â”€â”€ statistics.service.ts
â”‚   â”œâ”€â”€ scheduler/            # å®šæ—¶ä»»åŠ¡
â”‚   â”‚   â””â”€â”€ scheduler.service.ts
â”‚   â”œâ”€â”€ management/           # ç®¡ç†æ¥å£
â”‚   â”‚   â”œâ”€â”€ management.controller.ts
â”‚   â”‚   â””â”€â”€ management.module.ts
â”‚   â””â”€â”€ coupon.module.ts      # èšåˆæ¨¡å—
â”‚
â”œâ”€â”€ points/                    # ç§¯åˆ†æ¨¡å—
â”‚   â”œâ”€â”€ rule/                 # è§„åˆ™é…ç½®
â”‚   â”‚   â”œâ”€â”€ dto/
â”‚   â”‚   â”œâ”€â”€ vo/
â”‚   â”‚   â”œâ”€â”€ rule.repository.ts
â”‚   â”‚   â”œâ”€â”€ rule.service.ts
â”‚   â”‚   â”œâ”€â”€ rule.controller.ts
â”‚   â”‚   â””â”€â”€ rule.module.ts
â”‚   â”œâ”€â”€ account/              # è´¦æˆ·ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ dto/
â”‚   â”‚   â”œâ”€â”€ vo/
â”‚   â”‚   â”œâ”€â”€ account.repository.ts
â”‚   â”‚   â”œâ”€â”€ transaction.repository.ts
â”‚   â”‚   â”œâ”€â”€ account.service.ts
â”‚   â”‚   â”œâ”€â”€ account.controller.ts
â”‚   â”‚   â””â”€â”€ account.module.ts
â”‚   â”œâ”€â”€ signin/               # ç­¾åˆ°åŠŸèƒ½
â”‚   â”‚   â”œâ”€â”€ signin.service.ts
â”‚   â”‚   â”œâ”€â”€ signin.controller.ts
â”‚   â”‚   â””â”€â”€ signin.module.ts
â”‚   â”œâ”€â”€ task/                 # ä»»åŠ¡ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ dto/
â”‚   â”‚   â”œâ”€â”€ vo/
â”‚   â”‚   â”œâ”€â”€ task.repository.ts
â”‚   â”‚   â”œâ”€â”€ completion.repository.ts
â”‚   â”‚   â”œâ”€â”€ task.service.ts
â”‚   â”‚   â”œâ”€â”€ task.controller.ts
â”‚   â”‚   â””â”€â”€ task.module.ts
â”‚   â”œâ”€â”€ statistics/           # ç»Ÿè®¡æœåŠ¡
â”‚   â”‚   â””â”€â”€ statistics.service.ts
â”‚   â”œâ”€â”€ scheduler/            # å®šæ—¶ä»»åŠ¡
â”‚   â”‚   â””â”€â”€ scheduler.service.ts
â”‚   â”œâ”€â”€ management/           # ç®¡ç†æ¥å£
â”‚   â”‚   â”œâ”€â”€ management.controller.ts
â”‚   â”‚   â””â”€â”€ management.module.ts
â”‚   â””â”€â”€ points.module.ts      # èšåˆæ¨¡å—
â”‚
â”œâ”€â”€ integration/               # è®¢å•é›†æˆ
â”‚   â”œâ”€â”€ dto/
â”‚   â”œâ”€â”€ vo/
â”‚   â”œâ”€â”€ integration.service.ts
â”‚   â”œâ”€â”€ integration.controller.ts
â”‚   â””â”€â”€ integration.module.ts
â”‚
â””â”€â”€ marketing.module.ts        # è¥é”€æ€»æ¨¡å—
```

## ğŸ”§ æŠ€æœ¯ç‰¹æ€§

### 1. ç§Ÿæˆ·éš”ç¦»

- æ‰€æœ‰ Repository ç»§æ‰¿ `BaseRepository` æˆ– `SoftDeleteRepository`
- è‡ªåŠ¨å¤„ç† `tenantId` è¿‡æ»¤
- ç¡®ä¿æ•°æ®å®‰å…¨éš”ç¦»

### 2. å¹¶å‘æ§åˆ¶

- **ä¼˜æƒ åˆ¸åº“å­˜æ‰£å‡**: Redis åˆ†å¸ƒå¼é”
- **ç§¯åˆ†æ‰£å‡**: ä¹è§‚é”ï¼ˆversionå­—æ®µï¼‰
- **é‡è¯•æœºåˆ¶**: æœ€å¤š3æ¬¡é‡è¯•

### 3. äº‹åŠ¡å¤„ç†

- å…³é”®æ“ä½œä½¿ç”¨ Prisma äº‹åŠ¡
- ç¡®ä¿æ•°æ®ä¸€è‡´æ€§
- å¼‚å¸¸è‡ªåŠ¨å›æ»š

### 4. å®šæ—¶ä»»åŠ¡

- ä½¿ç”¨ `@nestjs/schedule`
- æ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œ
- å¤„ç†è¿‡æœŸä¼˜æƒ åˆ¸å’Œç§¯åˆ†

### 5. æ—¥å¿—è®°å½•

- è®°å½•å…³é”®æ“ä½œ
- åŒ…å«å…³é”®IDå’Œå‚æ•°
- ä¾¿äºé—®é¢˜æ’æŸ¥

### 6. å¼‚å¸¸å¤„ç†

- ä½¿ç”¨ `BusinessException` ç»Ÿä¸€å¼‚å¸¸
- æ¸…æ™°çš„é”™è¯¯æ¶ˆæ¯
- ç¬¦åˆé¡¹ç›®è§„èŒƒ

### 7. API æ–‡æ¡£

- å®Œæ•´çš„ Swagger æ–‡æ¡£
- ä¸­æ–‡æ³¨é‡Š
- è¯·æ±‚/å“åº”ç¤ºä¾‹

## ğŸ“Š æ•°æ®æµç¨‹å›¾

### ä¼˜æƒ åˆ¸ç”Ÿå‘½å‘¨æœŸ

```
åˆ›å»ºæ¨¡æ¿ â†’ å‘æ”¾/é¢†å– â†’ é”å®š â†’ ä½¿ç”¨ â†’ å®Œæˆ
                    â†“      â†“
                  è§£é”   é€€è¿˜
```

### ç§¯åˆ†ç”Ÿå‘½å‘¨æœŸ

```
è·å¾—ç§¯åˆ† â†’ å¯ç”¨ç§¯åˆ† â†’ å†»ç»“ â†’ æ‰£å‡ â†’ å·²ä½¿ç”¨
                    â†“      â†“
                  è§£å†»   é€€è¿˜
                    â†“
                  è¿‡æœŸ
```

### è®¢å•ä¼˜æƒ æµç¨‹

```
1. è®¡ç®—ä¼˜æƒ 
   â”œâ”€ ä¼˜æƒ åˆ¸æŠµæ‰£
   â””â”€ ç§¯åˆ†æŠµæ‰£

2. è®¢å•åˆ›å»º
   â”œâ”€ é”å®šä¼˜æƒ åˆ¸
   â””â”€ å†»ç»“ç§¯åˆ†

3. è®¢å•æ”¯ä»˜
   â”œâ”€ ä½¿ç”¨ä¼˜æƒ åˆ¸
   â”œâ”€ æ‰£å‡ç§¯åˆ†
   â””â”€ å‘æ”¾æ¶ˆè´¹ç§¯åˆ†

4. è®¢å•å–æ¶ˆ
   â”œâ”€ è§£é”ä¼˜æƒ åˆ¸
   â””â”€ è§£å†»ç§¯åˆ†

5. è®¢å•é€€æ¬¾
   â”œâ”€ é€€è¿˜ä¼˜æƒ åˆ¸
   â”œâ”€ é€€è¿˜ç§¯åˆ†
   â””â”€ æ‰£å‡æ¶ˆè´¹ç§¯åˆ†
```

## ğŸ¯ æ ¸å¿ƒä¸šåŠ¡è§„åˆ™

### ä¼˜æƒ åˆ¸è§„åˆ™

1. åº“å­˜æ‰£å‡ä½¿ç”¨åˆ†å¸ƒå¼é”ï¼Œé˜²æ­¢è¶…å‘
2. ç”¨æˆ·é¢†å–æ¬¡æ•°é™åˆ¶
3. æœ€ä½æ¶ˆè´¹é‡‘é¢é™åˆ¶
4. æœ‰æ•ˆæœŸéªŒè¯
5. çŠ¶æ€è½¬æ¢ï¼šæœªä½¿ç”¨â†’é”å®šâ†’å·²ä½¿ç”¨/å·²è¿‡æœŸ

### ç§¯åˆ†è§„åˆ™

1. æ¶ˆè´¹ç§¯åˆ†ï¼šæ¯æ¶ˆè´¹Nå…ƒè·å¾—Mç§¯åˆ†
2. ç­¾åˆ°ç§¯åˆ†ï¼šæ¯æ—¥ç­¾åˆ°è·å¾—å›ºå®šç§¯åˆ†
3. ç§¯åˆ†æŠµæ‰£ï¼šNç§¯åˆ†æŠµæ‰£Må…ƒ
4. æŠµæ‰£é™åˆ¶ï¼šæœ€ä½ä½¿ç”¨ç§¯åˆ†ã€æœ€å¤§æŠµæ‰£æ¯”ä¾‹
5. ç§¯åˆ†æœ‰æ•ˆæœŸï¼šæ”¯æŒæ°¸ä¹…æœ‰æ•ˆæˆ–æŒ‡å®šå¤©æ•°
6. å¹¶å‘æ‰£å‡ä½¿ç”¨ä¹è§‚é”

### è®¢å•é›†æˆè§„åˆ™

1. ä¼˜æƒ è®¡ç®—é¡ºåºï¼šå…ˆä¼˜æƒ åˆ¸ï¼Œåç§¯åˆ†
2. æœ€ç»ˆé‡‘é¢ä¸èƒ½ä¸ºè´Ÿæ•°
3. è®¢å•åˆ›å»ºæ—¶é”å®šèµ„æº
4. è®¢å•æ”¯ä»˜æ—¶ä½¿ç”¨èµ„æº
5. è®¢å•å–æ¶ˆ/é€€æ¬¾æ—¶é‡Šæ”¾èµ„æº

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### 1. åˆ›å»ºä¼˜æƒ åˆ¸æ¨¡æ¿

```typescript
POST /admin/marketing/coupon/templates
{
  "name": "æ–°ç”¨æˆ·ä¸“äº«åˆ¸",
  "type": "DISCOUNT",
  "discountAmount": 10,
  "minOrderAmount": 50,
  "totalStock": 1000,
  "limitPerUser": 1,
  "validityType": "FIXED",
  "validDays": 30
}
```

### 2. ç”¨æˆ·é¢†å–ä¼˜æƒ åˆ¸

```typescript
POST /client/marketing/coupon/claim/:templateId
```

### 3. è®¡ç®—è®¢å•ä¼˜æƒ 

```typescript
POST /client/order/calculate-discount
{
  "items": [
    {
      "productId": "prod_001",
      "productName": "å•†å“A",
      "price": 100,
      "quantity": 2
    }
  ],
  "userCouponId": "coupon_001",
  "pointsUsed": 100
}
```

### 4. ç”¨æˆ·ç­¾åˆ°

```typescript
POST / client / marketing / points / signin;
```

### 5. æŸ¥è¯¢ç§¯åˆ†ä½™é¢

```typescript
GET / client / marketing / points / balance;
```

## âš ï¸ å¾…å®ç°åŠŸèƒ½

### Task 9: ç§¯åˆ†ä»»åŠ¡æ¨¡å—ï¼ˆå¯é€‰ï¼‰

- åˆ›å»ºç§¯åˆ†ä»»åŠ¡
- æ›´æ–°ç§¯åˆ†ä»»åŠ¡
- å®Œæˆä»»åŠ¡å¹¶å‘æ”¾ç§¯åˆ†
- æŸ¥è¯¢ä»»åŠ¡å®Œæˆè®°å½•

### Task 14-20: å…¶ä»–å¯é€‰ä»»åŠ¡

- ç§Ÿæˆ·éš”ç¦»æµ‹è¯•
- é”™è¯¯å¤„ç†ä¼˜åŒ–
- å•å…ƒæµ‹è¯•
- é›†æˆæµ‹è¯•
- æ€§èƒ½ä¼˜åŒ–
- æ–‡æ¡£å®Œå–„

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **æ•°æ®åº“è¿ç§»**: ä½¿ç”¨ `npx prisma db push` åŒæ­¥æ•°æ®åº“
2. **Redis é…ç½®**: ç¡®ä¿ Redis æœåŠ¡æ­£å¸¸è¿è¡Œï¼ˆåˆ†å¸ƒå¼é”éœ€è¦ï¼‰
3. **å®šæ—¶ä»»åŠ¡**: ç¡®ä¿æœåŠ¡å™¨æ—¶åŒºæ­£ç¡®ï¼ˆå®šæ—¶ä»»åŠ¡ä¾èµ–ï¼‰
4. **å¹¶å‘æµ‹è¯•**: å»ºè®®è¿›è¡Œå‹åŠ›æµ‹è¯•éªŒè¯å¹¶å‘å®‰å…¨æ€§
5. **æ—¥å¿—ç›‘æ§**: å…³æ³¨å®šæ—¶ä»»åŠ¡çš„æ‰§è¡Œæ—¥å¿—

## ğŸ‰ æ€»ç»“

ä¼˜æƒ åˆ¸å’Œç§¯åˆ†ç³»ç»Ÿçš„æ ¸å¿ƒåŠŸèƒ½å·²å…¨éƒ¨å®ç°å®Œæˆï¼ŒåŒ…æ‹¬ï¼š

- âœ… 8å¼ æ•°æ®åº“è¡¨
- âœ… 10ä¸ªæšä¸¾ç±»å‹
- âœ… 6ä¸ªæ ¸å¿ƒæ¨¡å—
- âœ… 30+ API æ¥å£
- âœ… å®Œæ•´çš„ä¸šåŠ¡æµç¨‹
- âœ… å¹¶å‘å®‰å…¨ä¿éšœ
- âœ… å®šæ—¶ä»»åŠ¡å¤„ç†
- âœ… è®¢å•é›†æˆ

ç³»ç»Ÿå·²å¯ä»¥æŠ•å…¥ä½¿ç”¨ï¼Œæ”¯æŒå®Œæ•´çš„ä¼˜æƒ åˆ¸å’Œç§¯åˆ†ä¸šåŠ¡åœºæ™¯ï¼

---

## ğŸ¯ å®ç°æ€»ç»“

### æ ¸å¿ƒæˆæœ

ä¼˜æƒ åˆ¸å’Œç§¯åˆ†ç³»ç»Ÿå·²å®Œæˆ**æ ¸å¿ƒåŠŸèƒ½å®ç°**ï¼ŒåŒ…æ‹¬ï¼š

1. **å®Œæ•´çš„æ•°æ®åº“è®¾è®¡**ï¼š8å¼ è¡¨ã€10ä¸ªæšä¸¾ç±»å‹ã€25ä¸ªç´¢å¼•
2. **ä¼˜æƒ åˆ¸å…¨æµç¨‹**ï¼šæ¨¡æ¿ç®¡ç† â†’ å‘æ”¾é¢†å– â†’ ä½¿ç”¨éªŒè¯ â†’ ç»Ÿè®¡åˆ†æ
3. **ç§¯åˆ†å…¨æµç¨‹**ï¼šè§„åˆ™é…ç½® â†’ è´¦æˆ·ç®¡ç† â†’ è·å–ä½¿ç”¨ â†’ è¿‡æœŸå¤„ç†
4. **è®¢å•æ·±åº¦é›†æˆ**ï¼šä¼˜æƒ è®¡ç®—ã€ç”Ÿå‘½å‘¨æœŸå¤„ç†ã€äº‹åŠ¡ä¿è¯
5. **æ¨¡å—åŒ–æ¶æ„**ï¼šæ¸…æ™°çš„æ¨¡å—åˆ’åˆ†ã€æœåŠ¡å¯¼å‡ºã€ä¾èµ–æ³¨å…¥

### æŠ€æœ¯äº®ç‚¹

- **å¹¶å‘å®‰å…¨**ï¼šRedisåˆ†å¸ƒå¼é”ï¼ˆä¼˜æƒ åˆ¸åº“å­˜ï¼‰+ ä¹è§‚é”ï¼ˆç§¯åˆ†æ‰£å‡ï¼‰
- **äº‹åŠ¡ä¿è¯**ï¼šPrismaäº‹åŠ¡ç¡®ä¿æ•°æ®ä¸€è‡´æ€§
- **è½¯åˆ é™¤ç­–ç•¥**ï¼šä¿ç•™å†å²è®°å½•ï¼Œç¬¦åˆå®¡è®¡è¦æ±‚
- **å®šæ—¶ä»»åŠ¡**ï¼šè‡ªåŠ¨å¤„ç†è¿‡æœŸä¼˜æƒ åˆ¸å’Œç§¯åˆ†
- **ç§Ÿæˆ·éš”ç¦»**ï¼šBaseRepositoryè‡ªåŠ¨å¤„ç†å¤šç§Ÿæˆ·
- **å®Œæ•´æ—¥å¿—**ï¼šå…³é”®æ“ä½œå…¨ç¨‹è®°å½•

### API ç»Ÿè®¡

- **ä¼˜æƒ åˆ¸**: 15+ ä¸ªæ¥å£ï¼ˆç®¡ç†ç«¯ + å®¢æˆ·ç«¯ï¼‰
- **ç§¯åˆ†**: 20+ ä¸ªæ¥å£ï¼ˆè§„åˆ™ã€è´¦æˆ·ã€ç­¾åˆ°ã€ä»»åŠ¡ã€ç»Ÿè®¡ï¼‰
- **è®¢å•é›†æˆ**: 5+ ä¸ªæ¥å£ï¼ˆè®¡ç®—ã€å¤„ç†ï¼‰
- **æ€»è®¡**: 40+ ä¸ª RESTful APIï¼Œå®Œæ•´ Swagger æ–‡æ¡£

### ä»£ç è§„èŒƒ

âœ… éµå¾ª `QUICK_START.md` å¼€å‘è§„èŒƒ  
âœ… ä½¿ç”¨ `Result` ç»Ÿä¸€å“åº”æ ¼å¼  
âœ… ä½¿ç”¨ `BusinessException` ç»Ÿä¸€å¼‚å¸¸å¤„ç†  
âœ… æ‰€æœ‰ TypeScript è¯Šæ–­é€šè¿‡  
âœ… å®Œæ•´çš„ä¸­æ–‡æ³¨é‡Šå’Œæ–‡æ¡£

### å¾…å®Œæˆå·¥ä½œ

å¯é€‰çš„å¢å¼ºä»»åŠ¡ï¼ˆTasks 14-15, 17-20ï¼‰ï¼š

- å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
- æ€§èƒ½ä¼˜åŒ–ï¼ˆç¼“å­˜ã€å¼‚æ­¥å¤„ç†ï¼‰
- é”™è¯¯ç å®šä¹‰
- éƒ¨ç½²æ–‡æ¡£

**å½“å‰ç³»ç»Ÿå·²å…·å¤‡ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²èƒ½åŠ›** ğŸš€
