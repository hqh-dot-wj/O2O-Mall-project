# 待解决问题清单 (TODO List)

本文档记录了项目在安全性、权限完整性以及性能架构方面存在的待优化项。

## 1. 安全性与权限 (Security)

### 🔓 数据脱敏处理
- **问题**: 订单列表、会员列表等接口目前返回明文手机号。
- **影响**: 存在用户信息泄露风险。
- **建议**: 在 VO 层引入脱敏过滤器，对非必要场景下的手机号进行 `138****1234` 处理。

### 🛡️ 租户隔离增强
- **已完成**: 在 `BaseRepository` 层增加了基础隔离。
- **待优化**: 为超管增加一个“模拟租户”的功能，以便在“上帝视角”和“单租户视角”之间无缝切换。

---

## 2. 性能优化 (Performance)

### 🚀 内存聚合瓶颈 (Critical)
- **位置**: `StoreFinanceService.getLedger` (门店流水接口)
- **问题**: 现在的逻辑是在 Node.js 内存中对订单、流水、提现、佣金 4 个表的数据进行 `sort` 排序和分页。数据量大时会发生 OOM（内存溢出）并严重阻塞事件循环。
- **方案**: 建议重构为数据库层 `UNION ALL` 查询，或建立专用的 `FinLedger` 汇总流水表。

### 📉 递归查询 (N+1)
- **位置**: `ClientProductService.getAllCategoryIds`
- **问题**: 递归查库获取树状分类 ID 列表。
- **方案**: 改为一次性载入分类缓存，或引入 MPTT（左右值）编码。

### 🔍 大量连表开销
- **位置**: 商品详情及列表接口。
- **问题**: 存在 3 层以上的 `include` 关联，且未限制字段。
- **方案**: 严格使用 `select` 子句，并引入 Redis 二级缓存存储热点商品数据。
