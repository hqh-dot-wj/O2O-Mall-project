generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions"]
}

// Prisma é»˜è®¤ä½¿ç”¨ DATABASE_URLï¼Œä½†æˆ‘ä»¬ä¼šåœ¨ Nest çš„ PrismaService ä¸­æŒ‰éœ€æ³¨å…¥è¿æ¥ä¸²ã€‚
datasource db {
  provider   = "postgresql"
  url        = env("DATABASE_URL")
  extensions = [postgis]
}

enum Status {
  NORMAL @map("0")
  STOP   @map("1")
}

enum DelFlag {
  NORMAL @map("0")
  DELETE @map("1")
}

// ==================== Cç«¯/SaaS ä¸šåŠ¡è¡¨ (Refactored) ====================

enum MemberStatus {
  NORMAL   @map("1") // æ­£å¸¸
  DISABLED @map("2") // ç¦ç”¨
}

enum SocialPlatform {
  MP_MALL
  MP_WORK
  APP_MAIN
}

enum WorkerStatus {
  WORKING  @map("1") // æ¥å•ä¸­ (è¥ä¸š)
  RESTING  @map("2") // ä¼‘æ¯ä¸­ (æ‰“çƒŠ)
  FROZEN   @map("3") // å†»ç»“ä¸­ (æš‚åœ)
  RESIGNED @map("4") // ç¦»èŒä¸­ (ç¦»èŒ)
}

enum AuditStatus {
  PENDING  @map("0") // å¾…å®¡æ ¸
  APPROVED @map("1") // é€šè¿‡
  REJECTED @map("2") // é©³å›
}

enum WorkerLevel {
  PRIMARY @map("1") // åˆçº§
  MIDDLE  @map("2") // ä¸­çº§
  SENIOR  @map("3") // é«˜çº§
  GOLD    @map("4") // é‡‘ç‰Œ
}

enum Gender {
  UNKNOWN @map("0") // æœªçŸ¥
  MALE    @map("1") // ç”·
  FEMALE  @map("2") // å¥³
}

enum MediaType {
  IMAGE @map("1") // å›¾ç‰‡
  VIDEO @map("2") // è§†é¢‘
}

enum SkillLevel {
  GENERAL @map("1") // ä¸€èˆ¬
  MASTER  @map("2") // ç²¾é€š
}

enum WageType {
  HOURLY     @map("1") // æ—¶è–ªåˆ¶ (å¦‚: ä¿æ´ 80/å°æ—¶)
  PERCENTAGE @map("2") // åˆ†æˆåˆ¶ (å¦‚: ç»´ä¿® å¹³å°æŠ½20%)
  FIXED      @map("3") // ä¸€å£ä»· (å¦‚: æ¬å®¶ 200/æ¬¡)
}

enum AttrUsageType {
  PARAM // å‚æ•° (è¯¦æƒ…é¡µå±•ç¤º)
  SPEC // è§„æ ¼ (SKUç”Ÿæˆç”¨)
}

enum SettleType {
  WALLET // è¿›Appé’±åŒ…
  BANK // é“¶è¡Œå¡/çº¿ä¸‹æ‰“æ¬¾
}

enum ProductType {
  REAL // å®ç‰©å•†å“ (éœ€å‘è´§ï¼Œæ‰£ç»å¯¹åº“å­˜)
  SERVICE // æœåŠ¡å•†å“ (éœ€æ ¸é”€ï¼Œæ‰£æ—¶é—´ç‰‡/æ¯æ—¥è¿åŠ›)
}

enum PublishStatus {
  OFF_SHELF // ä¸‹æ¶
  ON_SHELF // ä¸Šæ¶
}

// ==========================================
// ğŸ“Œ è´¢åŠ¡ç³»ç»Ÿæšä¸¾
// ==========================================

/// äº¤æ˜“ç±»å‹
enum TransType {
  COMMISSION_IN // ä½£é‡‘å…¥è´¦
  WITHDRAW_OUT // æç°æ‰£æ¬¾
  REFUND_DEDUCT // é€€æ¬¾å€’æ‰£
  CONSUME_PAY // ä½™é¢æ”¯ä»˜
  RECHARGE_IN // å……å€¼(é¢„ç•™)
}

/// ä½£é‡‘çŠ¶æ€
enum CommissionStatus {
  FROZEN // å†»ç»“ä¸­
  SETTLED // å·²ç»“ç®—
  CANCELLED // å·²å–æ¶ˆ
}

/// æç°çŠ¶æ€
enum WithdrawalStatus {
  PENDING // å¾…å®¡æ ¸
  APPROVED // å·²é€šè¿‡
  REJECTED // å·²é©³å›
  FAILED // æ‰“æ¬¾å¤±è´¥
}

// ==========================================
// ğŸ“Œ å•†å“ç±»åˆ«ä¸å±æ€§
// ==========================================

/// å•†å“åˆ†ç±»è¡¨ (æ ‘å½¢ç»“æ„)
model PmsCategory {
  catId    Int     @id @default(autoincrement()) @map("cat_id")
  parentId Int?    @map("parent_id")
  name     String  @db.VarChar(50)
  level    Int // 1, 2, 3
  icon     String?
  sort     Int     @default(0)

  // --- å…³é”®ï¼šç±»å‹ç»‘å®š ---
  // æ¯”å¦‚"ä¿æ´"åˆ†ç±»åªèƒ½å‘æœåŠ¡ï¼Œ"æ¸…æ´å‰‚"åˆ†ç±»åªèƒ½å‘å®ç‰©
  bindType ProductType? @map("bind_type")

  // [æ–°å¢] å…³è”å±æ€§æ¨¡æ¿ ID
  attrTemplateId Int? @map("attr_template_id")

  attrTemplate PmsAttrTemplate? @relation(fields: [attrTemplateId], references: [templateId])

  parent   PmsCategory?  @relation("CatTree", fields: [parentId], references: [catId])
  children PmsCategory[] @relation("CatTree")
  products PmsProduct[]

  @@map("pms_category")
}

/// å“ç‰Œè¡¨ (ä¸»è¦ç”¨äºå®ç‰©)
model PmsBrand {
  brandId Int     @id @default(autoincrement()) @map("brand_id")
  name    String
  logo    String?

  products PmsProduct[]

  @@map("pms_brand")
}

// ==========================================
// ğŸ“Œ [æ–°å¢] å•†å“å‚æ•°/å±æ€§æ¨¡æ¿ç³»ç»Ÿ
// ==========================================

/// 1. å±æ€§åˆ†ç±»/æ¨¡æ¿è¡¨ (Attribute Group)
/// ä½œç”¨ï¼šå°†ä¸€å †å±æ€§æ‰“åŒ…ã€‚ä¾‹å¦‚: "æ‰‹æœºå‚æ•°æ¨¡æ¿", "å®¶æ”¿ä¿æ´æ¨¡æ¿"
model PmsAttrTemplate {
  templateId Int    @id @default(autoincrement()) @map("template_id")
  name       String @db.VarChar(64)

  // å…³è”åˆ†ç±» (é€šå¸¸æ˜¯ä¸€å¯¹å¤šï¼Œä¸€ä¸ªæ¨¡æ¿å¯ä»¥ç»™å¤šä¸ªåˆ†ç±»ç”¨)
  categories PmsCategory[]
  attributes PmsAttribute[]

  createTime DateTime @default(now()) @map("create_time")

  @@map("pms_attr_template")
}

/// 2. å±æ€§åå®šä¹‰è¡¨ (Attribute Key)
/// ä½œç”¨ï¼šå®šä¹‰å…·ä½“çš„å­—æ®µã€‚å¦‚: "æè´¨", "æœåŠ¡æ—¶é•¿"
model PmsAttribute {
  attrId     Int @id @default(autoincrement()) @map("attr_id")
  templateId Int @map("template_id")

  name String @db.VarChar(64) // å±æ€§å: "æè´¨" / "æœåŠ¡èŒƒå›´"

  // --- æ ¸å¿ƒç±»å‹åŒºåˆ† ---
  // PARAM: åŸºæœ¬å‚æ•° (çº¯å±•ç¤ºï¼Œå¦‚: äº§åœ°)
  // SPEC:  é”€å”®å±æ€§ (å†³å®šSKUï¼Œå¦‚: é¢œè‰²)
  usageType AttrUsageType @map("usage_type")

  // --- é€‚ç”¨å•†å“ç±»å‹ (å®ç‰©/æœåŠ¡) ---
  // 0:é€šç”¨ 1:å®ç‰©ä¸“ç”¨ 2:æœåŠ¡ä¸“ç”¨
  // æ¯”å¦‚ "ä¿ä¿®æœŸ" æ˜¯å®ç‰©ä¸“ç”¨ï¼Œ"ä¸Šé—¨æ—¶é—´" æ˜¯æœåŠ¡ä¸“ç”¨
  applyType Int @default(0) @map("apply_type")

  // --- å½•å…¥æ–¹å¼ ---
  // 0: æ‰‹å·¥å½•å…¥ (Input)
  // 1: åˆ—è¡¨é€‰æ‹© (Select)
  inputType Int @default(0) @map("input_type")

  // --- å¯é€‰å€¼åˆ—è¡¨ (é€—å·åˆ†éš”) ---
  // å¦‚: "æ£‰,éº»,ä¸ç»¸" æˆ– "æŒ‚æœº,æŸœæœº"
  inputList String? @map("input_list")

  sort Int @default(0)

  template PmsAttrTemplate       @relation(fields: [templateId], references: [templateId])
  values   PmsProductAttrValue[]

  @@map("pms_attribute")
}

/// 3. å•†å“å±æ€§å€¼å­˜å‚¨è¡¨ (Attribute Value)
/// ä½œç”¨ï¼šè®°å½•æŸä¸ªå•†å“é€‰äº†ä»€ä¹ˆå€¼ã€‚å¦‚: å•†å“A - æè´¨ - æ£‰
model PmsProductAttrValue {
  id        Int    @id @default(autoincrement())
  productId String @map("product_id")
  attrId    Int    @map("attr_id")

  // å†—ä½™å±æ€§åï¼Œé˜²æ­¢æ¨¡æ¿åˆ äº†å•†å“æ˜¾ç¤ºä¸å‡ºæ¥
  attrName String @map("attr_name")

  // å®é™…é€‰çš„å€¼ (å¦‚: "æ£‰")
  value String @map("value")

  product   PmsProduct   @relation(fields: [productId], references: [productId])
  attribute PmsAttribute @relation(fields: [attrId], references: [attrId])

  @@index([productId])
  @@map("pms_product_attr_value")
}

// ==========================================
// ğŸ“Œ å•†å“æ ‡å‡†åº“ (æ€»éƒ¨è§†è§’ - Global SPU)
// ==========================================

model PmsProduct {
  productId  String @id @default(uuid()) @map("product_id")
  categoryId Int    @map("cat_id")
  brandId    Int?   @map("brand_id")

  // --- åŸºç¡€ä¿¡æ¯ ---
  name       String   @db.VarChar(100)
  subTitle   String?  @map("sub_title") // å–ç‚¹æè¿°
  mainImages String[] @map("main_images") // è½®æ’­å›¾
  detailHtml String   @map("detail_html") @db.Text // å¯Œæ–‡æœ¬è¯¦æƒ…

  // --- æ ¸å¿ƒç±»å‹åŒºåˆ† ---
  type ProductType

  // --- [å·®å¼‚åŒ–å­—æ®µ] å®ç‰©ç‰¹æœ‰ ---
  weight     Int? // é‡é‡(å…‹)ï¼Œç”¨äºç®—è¿è´¹
  isFreeShip Boolean @default(false) @map("is_free_ship") // æ˜¯å¦åŒ…é‚®

  // --- [å·®å¼‚åŒ–å­—æ®µ] æœåŠ¡ç‰¹æœ‰ ---
  serviceDuration Int?    @map("service_duration") // æœåŠ¡æ—¶é•¿(åˆ†é’Ÿ)ï¼Œç”¨äºæ’ç­å ä½
  serviceRadius   Int?    @map("service_radius") // é»˜è®¤æœåŠ¡åŠå¾„(ç±³)ï¼Œé—¨åº—å¯é‡å†™
  needBooking     Boolean @default(true) @map("need_booking") // æ˜¯å¦éœ€è¦é¢„çº¦

  // --- è§„æ ¼å®šä¹‰ ---
  // å­˜å‚¨: [{"name": "é¢œè‰²", "values": ["çº¢", "è“"]}]
  specDef Json @map("spec_def")

  // --- [æ–°å¢] ä¸Šæ¶çŠ¶æ€ (Selection Centerå¯è§æ€§) ---
  publishStatus PublishStatus @default(ON_SHELF) @map("publish_status")

  // --- [æ–°å¢] è½¯åˆ é™¤æ ‡è®° ---
  delFlag DelFlag @default(NORMAL) @map("del_flag")

  createTime DateTime @default(now()) @map("create_time")

  // å…³è”
  category       PmsCategory           @relation(fields: [categoryId], references: [catId])
  brand          PmsBrand?             @relation(fields: [brandId], references: [brandId])
  // [æ–°å¢] å…³è”å±æ€§å€¼
  attrValues     PmsProductAttrValue[]
  globalSkus     PmsGlobalSku[]
  tenantProducts PmsTenantProduct[]

  @@index([categoryId])
  @@map("pms_product")
}

/// æ ‡å‡† SKU è¡¨ (æ€»éƒ¨å®šä»·å‚è€ƒ)
model PmsGlobalSku {
  skuId     String @id @default(uuid()) @map("sku_id")
  productId String @map("product_id")

  // --- è§„æ ¼ç»„åˆ ---
  // å®ç‰©: {"é¢œè‰²":"çº¢", "å°ºå¯¸":"L"}
  // æœåŠ¡: {"æ—¶é•¿":"2å°æ—¶", "çº§åˆ«":"é‡‘ç‰ŒæŠ€å¸ˆ"}
  specValues Json @map("spec_values")

  // --- ç´¢å¼•å›¾ ---
  skuImage String? @map("sku_image")

  // --- æ€»éƒ¨æŒ‡å¯¼ä»· ---
  guidePrice Decimal @map("guide_price") @db.Decimal(10, 2)

  // --- [æ–°å¢] æ€»éƒ¨æŒ‡å¯¼åˆ†ä½£é…ç½® ---
  distMode DistributionMode @default(RATIO) @map("dist_mode")

  // æŒ‡å¯¼æ¯”ä¾‹ (0.10 ä»£è¡¨ 10%) æˆ– æŒ‡å¯¼é‡‘é¢ (10.00å…ƒ)
  guideRate Decimal @default(0.00) @map("guide_rate") @db.Decimal(10, 2)

  // [æ–°å¢] å¿…é¡»åŠ è¿™ä¸¤ä¸ªå­—æ®µï¼Œå¦åˆ™æ— æ³•å®ç°"ä¸èƒ½æ¯”æ€»éƒ¨ä½/é«˜"çš„ç®¡æ§
  minDistRate Decimal @default(0.00) @map("min_dist_rate") @db.Decimal(10, 2) // æœ€ä½å…è®¸æ¯”ä¾‹ (å¦‚ 5%)
  maxDistRate Decimal @default(50.00) @map("max_dist_rate") @db.Decimal(10, 2) // æœ€é«˜å…è®¸æ¯”ä¾‹ (å¦‚ 30%)

  // æˆæœ¬ä»· (ç”¨äºé£æ§æ ¡éªŒ (price - cost) > commission)
  costPrice Decimal @default(0.00) @map("cost_price") @db.Decimal(10, 2)

  product       PmsProduct     @relation(fields: [productId], references: [productId])
  pmsTenantSkus PmsTenantSku[]

  @@map("pms_global_sku")
}

// ==========================================
// ğŸ“Œ é—¨åº—ç»è¥åº“ (åˆ†å…¬å¸è§†è§’ - Tenant SPU)
// ==========================================

model PmsTenantProduct {
  id        String @id @default(uuid())
  tenantId  String @map("tenant_id") // å½’å±é—¨åº—
  productId String @map("product_id") // å¼•ç”¨æ€»éƒ¨å•†å“

  // --- ç»è¥çŠ¶æ€ ---
  status PublishStatus @default(OFF_SHELF)
  isHot  Boolean       @default(false) // æ˜¯å¦è®¾ä¸ºåº—é•¿æ¨è
  sort   Int           @default(0)

  // --- é—¨åº—é‡å†™æ•°æ® (Override) ---
  // å¦‚æœå¡«äº†ï¼Œå°±è¦†ç›–æ€»éƒ¨çš„æ ‡é¢˜/å›¾ç‰‡ï¼›æ²¡å¡«å°±ç»§æ‰¿
  customTitle String? @map("custom_title")

  // --- [æœåŠ¡ç‰¹æœ‰] é—¨åº—æ´¾å•è§„åˆ™ ---
  // æ¯”å¦‚è¿™å®¶åº—åªæ¥æ–¹åœ†3å…¬é‡Œçš„å•ï¼Œå¦ä¸€å®¶èƒ½æ¥10å…¬é‡Œ
  overrideRadius Int? @map("override_radius")

  createTime DateTime @default(now()) @map("create_time")

  product PmsProduct     @relation(fields: [productId], references: [productId])
  skus    PmsTenantSku[] // é—¨åº—çš„SKUä»·æ ¼åº“å­˜

  @@unique([tenantId, productId]) // ä¸€ä¸ªåº—ä¸èƒ½é‡å¤ä¸Šæ¶åŒä¸€ä¸ªå•†å“
  @@map("pms_tenant_product")
}

/// é—¨åº— SKU è¡¨ (çœŸæ­£çš„ä»·æ ¼å’Œåº“å­˜éƒ½åœ¨è¿™é‡Œ)
model PmsTenantSku {
  id              String       @id @default(uuid())
  tenantId        String       @map("tenant_id") @db.VarChar(20)
  tenantProductId String       @map("tenant_prod_id")
  globalSkuId     String       @map("global_sku_id") // å¯¹åº”å“ªä¸ªæ ‡å‡†SKU
  globalSku       PmsGlobalSku @relation(fields: [globalSkuId], references: [skuId])

  // --- æ ¸å¿ƒç»è¥æ•°æ® ---
  price Decimal @db.Decimal(10, 2) // é—¨åº—å®é™…å”®ä»·

  // --- åº“å­˜/è¿åŠ›å®šä¹‰çš„æ­§ä¹‰å¤„ç† ---
  // 1. å®ç‰©: çœŸå®çš„ç‰©ç†åº“å­˜ã€‚å–ä¸€ä¸ªå°‘ä¸€ä¸ªã€‚
  // 2. æœåŠ¡: æ¯æ—¥æœ€å¤§æ¥å•é‡ (Capacity)ã€‚å¦‚æœä¸é™åˆ¶å¡« -1ã€‚
  //    (æ³¨æ„: æœåŠ¡çš„çœŸæ­£"åº“å­˜"æ˜¯æ ¹æ®æŠ€å¸ˆæ’ç­è¡¨å®æ—¶è®¡ç®—çš„ï¼Œè¿™ä¸ªå­—æ®µä»…åšç¡¬æ€§ä¸Šé™)
  stock Int @default(0)

  isActive Boolean @default(true) // æ¯”å¦‚è¿™å®¶åº—"çº¢è‰²"å–å®Œäº†ï¼Œå¯ä»¥å•ç‹¬ä¸‹æ¶è¿™ä¸ªSKU

  // --- [æ–°å¢] é—¨åº—å®é™…åˆ†ä½£é…ç½® ---
  // é—¨åº—æœ‰æƒä¿®æ”¹è¿™ä¸ªæ¯”ä¾‹ (é€šå¸¸ä¸èƒ½ä½äºæ€»éƒ¨è®¾å®šçš„åº•çº¿ï¼Œåç«¯å¯åšæ ¡éªŒ)
  distMode DistributionMode @default(RATIO) @map("dist_mode")

  // å®é™…æ‰§è¡Œæ¯”ä¾‹ (ä¾‹å¦‚æ€»éƒ¨å»ºè®® 10%ï¼Œé—¨åº—æƒ³å¤šæ¨é”€ï¼Œè®¾ä¸º 15%)
  distRate Decimal @default(0.00) @map("dist_rate") @db.Decimal(10, 2)

  // --- [æ–°å¢] å…‘æ¢å•†å“æ ‡è¯† ---
  // æ ‡è¯†è¯¥å•†å“æ˜¯å¦ä¸ºå…‘æ¢å•†å“ï¼ˆä¼˜æƒ åˆ¸/ç§¯åˆ†å…¨é¢å…‘æ¢ï¼Œä¸å‚ä¸åˆ†ä½£ï¼‰
  isExchangeProduct Boolean @default(false) @map("is_exchange_product")

  // --- [æ–°å¢] ä¹è§‚é”ç‰ˆæœ¬å· ---
  // ç”¨äºé˜²æ­¢å¹¶å‘æ›´æ–°å†²çª,æ¯æ¬¡æ›´æ–°æ—¶è‡ªåŠ¨+1
  version Int @default(0)

  // --- [æ–°å¢] ç§¯åˆ†é…ç½® ---
  // ç§¯åˆ†è·å¾—æ¯”ä¾‹ï¼ˆ0-100ï¼Œé»˜è®¤100è¡¨ç¤ºæ­£å¸¸è·å¾—ç§¯åˆ†ï¼Œ0è¡¨ç¤ºä¸äº§ç”Ÿç§¯åˆ†ï¼‰
  pointsRatio Int @default(100) @map("points_ratio")
  
  // æ˜¯å¦è¥é”€æ´»åŠ¨å•†å“
  isPromotionProduct Boolean @default(false) @map("is_promotion_product")

  tenantProd PmsTenantProduct @relation(fields: [tenantProductId], references: [id])

  @@map("pms_tenant_sku")
}

enum DistributionMode {
  RATIO // æŒ‰æ¯”ä¾‹ (å¦‚: é”€å”®é¢çš„ 10%)
  FIXED // æŒ‰å›ºå®šé‡‘é¢ (å¦‚: æ¯å•å›ºå®šåˆ† 10 å…ƒ)
  NONE // ä¸å‚ä¸åˆ†é”€ (å¦‚: ç‰¹ä»·å¼•æµå“)
}

/// ä½£é‡‘è®¡ç®—åŸºæ•°ç±»å‹
enum CommissionBaseType {
  ORIGINAL_PRICE // åŸºäºå•†å“åŸä»·ï¼ˆä¼˜æƒ ç”±å¹³å°æ‰¿æ‹…ï¼‰
  ACTUAL_PAID // åŸºäºå®ä»˜é‡‘é¢ï¼ˆä¼˜æƒ ç”±æ¨å¹¿è€…æ‰¿æ‹…ï¼‰
  ZERO // ä¸åˆ†ä½£ï¼ˆå…‘æ¢å•†å“ï¼‰
}

/// Cç«¯ä¼šå‘˜è¡¨ (ä¸€åˆ‡ä¸šåŠ¡çš„æºå¤´)
model UmsMember {
  memberId String @id @default(uuid()) @map("member_id")
  tenantId String @default("000000") @map("tenant_id") // å½’å±ç§Ÿæˆ·

  // --- åŸºç¡€ä¿¡æ¯ ---
  nickname String? @db.VarChar(64)
  avatar   String? @db.VarChar(500)
  mobile   String? @unique @db.VarChar(20)
  password String? @db.VarChar(200)

  // --- çŠ¶æ€ä¸ç­‰çº§ ---
  status  MemberStatus @default(NORMAL)
  levelId Int          @default(0) @map("level_id") // 0=Cæ™®é€š, 1=C1å›¢é•¿, 2=C2è‚¡ä¸œ

  // --- é’±åŒ…èµ„äº§ (åˆ†é”€æ ¸å¿ƒ) ---
  balance       Decimal @default(0.00) @db.Decimal(10, 2) // å¯æç°ä½™é¢
  frozenBalance Decimal @default(0.00) @db.Decimal(10, 2) // å†»ç»“ä½™é¢
  points        Int     @default(0) // ç§¯åˆ†

  // --- ä¸‰çº§åˆ†é”€å…³ç³»é“¾ ---
  parentId         String? @map("parent_id") // ç›´æ¥ä¸Šçº§ (C1æˆ–C2)
  indirectParentId String? @map("indirect_parent_id") // é—´æ¥ä¸Šçº§ (C2)
  referralCode     String? @unique @map("referral_code") // æ¨èç  (ä»…C2, æ ¼å¼: T001-XXXX)

  // --- å‡çº§ä¿¡æ¯ ---
  upgradedAt     DateTime? @map("upgraded_at") // å‡çº§æ—¶é—´
  upgradeOrderId String?   @map("upgrade_order_id") // é€šè¿‡è´­ä¹°å‡çº§æ—¶çš„è®¢å•ID

  // --- æ—¶é—´ ---
  createTime DateTime @default(now()) @map("create_time")
  updateTime DateTime @updatedAt @map("update_time")

  // --- åˆ†é”€å…³è” ---
  parent         UmsMember?  @relation("ParentChild", fields: [parentId], references: [memberId])
  directChildren UmsMember[] @relation("ParentChild") // æˆ‘çš„ç›´æ¥ä¸‹çº§

  indirectParent   UmsMember?  @relation("IndirectParentChild", fields: [indirectParentId], references: [memberId])
  indirectChildren UmsMember[] @relation("IndirectParentChild") // æˆ‘çš„é—´æ¥ä¸‹çº§

  socials         SysSocialUser[]
  workers         SrvWorker[] // 1:N æŠ€å¸ˆå…³è” (å¤šç§Ÿæˆ·å…¼èŒ)
  sysRegionAgents SysRegionAgent[]
  umsAddresses    UmsAddress[]

  // --- è´¢åŠ¡å…³è” ---
  wallet      FinWallet?
  commissions FinCommission[]
  withdrawals FinWithdrawal[]

  @@index([mobile])
  @@index([parentId])
  @@index([indirectParentId])
  @@index([tenantId, levelId])
  @@map("ums_member")
}

/// ä¼šå‘˜å‡çº§ç”³è¯·è¡¨
model UmsUpgradeApply {
  id       String @id @default(cuid())
  tenantId String @map("tenant_id") @db.VarChar(20)
  memberId String @map("member_id")

  fromLevel Int @map("from_level") // åŸç­‰çº§ (0/1)
  toLevel   Int @map("to_level") // ç›®æ ‡ç­‰çº§ (1/2)

  applyType    String  @map("apply_type") // PRODUCT_PURCHASE / REFERRAL_CODE
  referralCode String? @map("referral_code") // æ‰«ç ç”³è¯·æ—¶çš„æ¨èç 
  orderId      String? @map("order_id") // è´­ä¹°å‡çº§å•†å“æ—¶çš„è®¢å•ID
  referrerId   String? @map("referrer_id") // æ¨èäººID (ä»æ¨èç è§£æ)

  status       String    @default("PENDING") // PENDING / APPROVED / REJECTED
  reviewBy     String?   @map("review_by")
  reviewTime   DateTime? @map("review_time")
  reviewRemark String?   @map("review_remark") @db.VarChar(500)

  createTime DateTime @default(now()) @map("create_time")

  @@index([tenantId, memberId])
  @@index([status])
  @@map("ums_upgrade_apply")
}

/// C2æ¨èç è¡¨ (å¸¦ç§Ÿæˆ·å‰ç¼€: T001-XXXX)
model UmsReferralCode {
  id       String @id @default(cuid())
  tenantId String @map("tenant_id") @db.VarChar(20)
  memberId String @map("member_id") // å½’å±äºº (ä»…C2å¯æœ‰)

  code      String  @unique // æ ¼å¼: T001-XXXX
  qrCodeUrl String? @map("qr_code_url") @db.VarChar(500) // å°ç¨‹åºç URL

  usageCount Int     @default(0) @map("usage_count") // ä½¿ç”¨æ¬¡æ•°
  isActive   Boolean @default(true) @map("is_active")

  createTime DateTime @default(now()) @map("create_time")

  @@unique([tenantId, memberId])
  @@index([code])
  @@map("ums_referral_code")
}

/// ç¤¾äº¤è´¦å·ç»‘å®šè¡¨
model SysSocialUser {
  socialId String @id @default(uuid()) @map("social_id")
  memberId String @map("member_id")

  platform SocialPlatform // å¹³å°æ ‡è¯†

  openid  String  @db.VarChar(64)
  unionid String? @db.VarChar(64) // è·¨ç«¯è¯†åˆ«å…³é”®

  nickname   String?
  avatar     String?
  sessionKey String? @map("session_key")

  member UmsMember @relation(fields: [memberId], references: [memberId])

  @@unique([platform, openid])
  @@index([memberId])
  @@index([unionid])
  @@map("sys_social_user")
}

/// ç”¨æˆ·æ”¶è´§åœ°å€è¡¨
model UmsAddress {
  id       String @id @default(uuid())
  memberId String @map("member_id")

  // æ”¶è´§äººä¿¡æ¯
  name  String @db.VarChar(50) // æ”¶è´§äººå§“å
  phone String @db.VarChar(20) // è”ç³»ç”µè¯

  // åœ°å€ä¿¡æ¯ (çœå¸‚åŒº + è¯¦ç»†åœ°å€)
  province String @db.VarChar(50) // çœ
  city     String @db.VarChar(50) // å¸‚
  district String @db.VarChar(50) // åŒº/å¿
  detail   String @db.VarChar(500) // è¯¦ç»†åœ°å€

  // LBS å®šä½ä¿¡æ¯ (å¯é€‰ï¼Œç”¨äºæœåŠ¡èŒƒå›´æ ¡éªŒ)
  latitude  Float? // çº¬åº¦
  longitude Float? // ç»åº¦

  // æ ‡è¯†
  isDefault Boolean @default(false) @map("is_default") // æ˜¯å¦é»˜è®¤åœ°å€
  tag       String? @db.VarChar(20) // æ ‡ç­¾: å®¶ã€å…¬å¸ã€å­¦æ ¡

  createTime DateTime @default(now()) @map("create_time")
  updateTime DateTime @updatedAt @map("update_time")

  member UmsMember @relation(fields: [memberId], references: [memberId])

  @@index([memberId])
  @@map("ums_address")
}

// ==========================================
// ğŸ“Œ åŠ³åŠ¨è€…/æŠ€å¸ˆæ ¸å¿ƒ (Service Worker)
// ==========================================

/// åŠ³åŠ¨è€…ä¸»è¡¨ (é«˜é¢‘è®¿é—®æ ¸å¿ƒè¡¨)
model SrvWorker {
  workerId Int    @id @default(autoincrement()) @map("worker_id")
  memberId String @map("member_id") // å…³è”Cç«¯è´¦å·
  tenantId String @map("tenant_id") // å½’å±åˆ†å…¬å¸

  // --- æ ¸å¿ƒå±•ç¤º ---
  name     String  @db.VarChar(50)
  nickName String? @map("nick_name")
  avatar   String? @db.VarChar(500)
  phone    String  @db.VarChar(20)

  // --- ä¸šåŠ¡çŠ¶æ€ ---
  status      WorkerStatus @default(WORKING)
  auditStatus AuditStatus  @default(PENDING) @map("audit_status")
  isOnline    Boolean      @default(true) @map("is_online") // æ¥å•å¼€å…³

  // --- LBS æ´¾å•æ ¸å¿ƒ (æ–°å¢) ---
  currentLat    Float? @map("current_lat") // å®æ—¶çº¬åº¦ (Redisä¹Ÿä¼šå­˜ï¼Œè¿™é‡Œå­˜æœ€åä¸€æ¬¡)
  currentLng    Float? @map("current_lng") // å®æ—¶ç»åº¦
  serviceRadius Int    @default(5000) @map("service_radius") // æœåŠ¡åŠå¾„(ç±³)

  // --- è–ªèµ„é…ç½® (æ–°å¢ - ç”¨äºç®—å·¥èµ„) ---
  wageType WageType @default(HOURLY) @map("wage_type")
  baseWage Decimal  @default(0.00) @map("base_wage") @db.Decimal(10, 2) // æ—¶è–ªæˆ–åˆ†æˆæ¯”ä¾‹

  // --- æƒé‡æ•°æ® ---
  rating     Decimal     @default(5.0) @db.Decimal(2, 1)
  orderCount Int         @default(0) @map("order_count")
  seniority  WorkerLevel @default(PRIMARY)
  tags       Json? // ["æ“…é•¿æ”¶çº³", "è‡ªå¸¦å·¥å…·"]

  createTime DateTime @default(now()) @map("create_time")
  updateTime DateTime @updatedAt @map("update_time")

  // --- å…³è” ---
  member UmsMember @relation(fields: [memberId], references: [memberId])

  profile   SrvWorkerProfile?
  certs     SrvWorkerCert[]
  skills    SrvWorkerSkill[]
  works     SrvWorkerWork[]
  schedules SrvWorkerSchedule[] // æ’ç­è®°å½•

  @@unique([memberId, tenantId])
  @@index([tenantId, status]) // ç§Ÿæˆ·ç­›é€‰+çŠ¶æ€ç­›é€‰
  @@index([phone])
  @@map("srv_worker")
}

/// åŠ³åŠ¨è€…è¯¦ç»†æ¡£æ¡ˆ (éšç§/ä½é¢‘ä¿¡æ¯)
model SrvWorkerProfile {
  profileId Int @id @default(autoincrement()) @map("profile_id")
  workerId  Int @unique @map("worker_id")

  // --- éšç§ä¿¡æ¯ (éœ€åŠ å¯†) ---
  idCard      String? @map("id_card") @db.VarChar(20)
  idCardFront String? @map("id_card_front") @db.VarChar(500)
  idCardBack  String? @map("id_card_back") @db.VarChar(500)

  // --- åŸºç¡€ç”»åƒ ---
  gender        Gender  @default(UNKNOWN)
  age           Int?
  nativePlace   String? @map("native_place")
  education     String? @db.VarChar(20)
  startWorkYear Int?    @map("start_work_year")

  // --- èº«ä½“çŠ¶å†µ ---
  height     Int?
  weight     Int?
  healthInfo String? @map("health_info")

  // --- ä»‹ç» ---
  intro      String? @db.Text
  voiceIntro String? @map("voice_intro")
  videoIntro String? @map("video_intro")

  // --- ç»“ç®—è´¦æˆ· ---
  bankName String? @map("bank_name")
  bankNo   String? @map("bank_no")

  worker SrvWorker @relation(fields: [workerId], references: [workerId])

  @@map("srv_worker_profile")
}

/// åŠ³åŠ¨è€…è¯ä¹¦
model SrvWorkerCert {
  certId   Int @id @default(autoincrement()) @map("cert_id")
  workerId Int @map("worker_id")

  name   String  @db.VarChar(50)
  certNo String? @map("cert_no")
  images Json?

  issueDate  DateTime? @map("issue_date")
  expireDate DateTime? @map("expire_date") // è¿‡æœŸéœ€æé†’

  isVerified Boolean @default(false) @map("is_verified")

  worker SrvWorker @relation(fields: [workerId], references: [workerId])

  @@index([workerId])
  @@map("srv_worker_cert")
}

/// åŠ³åŠ¨è€…æŠ€èƒ½ (å…³è”å•†å“åˆ†ç±»)
model SrvWorkerSkill {
  id       Int @id @default(autoincrement())
  workerId Int @map("worker_id")

  categoryId Int    @map("cat_id") // æ ¸å¿ƒï¼šå…³è”å•†å“åˆ†ç±»IDï¼Œå†³å®šèƒ½æ¥ä»€ä¹ˆå•
  skillName  String @map("skill_name")

  level SkillLevel @default(GENERAL)

  worker SrvWorker @relation(fields: [workerId], references: [workerId])

  @@unique([workerId, categoryId])
  @@map("srv_worker_skill")
}

/// åŠ³åŠ¨è€…ä½œå“æ¡ˆä¾‹
model SrvWorkerWork {
  workId   Int @id @default(autoincrement()) @map("work_id")
  workerId Int @map("worker_id")

  title       String  @db.VarChar(100)
  description String? @db.Text

  mediaType MediaType @default(IMAGE)
  mediaUrls Json

  workDate DateTime? @map("work_date")

  worker SrvWorker @relation(fields: [workerId], references: [workerId])

  @@index([workerId])
  @@map("srv_worker_work")
}

// ==========================================
// ğŸ“Œ [æ–°å¢] åŠ³åŠ¨è€…æ’ç­/æ—¥ç¨‹è¡¨
// ==========================================
// ç”¨äºè§£å†³: "è¿™ä¸ªæŠ€å¸ˆæ˜å¤©ä¸‹åˆ2ç‚¹æœ‰æ²¡æœ‰ç©º?"

model SrvWorkerSchedule {
  id       BigInt @id @default(autoincrement()) // æ•°æ®é‡å¤§ï¼Œç”¨BigInt
  workerId Int    @map("worker_id")

  // æ—¥æœŸ (YYYY-MM-DD)
  date DateTime @db.Date

  // æ—¶é—´æ®µ (0-23 æˆ–è€… 0-47 åŠå°æ—¶åˆ¶)
  // ç®€å•åšæ³•: å­˜JSON ["09:00-10:00", "14:00-16:00"] è¡¨ç¤ºè¢«å ç”¨çš„æ—¶é—´
  // é«˜çº§åšæ³•: BitMap æˆ– 48ä¸ª 0/1 å­—æ®µ
  busySlots Json @map("busy_slots")

  // å½“å¤©çŠ¶æ€
  status String @default("OPEN") // OPEN:å¯æ¥å•, FULL:çº¦æ»¡, OFF:ä¼‘æ¯

  worker SrvWorker @relation(fields: [workerId], references: [workerId])

  @@unique([workerId, date]) // ä¸€ä¸ªæŠ€å¸ˆä¸€å¤©åªæœ‰ä¸€æ¡è®°å½•
  @@map("srv_worker_schedule")
}

// ==================== ç§Ÿæˆ·ç›¸å…³è¡¨ ====================

/// ç§Ÿæˆ·è¡¨
model SysTenant {
  id              Int       @id @default(autoincrement())
  tenantId        String    @unique @map("tenant_id") @db.VarChar(20)
  contactUserName String?   @map("contact_user_name") @db.VarChar(50)
  contactPhone    String?   @map("contact_phone") @db.VarChar(20)
  companyName     String    @map("company_name") @db.VarChar(100)
  licenseNumber   String?   @map("license_number") @db.VarChar(50)
  address         String?   @db.VarChar(200)
  intro           String?   @db.Text
  domain          String?   @db.VarChar(100)
  packageId       Int?      @map("package_id")
  expireTime      DateTime? @map("expire_time") @db.Timestamp(6)
  accountCount    Int       @default(-1) @map("account_count")
  storageQuota    Int       @default(10240) @map("storage_quota") // å­˜å‚¨é…é¢(MB)ï¼Œé»˜è®¤10GB
  storageUsed     Int       @default(0) @map("storage_used") // å·²ä½¿ç”¨å­˜å‚¨(MB)
  status          Status    @default(NORMAL)
  delFlag         DelFlag   @default(NORMAL) @map("del_flag")
  createBy        String    @default("") @map("create_by") @db.VarChar(64)
  createTime      DateTime? @default(dbgenerated("CURRENT_TIMESTAMP")) @map("create_time") @db.Timestamp(6)
  updateBy        String    @default("") @map("update_by") @db.VarChar(64)
  updateTime      DateTime? @default(dbgenerated("CURRENT_TIMESTAMP")) @map("update_time") @db.Timestamp(6)
  remark          String?   @db.VarChar(500)

  // --- [æ–°å¢] O2O æ ¸å¿ƒå­—æ®µ ---
  regionCode String? @map("region_code") // è¡Œæ”¿å½’å±
  isDirect   Boolean @default(true) @map("is_direct") // ç›´è¥/åŠ ç›Ÿ

  // å…³è”
  geoConfig SysTenantGeo?
  orders    OmsOrder[]

  @@index([delFlag])
  @@map("sys_tenant")
}

/// [æ–°å¢] ç§Ÿæˆ·åœ°ç†é…ç½®è¡¨ (ä¸€å¯¹ä¸€)
model SysTenantGeo {
  id       Int    @id @default(autoincrement())
  tenantId String @unique @map("tenant_id")

  // --- LBS ç»è¥å±æ€§ ---
  address       String?
  latitude      Float?
  longitude     Float?
  serviceRadius Int     @default(3000) @map("service_radius")

  // å¤æ‚çš„å›´æ æ•°æ®
  geoFence Json? @map("geo_fence")

  tenant SysTenant @relation(fields: [tenantId], references: [tenantId])

  @@map("sys_tenant_geo")
}

/// [æ–°å¢] åŒºåŸŸä»£ç†å•†è¡¨ (O2O åˆ†é”€)
model SysRegionAgent {
  agentId  Int    @id @default(autoincrement()) @map("agent_id")
  tenantId String @map("tenant_id") @db.VarChar(20)

  // --- 1. èº«ä»½å®šä¹‰ ---
  regionCode String @map("region_code") // ç‹¬å®¶ç›˜å£ "430103"
  agentName  String @map("agent_name") // ä»£ç†å•†åç§° (å¦‚: "é•¿æ²™èšåŠ›æœ‰é™å…¬å¸" æˆ– "ç‹æ€»")
  phone      String @map("phone") // è”ç³»ç”µè¯ (ç”¨äºé€šçŸ¥)

  // --- 2. å…³è” C ç«¯è´¦å· (å˜ä¸ºå¯é€‰) ---
  // å¦‚æœè¿™ä¸ªä»£ç†å•†æƒ³åœ¨ App ä¸Šçœ‹æŠ¥è¡¨ï¼Œå°±ç»‘å®šä¸€ä¸ªè´¦å·ï¼›
  // å¦‚æœä»–åªç­‰ç€æ¯æœˆæ”¶é’±ï¼Œå®Œå…¨ä¸ç”¨ Appï¼Œè¿™é‡Œå°±æ˜¯ nullã€‚
  memberId String? @map("member_id")

  // --- 3. åˆ©ç›Šåˆ†é… ---
  level Int     @default(3) // 1:çœ 2:å¸‚ 3:åŒº
  rate  Decimal @db.Decimal(5, 4) // åˆ†çº¢æ¯”ä¾‹ 0.05

  // --- 4. ç‹¬ç«‹çš„ B ç«¯ç»“ç®—æ¡£æ¡ˆ (æ ¸å¿ƒ) ---
  settleType  SettleType @default(BANK) // BANK:é“¶è¡Œè½¬è´¦, WALLET:é’±åŒ…
  bankName    String?    @map("bank_name") // å¼€æˆ·è¡Œ (æ‹›å•†é“¶è¡Œé•¿æ²™åˆ†è¡Œ)
  accountName String?    @map("account_name") // æˆ·å (å¼ ä¸‰ / xxå…¬å¸)
  accountNo   String?    @map("account_no") // å¡å·

  // --- 5. ç‹¬ç«‹çš„ B ç«¯è´¦æœ¬ ---
  // ä»£ç†å•†çš„é’±ä¸è¿› Member é’±åŒ…ï¼Œåœ¨è¿™é‡Œå•ç‹¬ç»Ÿè®¡
  totalIncome   Decimal @default(0.00) @map("total_income") // ç´¯è®¡æ€»æ”¶ç›Š
  pendingSettle Decimal @default(0.00) @map("pending_settle") // å¾…ç»“ç®—é‡‘é¢ (ä¸Šä¸ªæœˆèµšçš„ï¼Œè¿˜æ²¡æ‰“æ¬¾)
  alreadySettle Decimal @default(0.00) @map("already_settle") // å·²æ‰“æ¬¾é‡‘é¢

  createTime DateTime @default(now())

  // å…³è” (å¯é€‰)
  member UmsMember? @relation(fields: [memberId], references: [memberId])

  @@unique([tenantId, regionCode])
  @@map("sys_region_agent")
}

/// ç§Ÿæˆ·å¥—é¤è¡¨
model SysTenantPackage {
  packageId         Int       @id @default(autoincrement()) @map("package_id")
  packageName       String    @map("package_name") @db.VarChar(50)
  menuIds           String?   @map("menu_ids") @db.Text
  menuCheckStrictly Boolean   @default(false) @map("menu_check_strictly")
  status            Status    @default(NORMAL)
  delFlag           DelFlag   @default(NORMAL) @map("del_flag")
  createBy          String    @default("") @map("create_by") @db.VarChar(64)
  createTime        DateTime? @default(dbgenerated("CURRENT_TIMESTAMP")) @map("create_time") @db.Timestamp(6)
  updateBy          String    @default("") @map("update_by") @db.VarChar(64)
  updateTime        DateTime? @default(dbgenerated("CURRENT_TIMESTAMP")) @map("update_time") @db.Timestamp(6)
  remark            String?   @db.VarChar(500)

  @@index([delFlag])
  @@map("sys_tenant_package")
}

/// å®¢æˆ·ç«¯è¡¨
model SysClient {
  id            Int       @id @default(autoincrement())
  clientId      String    @unique @map("client_id") @db.VarChar(64)
  clientKey     String    @map("client_key") @db.VarChar(64)
  clientSecret  String    @map("client_secret") @db.VarChar(255)
  grantTypeList String?   @map("grant_type_list") @db.VarChar(255)
  deviceType    String?   @map("device_type") @db.VarChar(20)
  activeTimeout Int       @default(1800) @map("active_timeout")
  timeout       Int       @default(86400)
  status        Status    @default(NORMAL)
  delFlag       DelFlag   @default(NORMAL) @map("del_flag")
  createBy      String    @default("") @map("create_by") @db.VarChar(64)
  createTime    DateTime? @default(dbgenerated("CURRENT_TIMESTAMP")) @map("create_time") @db.Timestamp(6)
  updateBy      String    @default("") @map("update_by") @db.VarChar(64)
  updateTime    DateTime? @default(dbgenerated("CURRENT_TIMESTAMP")) @map("update_time") @db.Timestamp(6)

  @@index([delFlag])
  @@map("sys_client")
}

// ==================== LBS ä½ç½®æœåŠ¡æ¨¡å— ====================

/// è¡Œæ”¿åŒºåˆ’è¡¨ (æ ‡å‡†æ•°æ®)
model SysRegion {
  code     String  @id @map("code") @db.VarChar(20) // è¡Œæ”¿åŒºåˆ’ä»£ç  (å¦‚ 110101)
  name     String  @map("name") @db.VarChar(100) // åç§° (å¦‚ ä¸œåŸåŒº)
  parentId String? @map("parent_id") @db.VarChar(20) // çˆ¶çº§ä»£ç 
  level    Int     @default(0) // å±‚çº§ (1:çœ 2:å¸‚ 3:åŒº 4:è¡—é“)

  // ä¸­å¿ƒç‚¹åæ ‡ (å¯é€‰ï¼Œç”¨äºå‰ç«¯åœ°å›¾å®šä½)
  latitude  Float?
  longitude Float?

  parent   SysRegion?  @relation("RegionChildren", fields: [parentId], references: [code])
  children SysRegion[] @relation("RegionChildren")

  @@index([parentId])
  @@map("sys_region")
}

/// ç½‘ç«™/ç«™ç‚¹è¡¨ (ç§Ÿæˆ·ç½‘ç‚¹)
model SysStation {
  stationId Int    @id @default(autoincrement()) @map("station_id")
  tenantId  String @map("tenant_id") @db.VarChar(20)

  name    String  @db.VarChar(100)
  address String? @db.VarChar(500)

  // å±•ç¤ºç”¨åæ ‡ (WGS84)
  latitude  Float?
  longitude Float?

  status     Status   @default(NORMAL)
  createBy   String   @default("") @map("create_by") @db.VarChar(64)
  createTime DateTime @default(now()) @map("create_time")
  updateBy   String   @default("") @map("update_by") @db.VarChar(64)
  updateTime DateTime @updatedAt @map("update_time")

  // å…³è”å›´æ 
  fences SysGeoFence[]

  @@index([tenantId])
  @@map("sys_station")
}

/// ç”µå­å›´æ è¡¨ (æ ¸å¿ƒ GIS è¡¨)
model SysGeoFence {
  fenceId   Int @id @default(autoincrement()) @map("fence_id")
  stationId Int @map("station_id")

  // å›´æ ç±»å‹: SERVICE(æœåŠ¡åŒº), BLOCK(ç¦è¡ŒåŒº)
  type String @default("SERVICE") @db.VarChar(20)

  // æ ¸å¿ƒ GIS æ•°æ®: å¤šè¾¹å½¢
  // æ³¨æ„: Prisma ä¸æ”¯æŒ Geometry ç±»å‹ï¼Œéœ€ä½¿ç”¨ Unsupported
  // å®é™…ç±»å‹: geometry(Polygon, 4326)
  geom Unsupported("geometry")?

  // æ‰©å±•é…ç½® (å¦‚: è¯¥åŒºåŸŸé…é€è´¹)
  config Json?

  station SysStation @relation(fields: [stationId], references: [stationId], onDelete: Cascade)

  @@index([stationId])
  @@map("sys_geo_fence")
}

// ==================== ä¸šåŠ¡è¡¨ ====================

model GenTable {
  tableId        Int       @id @default(autoincrement()) @map("table_id")
  tableName      String    @map("table_name") @db.VarChar(200)
  tableComment   String    @map("table_comment") @db.VarChar(500)
  subTableName   String?   @map("sub_table_name") @db.VarChar(64)
  subTableFkName String?   @map("sub_table_fk_name") @db.VarChar(64)
  className      String    @map("class_name") @db.VarChar(100)
  tplCategory    String    @map("tpl_category") @db.VarChar(200)
  tplWebType     String    @map("tpl_web_type") @db.VarChar(30)
  packageName    String    @map("package_name") @db.VarChar(100)
  moduleName     String    @map("module_name") @db.VarChar(30)
  businessName   String    @map("business_name") @db.VarChar(30)
  functionName   String    @map("function_name") @db.VarChar(50)
  functionAuthor String    @map("function_author") @db.VarChar(50)
  genType        String    @map("gen_type") @db.Char(1)
  genPath        String    @map("gen_path") @db.VarChar(200)
  options        String    @db.VarChar(1000)
  status         Status
  delFlag        DelFlag   @map("del_flag")
  createBy       String    @map("create_by") @db.VarChar(64)
  createTime     DateTime? @default(dbgenerated("CURRENT_TIMESTAMP")) @map("create_time") @db.Timestamp(6)
  updateBy       String    @map("update_by") @db.VarChar(64)
  updateTime     DateTime? @default(dbgenerated("CURRENT_TIMESTAMP")) @map("update_time") @db.Timestamp(6)
  remark         String?   @db.VarChar(500)

  columns GenTableColumn[]

  @@index([delFlag])
  @@map("gen_table")
}

model GenTableColumn {
  columnId      Int       @id @default(autoincrement()) @map("column_id")
  tableId       Int       @map("table_id")
  columnName    String    @map("column_name") @db.VarChar(200)
  columnComment String    @map("column_comment") @db.VarChar(500)
  columnType    String    @map("column_type") @db.VarChar(100)
  javaType      String    @map("java_type") @db.VarChar(500)
  javaField     String    @map("java_field") @db.VarChar(200)
  isPk          String    @map("is_pk") @db.Char(1)
  isIncrement   String    @map("is_increment") @db.Char(1)
  isRequired    String    @map("is_required") @db.Char(1)
  isInsert      String    @map("is_insert") @db.Char(1)
  isEdit        String?   @map("is_edit") @db.Char(1)
  isList        String?   @map("is_list") @db.Char(1)
  isQuery       String?   @map("is_query") @db.Char(1)
  queryType     String    @map("query_type") @db.VarChar(200)
  htmlType      String    @map("html_type") @db.VarChar(200)
  dictType      String    @map("dict_type") @db.VarChar(200)
  columnDefault String?   @map("column_default") @db.VarChar(200)
  sort          Int       @db.Integer
  status        Status
  delFlag       DelFlag   @map("del_flag")
  createBy      String    @map("create_by") @db.VarChar(64)
  createTime    DateTime? @default(dbgenerated("CURRENT_TIMESTAMP")) @map("create_time") @db.Timestamp(6)
  updateBy      String    @map("update_by") @db.VarChar(64)
  updateTime    DateTime? @default(dbgenerated("CURRENT_TIMESTAMP")) @map("update_time") @db.Timestamp(6)
  remark        String?   @db.VarChar(500)

  table GenTable @relation(fields: [tableId], references: [tableId], onDelete: Cascade)

  @@index([delFlag])
  @@map("gen_table_column")
}

/// ç³»ç»Ÿçº§é…ç½®è¡¨ï¼ˆå…¨å±€ï¼Œæ— ç§Ÿæˆ·éš”ç¦»ï¼‰
model SysSystemConfig {
  configId    Int       @id @default(autoincrement()) @map("config_id")
  configName  String    @map("config_name") @db.VarChar(100)
  configKey   String    @unique @map("config_key") @db.VarChar(100)
  configValue String    @map("config_value") @db.VarChar(500)
  configType  String    @map("config_type") @db.Char(1)
  createBy    String    @default("") @map("create_by") @db.VarChar(64)
  createTime  DateTime? @default(dbgenerated("CURRENT_TIMESTAMP")) @map("create_time") @db.Timestamp(6)
  updateBy    String    @default("") @map("update_by") @db.VarChar(64)
  updateTime  DateTime? @default(dbgenerated("CURRENT_TIMESTAMP")) @map("update_time") @db.Timestamp(6)
  remark      String?   @db.VarChar(500)
  status      Status    @default(NORMAL)
  delFlag     DelFlag   @default(NORMAL) @map("del_flag")

  @@index([status])
  @@index([configType])
  @@index([delFlag, status])
  @@index([createTime])
  @@index([delFlag])
  @@map("sys_system_config")
}

/// ç§Ÿæˆ·çº§é…ç½®è¡¨ï¼ˆå¤šç§Ÿæˆ·éš”ç¦»ï¼‰
model SysConfig {
  configId    Int       @id @default(autoincrement()) @map("config_id")
  tenantId    String    @default("000000") @map("tenant_id") @db.VarChar(20)
  configName  String    @map("config_name") @db.VarChar(100)
  configKey   String    @map("config_key") @db.VarChar(100)
  configValue String    @map("config_value") @db.VarChar(500)
  configType  String    @map("config_type") @db.Char(1)
  createBy    String    @default("") @map("create_by") @db.VarChar(64)
  createTime  DateTime? @default(dbgenerated("CURRENT_TIMESTAMP")) @map("create_time") @db.Timestamp(6)
  updateBy    String    @default("") @map("update_by") @db.VarChar(64)
  updateTime  DateTime? @default(dbgenerated("CURRENT_TIMESTAMP")) @map("update_time") @db.Timestamp(6)
  remark      String?   @db.VarChar(500)
  status      Status    @default(NORMAL)
  delFlag     DelFlag   @default(NORMAL) @map("del_flag")

  @@unique([tenantId, configKey], name: "unique_tenant_config_key")
  @@index([tenantId, status])
  @@index([tenantId, configType])
  @@index([tenantId, delFlag, status])
  @@index([configKey])
  @@index([createTime])
  @@index([delFlag])
  @@map("sys_config")
}

model SysDept {
  deptId     Int       @id @default(autoincrement()) @map("dept_id")
  tenantId   String    @default("000000") @map("tenant_id") @db.VarChar(20)
  parentId   Int       @map("parent_id")
  ancestors  String    @db.VarChar(50)
  deptName   String    @map("dept_name") @db.VarChar(30)
  orderNum   Int       @map("order_num")
  leader     String    @default("") @db.VarChar(20)
  phone      String    @default("") @db.VarChar(11)
  email      String    @default("") @db.VarChar(50)
  status     Status    @default(NORMAL)
  delFlag    DelFlag   @default(NORMAL) @map("del_flag")
  createBy   String    @default("") @map("create_by") @db.VarChar(64)
  createTime DateTime? @default(dbgenerated("CURRENT_TIMESTAMP")) @map("create_time") @db.Timestamp(6)
  updateBy   String    @default("") @map("update_by") @db.VarChar(64)
  updateTime DateTime? @default(dbgenerated("CURRENT_TIMESTAMP")) @map("update_time") @db.Timestamp(6)
  users      SysUser[]
  remark     String?   @db.VarChar(500)

  @@index([tenantId, status])
  @@index([tenantId, parentId])
  @@index([status])
  @@index([tenantId, delFlag, status])
  @@index([parentId])
  @@index([delFlag])
  @@map("sys_dept")
}

model SysDictData {
  dictCode   Int       @id @default(autoincrement()) @map("dict_code")
  tenantId   String    @default("000000") @map("tenant_id") @db.VarChar(20)
  dictSort   Int       @default(0) @map("dict_sort")
  dictLabel  String    @map("dict_label") @db.VarChar(100)
  dictValue  String    @map("dict_value") @db.VarChar(100)
  dictType   String    @map("dict_type") @db.VarChar(100)
  cssClass   String    @default("") @map("css_class") @db.VarChar(100)
  listClass  String    @default("") @map("list_class") @db.VarChar(100)
  isDefault  String    @default("N") @map("is_default") @db.Char(1)
  status     Status    @default(NORMAL)
  createBy   String    @default("") @map("create_by") @db.VarChar(64)
  createTime DateTime? @default(dbgenerated("CURRENT_TIMESTAMP")) @map("create_time") @db.Timestamp(6)
  updateBy   String    @default("") @map("update_by") @db.VarChar(64)
  updateTime DateTime? @default(dbgenerated("CURRENT_TIMESTAMP")) @map("update_time") @db.Timestamp(6)
  remark     String?   @db.VarChar(500)
  delFlag    DelFlag   @default(NORMAL) @map("del_flag")

  @@unique([tenantId, dictType, dictValue], name: "unique_tenant_dict_data")
  @@index([tenantId, dictType, status])
  @@index([dictType])
  @@index([delFlag])
  @@map("sys_dict_data")
}

model SysDictType {
  dictId     Int       @id @default(autoincrement()) @map("dict_id")
  tenantId   String    @default("000000") @map("tenant_id") @db.VarChar(20)
  dictName   String    @map("dict_name") @db.VarChar(100)
  dictType   String    @map("dict_type") @db.VarChar(100)
  status     Status    @default(NORMAL)
  createBy   String    @default("") @map("create_by") @db.VarChar(64)
  createTime DateTime? @default(dbgenerated("CURRENT_TIMESTAMP")) @map("create_time") @db.Timestamp(6)
  updateBy   String    @default("") @map("update_by") @db.VarChar(64)
  updateTime DateTime? @default(dbgenerated("CURRENT_TIMESTAMP")) @map("update_time") @db.Timestamp(6)
  remark     String?   @db.VarChar(500)
  delFlag    DelFlag   @default(NORMAL) @map("del_flag")

  @@unique([tenantId, dictType], name: "unique_tenant_dict_type")
  @@index([tenantId, status])
  @@index([dictType])
  @@index([delFlag])
  @@map("sys_dict_type")
}

model SysJob {
  jobId          Int       @id @default(autoincrement()) @map("job_id")
  tenantId       String    @default("000000") @map("tenant_id") @db.VarChar(20)
  jobName        String    @map("job_name") @db.VarChar(64)
  jobGroup       String    @map("job_group") @db.VarChar(64)
  invokeTarget   String    @map("invoke_target") @db.VarChar(500)
  cronExpression String?   @map("cron_expression") @db.VarChar(255)
  misfirePolicy  String?   @map("misfire_policy") @db.VarChar(20)
  concurrent     String?   @db.Char(1)
  status         Status?
  createBy       String    @map("create_by") @db.VarChar(64)
  createTime     DateTime? @default(dbgenerated("CURRENT_TIMESTAMP")) @map("create_time") @db.Timestamp(6)
  updateBy       String    @map("update_by") @db.VarChar(64)
  updateTime     DateTime? @default(dbgenerated("CURRENT_TIMESTAMP")) @map("update_time") @db.Timestamp(6)
  remark         String?   @db.VarChar(500)

  @@index([tenantId, status])
  @@index([invokeTarget])
  @@map("sys_job")
}

model SysJobLog {
  jobLogId      Int      @id @default(autoincrement()) @map("job_log_id")
  jobName       String   @map("job_name") @db.VarChar(64)
  jobGroup      String   @map("job_group") @db.VarChar(64)
  invokeTarget  String   @map("invoke_target") @db.VarChar(500)
  jobMessage    String?  @map("job_message") @db.VarChar(500)
  status        Status
  exceptionInfo String?  @map("exception_info") @db.VarChar(2000)
  createTime    DateTime @default(dbgenerated("CURRENT_TIMESTAMP")) @map("create_time") @db.Timestamp(6)

  @@map("sys_job_log")
}

model SysLogininfor {
  infoId        Int      @id @default(autoincrement()) @map("info_id")
  tenantId      String   @default("000000") @map("tenant_id") @db.VarChar(20)
  userName      String   @map("user_name") @db.VarChar(50)
  ipaddr        String   @db.VarChar(128)
  loginLocation String   @default("") @map("login_location") @db.VarChar(255)
  browser       String   @db.VarChar(50)
  os            String   @db.VarChar(50)
  deviceType    String   @default("0") @map("device_type") @db.Char(1)
  status        Status
  msg           String   @db.VarChar(255)
  delFlag       DelFlag  @default(NORMAL) @map("del_flag")
  loginTime     DateTime @default(dbgenerated("CURRENT_TIMESTAMP")) @map("login_time") @db.Timestamp(6)

  @@index([tenantId, loginTime])
  @@index([userName])
  @@index([status])
  @@index([loginTime])
  @@index([tenantId, userName, loginTime])
  @@index([tenantId, status, loginTime])
  @@index([delFlag])
  @@map("sys_logininfor")
}

model SysMenu {
  menuId     Int       @id @default(autoincrement()) @map("menu_id")
  tenantId   String    @default("000000") @map("tenant_id") @db.VarChar(20)
  menuName   String    @map("menu_name") @db.VarChar(50)
  parentId   Int       @map("parent_id")
  orderNum   Int       @map("order_num")
  path       String    @default("") @db.VarChar(200)
  component  String?   @db.VarChar(255)
  query      String    @default("") @db.VarChar(255)
  isFrame    String    @map("is_frame") @db.Char(1)
  isCache    String    @map("is_cache") @db.Char(1)
  menuType   String    @map("menu_type") @db.Char(1)
  visible    String    @db.Char(1)
  status     Status
  perms      String    @default("") @db.VarChar(100)
  icon       String    @default("") @db.VarChar(100)
  createBy   String    @default("") @map("create_by") @db.VarChar(64)
  createTime DateTime? @default(dbgenerated("CURRENT_TIMESTAMP")) @map("create_time") @db.Timestamp(6)
  updateBy   String    @default("") @map("update_by") @db.VarChar(64)
  updateTime DateTime? @default(dbgenerated("CURRENT_TIMESTAMP")) @map("update_time") @db.Timestamp(6)
  remark     String?   @db.VarChar(500)
  delFlag    DelFlag   @default(NORMAL) @map("del_flag")

  @@index([tenantId, status])
  @@index([tenantId, parentId])
  @@index([status])
  @@index([tenantId, delFlag, status])
  @@index([parentId, orderNum])
  @@index([delFlag])
  @@map("sys_menu")
}

model SysNotice {
  noticeId      Int       @id @default(autoincrement()) @map("notice_id")
  tenantId      String    @default("000000") @map("tenant_id") @db.VarChar(20)
  noticeTitle   String    @map("notice_title") @db.VarChar(50)
  noticeType    String    @map("notice_type") @db.Char(1)
  noticeContent String?   @map("notice_content") @db.Text
  status        Status    @default(NORMAL)
  createBy      String    @default("") @map("create_by") @db.VarChar(64)
  createTime    DateTime? @default(dbgenerated("CURRENT_TIMESTAMP")) @map("create_time") @db.Timestamp(6)
  updateBy      String    @default("") @map("update_by") @db.VarChar(64)
  updateTime    DateTime? @default(dbgenerated("CURRENT_TIMESTAMP")) @map("update_time") @db.Timestamp(6)
  delFlag       DelFlag   @default(NORMAL) @map("del_flag")
  remark        String?   @db.VarChar(500)

  @@index([tenantId, status])
  @@index([tenantId, noticeType])
  @@index([tenantId, createTime])
  @@index([tenantId, delFlag, status])
  @@index([createTime])
  @@index([delFlag])
  @@map("sys_notice")
}

model SysOperLog {
  operId        Int      @id @default(autoincrement()) @map("oper_id")
  tenantId      String   @default("000000") @map("tenant_id") @db.VarChar(20)
  title         String   @db.VarChar(50)
  businessType  Int      @map("business_type")
  requestMethod String   @map("request_method") @db.VarChar(10)
  operatorType  Int      @map("operator_type")
  operName      String   @map("oper_name") @db.VarChar(50)
  deptName      String   @map("dept_name") @db.VarChar(50)
  operUrl       String   @map("oper_url") @db.VarChar(255)
  operLocation  String   @map("oper_location") @db.VarChar(255)
  operParam     String   @map("oper_param") @db.VarChar(2000)
  jsonResult    String   @map("json_result") @db.VarChar(2000)
  errorMsg      String   @map("error_msg") @db.VarChar(2000)
  method        String   @db.VarChar(100)
  operIp        String   @map("oper_ip") @db.VarChar(255)
  operTime      DateTime @default(dbgenerated("CURRENT_TIMESTAMP")) @map("oper_time") @db.Timestamp(6)
  status        Status
  costTime      Int      @map("cost_time")

  @@index([tenantId, operTime])
  @@index([operName])
  @@index([status])
  @@index([operTime])
  @@index([businessType])
  @@index([tenantId, status, operTime])
  @@index([tenantId, operName, operTime])
  @@map("sys_oper_log")
}

model SysPost {
  postId       Int       @id @default(autoincrement()) @map("post_id")
  tenantId     String    @default("000000") @map("tenant_id") @db.VarChar(20)
  deptId       Int?      @map("dept_id")
  postCode     String    @map("post_code") @db.VarChar(64)
  postCategory String?   @map("post_category") @db.VarChar(100)
  postName     String    @map("post_name") @db.VarChar(50)
  postSort     Int       @default(0) @map("post_sort")
  status       Status    @default(NORMAL)
  createBy     String    @default("") @map("create_by") @db.VarChar(64)
  createTime   DateTime? @default(dbgenerated("CURRENT_TIMESTAMP")) @map("create_time") @db.Timestamp(6)
  updateBy     String    @default("") @map("update_by") @db.VarChar(64)
  updateTime   DateTime? @default(dbgenerated("CURRENT_TIMESTAMP")) @map("update_time") @db.Timestamp(6)
  remark       String?   @db.VarChar(500)
  delFlag      DelFlag   @default(NORMAL) @map("del_flag")

  @@index([tenantId, status])
  @@index([deptId])
  @@index([tenantId, delFlag, status])
  @@index([delFlag])
  @@map("sys_post")
}

model SysRole {
  roleId            Int       @id @default(autoincrement()) @map("role_id")
  tenantId          String    @default("000000") @map("tenant_id") @db.VarChar(20)
  roleName          String    @map("role_name") @db.VarChar(30)
  roleKey           String    @map("role_key") @db.VarChar(100)
  roleSort          Int       @map("role_sort")
  dataScope         String    @default("1") @map("data_scope") @db.Char(1)
  menuCheckStrictly Boolean   @default(false) @map("menu_check_strictly")
  deptCheckStrictly Boolean   @default(false) @map("dept_check_strictly")
  status            Status    @default(NORMAL)
  delFlag           DelFlag   @default(NORMAL) @map("del_flag")
  createBy          String    @default("") @map("create_by") @db.VarChar(64)
  createTime        DateTime? @default(dbgenerated("CURRENT_TIMESTAMP")) @map("create_time") @db.Timestamp(6)
  updateBy          String    @default("") @map("update_by") @db.VarChar(64)
  updateTime        DateTime? @default(dbgenerated("CURRENT_TIMESTAMP")) @map("update_time") @db.Timestamp(6)
  remark            String?   @db.VarChar(500)

  @@index([tenantId, status])
  @@index([tenantId, delFlag, status])
  @@index([tenantId, roleKey])
  @@index([roleKey])
  @@index([delFlag])
  @@map("sys_role")
}

model SysRoleDept {
  roleId Int @map("role_id")
  deptId Int @map("dept_id")

  @@id([roleId, deptId])
  @@map("sys_role_dept")
}

model SysRoleMenu {
  roleId Int @map("role_id")
  menuId Int @map("menu_id")

  @@id([roleId, menuId])
  @@index([roleId])
  @@index([menuId])
  @@map("sys_role_menu")
}

/// æ–‡ä»¶å¤¹è¡¨
model SysFileFolder {
  folderId   Int       @id @default(autoincrement()) @map("folder_id")
  tenantId   String    @default("000000") @map("tenant_id") @db.VarChar(20)
  parentId   Int       @default(0) @map("parent_id")
  folderName String    @map("folder_name") @db.VarChar(100)
  folderPath String    @map("folder_path") @db.VarChar(500)
  orderNum   Int       @default(0) @map("order_num")
  status     Status    @default(NORMAL)
  delFlag    DelFlag   @default(NORMAL) @map("del_flag")
  createBy   String    @default("") @map("create_by") @db.VarChar(64)
  createTime DateTime? @default(dbgenerated("CURRENT_TIMESTAMP")) @map("create_time") @db.Timestamp(6)
  updateBy   String    @default("") @map("update_by") @db.VarChar(64)
  updateTime DateTime? @default(dbgenerated("CURRENT_TIMESTAMP")) @map("update_time") @db.Timestamp(6)
  remark     String?   @db.VarChar(500)

  @@index([tenantId, parentId])
  @@index([delFlag])
  @@map("sys_file_folder")
}

/// æ–‡ä»¶è¡¨ï¼ˆæ‰©å±•åŸ SysUploadï¼‰
model SysUpload {
  uploadId      String    @id @map("upload_id") @db.VarChar(255)
  tenantId      String    @default("000000") @map("tenant_id") @db.VarChar(20)
  folderId      Int       @default(0) @map("folder_id")
  size          Int
  fileName      String    @map("file_name") @db.VarChar(255)
  newFileName   String    @map("new_file_name") @db.VarChar(255)
  url           String    @db.VarChar(500)
  ext           String?   @db.VarChar(50)
  mimeType      String?   @map("mime_type") @db.VarChar(100)
  storageType   String    @default("local") @map("storage_type") @db.VarChar(20)
  fileMd5       String?   @map("file_md5") @db.VarChar(32)
  thumbnail     String?   @db.VarChar(500) // ç¼©ç•¥å›¾URL
  parentFileId  String?   @map("parent_file_id") @db.VarChar(255) // çˆ¶æ–‡ä»¶IDï¼ˆç”¨äºç‰ˆæœ¬æ§åˆ¶ï¼‰
  version       Int       @default(1) // ç‰ˆæœ¬å·
  isLatest      Boolean   @default(true) @map("is_latest") // æ˜¯å¦æœ€æ–°ç‰ˆæœ¬
  downloadCount Int       @default(0) @map("download_count")
  status        Status    @default(NORMAL)
  delFlag       DelFlag   @default(NORMAL) @map("del_flag")
  createBy      String    @default("") @map("create_by") @db.VarChar(64)
  createTime    DateTime? @default(dbgenerated("CURRENT_TIMESTAMP")) @map("create_time") @db.Timestamp(6)
  updateBy      String    @default("") @map("update_by") @db.VarChar(64)
  updateTime    DateTime? @default(dbgenerated("CURRENT_TIMESTAMP")) @map("update_time") @db.Timestamp(6)
  remark        String?   @db.VarChar(500)

  // Relations
  shares SysFileShare[]

  @@index([tenantId, folderId])
  @@index([fileMd5, delFlag])
  @@index([parentFileId, version])
  @@index([delFlag])
  @@map("sys_upload")
}

/// æ–‡ä»¶åˆ†äº«è¡¨
model SysFileShare {
  shareId       String    @id @default(uuid()) @map("share_id") @db.VarChar(64)
  tenantId      String    @default("000000") @map("tenant_id") @db.VarChar(20)
  uploadId      String    @map("upload_id") @db.VarChar(255)
  shareCode     String?   @map("share_code") @db.VarChar(6)
  expireTime    DateTime? @map("expire_time") @db.Timestamp(6)
  maxDownload   Int       @default(-1) @map("max_download")
  downloadCount Int       @default(0) @map("download_count")
  status        Status    @default(NORMAL)
  createBy      String    @default("") @map("create_by") @db.VarChar(64)
  createTime    DateTime? @default(dbgenerated("CURRENT_TIMESTAMP")) @map("create_time") @db.Timestamp(6)

  // Relations
  upload SysUpload @relation(fields: [uploadId], references: [uploadId], onDelete: Cascade)

  @@index([shareId, shareCode])
  @@index([uploadId])
  @@map("sys_file_share")
}

model SysUser {
  userId      Int       @id @default(autoincrement()) @map("user_id")
  tenantId    String    @default("000000") @map("tenant_id") @db.VarChar(20)
  deptId      Int?      @map("dept_id")
  userName    String    @map("user_name") @db.VarChar(30)
  nickName    String    @map("nick_name") @db.VarChar(30)
  userType    String    @map("user_type") @db.VarChar(2)
  email       String    @default("") @db.VarChar(50)
  phonenumber String    @default("") @db.VarChar(11)
  sex         String    @default("0") @db.Char(1)
  avatar      String    @default("") @db.VarChar(255)
  password    String    @db.VarChar(200)
  status      Status    @default(NORMAL)
  delFlag     DelFlag   @default(NORMAL) @map("del_flag")
  loginIp     String    @default("") @map("login_ip") @db.VarChar(128)
  loginDate   DateTime? @map("login_date") @db.Timestamp(6)
  createBy    String    @default("") @map("create_by") @db.VarChar(64)
  createTime  DateTime? @default(dbgenerated("CURRENT_TIMESTAMP")) @map("create_time") @db.Timestamp(6)
  updateBy    String    @default("") @map("update_by") @db.VarChar(64)
  updateTime  DateTime? @default(dbgenerated("CURRENT_TIMESTAMP")) @map("update_time") @db.Timestamp(6)
  dept        SysDept?  @relation(fields: [deptId], references: [deptId])
  remark      String?   @db.VarChar(500)

  @@index([tenantId, status])
  @@index([tenantId, userName])
  @@index([tenantId, createTime])
  @@index([tenantId, phonenumber])
  @@index([tenantId, email])
  @@index([tenantId, delFlag, status])
  @@index([userName])
  @@index([deptId])
  @@index([status])
  @@index([phonenumber])
  @@index([email])
  @@index([delFlag])
  @@map("sys_user")
}

model SysUserPost {
  userId Int @map("user_id")
  postId Int @map("post_id")

  @@id([userId, postId])
  @@index([postId])
  @@map("sys_user_post")
}

model SysUserRole {
  userId Int @map("user_id")
  roleId Int @map("role_id")

  @@id([userId, roleId])
  @@index([roleId])
  @@map("sys_user_role")
}

// ==========================================
// ğŸ“Œ åˆ†é”€è§„åˆ™é…ç½®è¡¨ (ç§Ÿæˆ·çº§)
// ==========================================

model SysDistConfig {
  id         Int     @id @default(autoincrement())
  tenantId   String  @unique @map("tenant_id") @db.VarChar(20) // æ¯ä¸ªç§Ÿæˆ·ä¸€å¥—è§„åˆ™
  level1Rate Decimal @default(0.60) @map("level1_rate") @db.Decimal(5, 2) // ä¸€çº§åˆ†ä½£æ¯” (ç›´æ¨)
  level2Rate Decimal @default(0.40) @map("level2_rate") @db.Decimal(5, 2) // äºŒçº§åˆ†ä½£æ¯” (é—´æ¨)
  enableLV0  Boolean @default(true) @map("enable_lv0") // æ˜¯å¦å…è®¸æ™®é€šç”¨æˆ·å‚ä¸åˆ†é”€

  // === è·¨åº—åˆ†é”€é…ç½® ===
  enableCrossTenant Boolean @default(false) @map("enable_cross_tenant") // æ˜¯å¦å…è®¸å¤–åº—æ¨èäººè·å–ä½£é‡‘
  crossTenantRate   Decimal @default(1.00) @map("cross_tenant_rate") @db.Decimal(5, 2) // è·¨åº—åˆ†ä½£æŠ˜æ‰£ (1.00=100%, 0.80=80%)
  crossMaxDaily     Decimal @default(500.00) @map("cross_max_daily") @db.Decimal(10, 2) // è·¨åº—ä½£é‡‘æ—¥é™é¢

  // === ä½£é‡‘è®¡ç®—ç­–ç•¥ ===
  commissionBaseType CommissionBaseType @default(ORIGINAL_PRICE) @map("commission_base_type") // ä½£é‡‘è®¡ç®—åŸºæ•°ç±»å‹
  maxCommissionRate  Decimal            @default(0.50) @map("max_commission_rate") @db.Decimal(5, 2) // æœ€å¤§ä½£é‡‘æ¯”ä¾‹ï¼ˆç†”æ–­ä¿æŠ¤ï¼Œå¦‚50%ï¼‰

  createBy      String         @default("") @map("create_by") @db.VarChar(64)
  createTime    DateTime       @default(now()) @map("create_time")
  updateBy      String         @default("") @map("update_by") @db.VarChar(64)
  updateTime    DateTime       @updatedAt @map("update_time")
  playInstances PlayInstance[]

  @@map("sys_dist_config")
}

// åˆ†é”€è§„åˆ™å˜æ›´å†å² (å®¡è®¡æ—¥å¿—)
model SysDistConfigLog {
  id         Int     @id @default(autoincrement())
  tenantId   String  @map("tenant_id") @db.VarChar(20)
  level1Rate Decimal @map("level1_rate") @db.Decimal(5, 2)
  level2Rate Decimal @map("level2_rate") @db.Decimal(5, 2)
  enableLV0  Boolean @map("enable_lv0")

  // === è·¨åº—åˆ†é”€é…ç½® ===
  enableCrossTenant Boolean? @map("enable_cross_tenant")
  crossTenantRate   Decimal? @map("cross_tenant_rate") @db.Decimal(5, 2)
  crossMaxDaily     Decimal? @map("cross_max_daily") @db.Decimal(10, 2)

  operator   String   @db.VarChar(64) // æ“ä½œäºº
  createTime DateTime @default(now()) @map("create_time")

  @@index([tenantId, createTime])
  @@map("sys_dist_config_log")
}

// ==========================================

// åˆ†é”€é»‘åå• (ç¦æ­¢ç‰¹å®šç”¨æˆ·è·å–ä½£é‡‘)
model SysDistBlacklist {
  id         Int      @id @default(autoincrement())
  tenantId   String   @map("tenant_id") @db.VarChar(20)
  userId     String   @map("user_id") @db.VarChar(20)
  reason     String?  @db.VarChar(255)
  createBy   String   @map("create_by") @db.VarChar(64)
  createTime DateTime @default(now()) @map("create_time")

  @@unique([tenantId, userId])
  @@map("sys_dist_blacklist")
}

// ğŸ“Œ OMS è®¢å•ç®¡ç†æ¨¡å—
// ==========================================

enum OrderStatus {
  PENDING_PAY @map("1") // å¾…æ”¯ä»˜
  PAID        @map("2") // å·²æ”¯ä»˜å¾…å‘è´§/å¾…æœåŠ¡
  SHIPPED     @map("3") // å·²å‘è´§/æœåŠ¡ä¸­
  COMPLETED   @map("4") // å·²å®Œæˆ
  CANCELLED   @map("5") // å·²å–æ¶ˆ
  REFUNDED    @map("6") // å·²é€€æ¬¾
}

enum OrderType {
  PRODUCT @map("1") // å®ç‰©è®¢å•
  SERVICE @map("2") // æœåŠ¡è®¢å•
  MIXED   @map("3") // æ··åˆè®¢å•
}

enum PayStatus {
  UNPAID   @map("0") // æœªæ”¯ä»˜
  PAID     @map("1") // å·²æ”¯ä»˜
  REFUNDED @map("2") // å·²é€€æ¬¾
}

/// è´­ç‰©è½¦è¡¨
model OmsCartItem {
  id       String @id @default(uuid())
  memberId String @map("member_id")
  tenantId String @map("tenant_id")

  productId String @map("product_id")
  skuId     String @map("sku_id")
  quantity  Int    @default(1)

  // å¿«ç…§ä¿¡æ¯ (é˜²æ­¢å•†å“ä¸‹æ¶åæŠ¥é”™)
  productName String  @map("product_name")
  productImg  String  @map("product_img")
  price       Decimal @db.Decimal(10, 2) // åŠ è´­æ—¶ä»·æ ¼
  specData    Json?   @map("spec_data") // {"é¢œè‰²":"çº¢è‰²"}

  // å½’å› ä¿¡æ¯
  shareUserId String? @map("share_user_id")

  // æœåŠ¡ç±»æ‰©å±•
  serviceDate DateTime? @map("service_date")

  createTime DateTime @default(now()) @map("create_time")
  updateTime DateTime @updatedAt @map("update_time")

  @@unique([memberId, tenantId, skuId])
  @@index([memberId, tenantId])
  @@map("oms_cart_item")
}

/// è®¢å•ä¸»è¡¨
model OmsOrder {
  id      String @id @default(cuid())
  orderSn String @unique @map("order_sn")

  memberId String @map("member_id")
  tenantId String @map("tenant_id")

  orderType OrderType @map("order_type")

  // é‡‘é¢
  totalAmount    Decimal @map("total_amount") @db.Decimal(10, 2)
  freightAmount  Decimal @default(0) @map("freight_amount") @db.Decimal(10, 2)
  discountAmount Decimal @default(0) @map("discount_amount") @db.Decimal(10, 2)
  payAmount      Decimal @map("pay_amount") @db.Decimal(10, 2)

  // ä¼˜æƒ åˆ¸ç›¸å…³
  userCouponId   String? @map("user_coupon_id") // ä½¿ç”¨çš„ä¼˜æƒ åˆ¸ID
  couponDiscount Decimal @default(0) @map("coupon_discount") @db.Decimal(10, 2) // ä¼˜æƒ åˆ¸ä¼˜æƒ é‡‘é¢

  // ç§¯åˆ†ç›¸å…³
  pointsUsed     Int     @default(0) @map("points_used") // ä½¿ç”¨çš„ç§¯åˆ†æ•°é‡
  pointsDiscount Decimal @default(0) @map("points_discount") @db.Decimal(10, 2) // ç§¯åˆ†æŠµæ‰£é‡‘é¢
  pointsEarned   Int     @default(0) @map("points_earned") // æœ¬æ¬¡è®¢å•è·å¾—çš„ç§¯åˆ†

  // æ”¶è´§ä¿¡æ¯
  receiverName    String? @map("receiver_name")
  receiverPhone   String? @map("receiver_phone")
  receiverAddress String? @map("receiver_address")
  receiverLat     Float?  @map("receiver_lat")
  receiverLng     Float?  @map("receiver_lng")

  // æœåŠ¡ç±»ä¸“å±
  bookingTime   DateTime? @map("booking_time")
  workerId      Int?      @map("worker_id")
  serviceRemark String?   @map("service_remark")

  // åˆ†é”€å½’å› 
  shareUserId String? @map("share_user_id")
  referrerId  String? @map("referrer_id")

  // çŠ¶æ€
  status    OrderStatus @default(PENDING_PAY)
  payStatus PayStatus   @default(UNPAID) @map("pay_status")

  // æ”¯ä»˜ä¿¡æ¯
  payType       String?   @map("pay_type")
  transactionId String?   @map("transaction_id")
  payTime       DateTime? @map("pay_time")

  // æ—¶é—´æˆ³
  createTime DateTime  @default(now()) @map("create_time")
  updateTime DateTime  @updatedAt @map("update_time")
  deleteTime DateTime? @map("delete_time")

  remark String? @db.VarChar(500)

  items       OmsOrderItem[]
  commissions FinCommission[]
  tenant      SysTenant       @relation(fields: [tenantId], references: [tenantId])

  @@index([memberId, status])
  @@index([tenantId, createTime])
  @@map("oms_order")
}

/// è®¢å•æ˜ç»†è¡¨
model OmsOrderItem {
  id       Int     @id @default(autoincrement())
  orderId  String  @map("order_id")
  tenantId String? @map("tenant_id") @db.VarChar(20)

  productId   String @map("product_id")
  productName String @map("product_name")
  productImg  String @map("product_img")

  skuId    String @map("sku_id")
  specData Json?  @map("spec_data")

  price       Decimal @db.Decimal(10, 2)
  quantity    Int
  totalAmount Decimal @map("total_amount") @db.Decimal(10, 2)

  // --- [æ–°å¢] ç§¯åˆ†ç›¸å…³ ---
  // ä¸‹å•æ—¶çš„ç§¯åˆ†æ¯”ä¾‹ï¼ˆå¿«ç…§ï¼Œé˜²æ­¢åç»­ä¿®æ”¹å½±å“å·²ä¸‹å•å•†å“ï¼‰
  pointsRatio Int @default(100) @map("points_ratio")
  
  // è¯¥å•†å“äº§ç”Ÿçš„ç§¯åˆ†
  earnedPoints Int @default(0) @map("earned_points")

  order OmsOrder @relation(fields: [orderId], references: [id])

  @@index([orderId])
  @@map("oms_order_item")
}

// ==========================================
// ğŸ“Œ è´¢åŠ¡ä¸­å¿ƒè¡¨
// ==========================================

/// ç”¨æˆ·é’±åŒ…è¡¨
model FinWallet {
  id       String @id @default(uuid())
  memberId String @unique @map("member_id")
  tenantId String @map("tenant_id")

  // ä¸‰èµ„äº§
  balance     Decimal @default(0) @db.Decimal(12, 2) // å¯ç”¨ä½™é¢
  frozen      Decimal @default(0) @db.Decimal(12, 2) // å†»ç»“ä½™é¢
  totalIncome Decimal @default(0) @db.Decimal(12, 2) // ç´¯è®¡æ”¶ç›Š

  // å®‰å…¨
  payPassword String? @map("pay_password")
  version     Int     @default(0) // ä¹è§‚é”

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  member       UmsMember        @relation(fields: [memberId], references: [memberId])
  transactions FinTransaction[]

  @@index([tenantId, memberId])
  @@map("fin_wallet")
}

/// é’±åŒ…æµæ°´è¡¨ (ä¸å¯ç¯¡æ”¹çš„è´¦æœ¬)
model FinTransaction {
  id       BigInt @id @default(autoincrement())
  walletId String @map("wallet_id")
  tenantId String @map("tenant_id")

  type         TransType
  amount       Decimal   @db.Decimal(12, 2) // å¯æ­£å¯è´Ÿ
  balanceAfter Decimal   @db.Decimal(12, 2) // äº¤æ˜“åä½™é¢å¿«ç…§

  relatedId String  @map("related_id") // å…³è”ä¸šåŠ¡ID
  remark    String? @db.VarChar(200)

  createTime DateTime @default(now()) @map("create_time")

  wallet FinWallet @relation(fields: [walletId], references: [id])

  @@index([walletId, createTime])
  @@index([tenantId, type])
  @@map("fin_transaction")
}

/// ä½£é‡‘è®°å½•è¡¨ (åœ¨é€”èµ„é‡‘)
/// è¯´æ˜: ä½£é‡‘åˆ†é…æ¯”ä¾‹ä» SysDistConfig è¡¨æŒ‰ tenantId è·å–
/// è®¡ç®—æµç¨‹: order.tenantId â†’ SysDistConfig.tenantId â†’ level1Rate/level2Rate
model FinCommission {
  id       BigInt @id @default(autoincrement())
  orderId  String @map("order_id")
  tenantId String @map("tenant_id")

  beneficiaryId String  @map("beneficiary_id") // å—ç›Šäºº
  level         Int // 1=ä¸€çº§(ç›´æ¨), 2=äºŒçº§(é—´æ¨)
  amount        Decimal @db.Decimal(10, 2)

  // åˆ†ä½£æ¯”ä¾‹å¿«ç…§ (è®°å½•å½“æ—¶çš„æ¯”ä¾‹ï¼Œé˜²æ­¢é…ç½®ä¿®æ”¹åå¯¹è´¦ä¸å‡†)
  rateSnapshot Decimal @default(0) @map("rate_snapshot") @db.Decimal(5, 2)

  // === ä½£é‡‘è®¡ç®—è¯¦æƒ…ï¼ˆç”¨äºå®¡è®¡å’Œå¯¹è´¦ï¼‰ ===
  commissionBase     Decimal             @map("commission_base") @db.Decimal(10, 2) // åˆ†ä½£åŸºæ•°
  commissionBaseType CommissionBaseType? @map("commission_base_type") // åŸºæ•°ç±»å‹å¿«ç…§
  orderOriginalPrice Decimal?            @map("order_original_price") @db.Decimal(10, 2) // è®¢å•åŸä»·
  orderActualPaid    Decimal?            @map("order_actual_paid") @db.Decimal(10, 2) // è®¢å•å®ä»˜
  couponDiscount     Decimal?            @default(0) @map("coupon_discount") @db.Decimal(10, 2) // ä¼˜æƒ åˆ¸æŠµæ‰£
  pointsDiscount     Decimal?            @default(0) @map("points_discount") @db.Decimal(10, 2) // ç§¯åˆ†æŠµæ‰£
  isCapped           Boolean             @default(false) @map("is_capped") // æ˜¯å¦è§¦å‘ç†”æ–­

  status CommissionStatus @default(FROZEN)

  createTime     DateTime  @default(now()) @map("create_time")
  planSettleTime DateTime  @map("plan_settle_time") // è®¡åˆ’è§£å†»æ—¶é—´
  settleTime     DateTime? @map("settle_time") // å®é™…è§£å†»æ—¶é—´

  isCrossTenant Boolean @default(false) @map("is_cross_tenant") // æ˜¯å¦è·¨åº—ä½£é‡‘

  beneficiary UmsMember @relation(fields: [beneficiaryId], references: [memberId])

  order OmsOrder @relation(fields: [orderId], references: [id])

  @@unique([orderId, beneficiaryId, level]) // é˜²é‡å¤
  @@index([orderId])
  @@index([beneficiaryId, status])
  @@index([tenantId, status, planSettleTime]) // å®šæ—¶ä»»åŠ¡ç´¢å¼•
  @@map("fin_commission")
}

/// æç°è®°å½•è¡¨
model FinWithdrawal {
  id       String @id @default(uuid())
  tenantId String @map("tenant_id")
  memberId String @map("member_id")

  amount Decimal @db.Decimal(10, 2)
  method String // WECHAT_WALLET, BANK_CARD

  // è´¦å·å¿«ç…§
  accountNo String?
  realName  String?

  status WithdrawalStatus @default(PENDING)

  auditTime   DateTime? @map("audit_time")
  auditBy     String?   @map("audit_by")
  auditRemark String?   @map("audit_remark")

  // æ‰“æ¬¾å‡­è¯
  paymentNo  String? @map("payment_no") // å¾®ä¿¡æµæ°´å·
  failReason String? @map("fail_reason")

  createTime DateTime @default(now()) @map("create_time")

  member UmsMember @relation(fields: [memberId], references: [memberId])

  @@index([tenantId, status])
  @@index([memberId, createTime])
  @@map("fin_withdrawal")
}

// ==================== æ¶ˆæ¯é€šçŸ¥æ¨¡å— ====================

/// ç³»ç»Ÿæ¶ˆæ¯è¡¨ (ç«™å†…ä¿¡)
model SysMessage {
  id      Int     @id @default(autoincrement())
  title   String  @db.VarChar(100) // æ ‡é¢˜
  content String? @db.Text // å†…å®¹
  type    String  @db.VarChar(50) // ç±»å‹: ORDER, SYSTEM, NOTICE

  receiverId String  @map("receiver_id") // æ¥æ”¶äººID (é€šå¸¸æ˜¯MemberIDæˆ–TenantID)
  isRead     Boolean @default(false) @map("is_read") // æ˜¯å¦å·²è¯»

  tenantId String @map("tenant_id") @db.VarChar(20) // å½’å±ç§Ÿæˆ·

  createTime DateTime @default(now()) @map("create_time")

  @@index([receiverId])
  @@index([tenantId])
  @@map("sys_message")
}

// ==========================================
// ğŸ“Œ è¥é”€ç©æ³•å•†å“åŒ–å¹³å° (MaaS) æ¨¡å‹
// ==========================================

enum MarketingStockMode {
  STRONG_LOCK // å¼ºäº’æ–¥ (å®ç‰©)
  LAZY_CHECK // å¼±äº’æ–¥ (æœåŠ¡)
}

/// ç©æ³•æ¨¡æ¿ (æ€»éƒ¨å®šä¹‰)
model PlayTemplate {
  id         String @id @default(cuid())
  code       String @unique // GROUP_BUY, BARGAIN
  name       String
  ruleSchema Json   @map("rule_schema") // åŠ¨æ€è¡¨å•é…ç½® { fields: [...] }
  unitName   String @map("unit_name") // å•ä½: èŠ‚/å°æ—¶/è¢‹

  uiComponentId String? @map("ui_component_id") // å‰ç«¯ç»„ä»¶æ˜ å°„

  // å…³è”å•†å“/è§„æ ¼ (å¯é€‰)
  productId   String? @map("product_id") // å…³è”çš„å•†å“ID
  skuId       String? @map("sku_id") // å…³è”çš„è§„æ ¼ID
  productName String? @map("product_name") // å•†å“åç§° (å†—ä½™å­—æ®µï¼Œç”¨äºæ˜¾ç¤º)

  status     Status   @default(NORMAL)
  delFlag    DelFlag  @default(NORMAL) @map("del_flag")
  createTime DateTime @default(now()) @map("create_time")
  updateTime DateTime @updatedAt @map("update_time")

  @@map("mkt_play_template")
}

/// é—¨åº—è¥é”€å•†å“ (é—¨åº—ç”Ÿäº§)
model StorePlayConfig {
  id       String @id @default(cuid())
  tenantId String @default("000000") @map("tenant_id")
  storeId  String @map("store_id")

  // å…³è”ç‰©ç†æœåŠ¡/å•†å“
  serviceId   String      @map("service_id")
  serviceType ProductType @map("service_type")

  // å…³è”æ¨¡æ¿
  templateCode String @map("template_code")

  // è¥é”€è§„åˆ™é…ç½®
  rules Json // { targetCount: 3, discountPrice: 99 }

  // è§„åˆ™å†å²ç‰ˆæœ¬ï¼ˆç”¨äºç‰ˆæœ¬æ§åˆ¶å’Œå›æ»šï¼‰
  rulesHistory Json[] @default([]) @map("rules_history")

  // åº“å­˜ç­–ç•¥
  stockMode MarketingStockMode @map("stock_mode")

  status  PublishStatus @default(OFF_SHELF) // ONLINE, OFFLINE
  delFlag DelFlag       @default(NORMAL) @map("del_flag")

  createTime    DateTime       @default(now()) @map("create_time")
  updateTime    DateTime       @updatedAt @map("update_time")
  playInstances PlayInstance[]

  @@map("mkt_store_config")
}

enum PlayInstanceStatus {
  PENDING_PAY // å¾…æ”¯ä»˜
  PAID // å·²æ”¯ä»˜ (é”å®šåé¢)
  ACTIVE // ç”Ÿæ•ˆä¸­ (æ¯”å¦‚æ‹¼å›¢æ­£åœ¨è¿›è¡Œ)
  SUCCESS // æˆåŠŸ (è¾¾æˆæ¡ä»¶/å·²æ ¸é”€)
  TIMEOUT // è¶…æ—¶å…³é—­
  FAILED // å¤±è´¥ (å¦‚æ‹¼å›¢äººæ•°ä¸è¶³)
  REFUNDED // å·²é€€æ¬¾
}

/// è¥é”€ç©æ³•å®ä¾‹ (äº¤æ˜“è®°å½•)
model PlayInstance {
  id       String @id @default(cuid())
  tenantId String @map("tenant_id")
  memberId String @map("member_id")

  // å…³è”é…ç½®
  configId     String @map("config_id")
  templateCode String @map("template_code")

  config StorePlayConfig @relation(fields: [configId], references: [id])

  // å…³è”ç³»ç»Ÿè®¢å•
  orderSn String? @unique @map("order_sn")

  // å®ä¾‹ç‰¹å®šçš„åŠ¨æ€æ•°æ® (æ¯”å¦‚å½“å‰æ‹¼å›¢è¿›åº¦)
  instanceData Json @map("instance_data")

  status PlayInstanceStatus @default(PENDING_PAY)

  // æ—¶é—´çº¿
  createTime      DateTime       @default(now()) @map("create_time")
  payTime         DateTime?      @map("pay_time")
  endTime         DateTime?      @map("end_time") // æˆåŠŸæˆ–å¤±è´¥çš„æœ€ç»ˆæ—¶é—´
  updateTime      DateTime       @updatedAt @map("update_time")
  sysDistConfig   SysDistConfig? @relation(fields: [sysDistConfigId], references: [id])
  sysDistConfigId Int?

  // æ‰©å±•å…³è”
  courseGroupBuyExtension CourseGroupBuyExtension?

  @@index([configId])
  @@index([memberId])
  @@map("mkt_play_instance")
}

enum AssetStatus {
  UNUSED
  USED
  EXPIRED
  FROZEN
}

/// ç”¨æˆ·è¥é”€èµ„äº§ (æ ¸é”€åˆ¸/æƒç›Š)
model MktUserAsset {
  id       String @id @default(cuid())
  tenantId String @map("tenant_id")
  memberId String @map("member_id")

  // æ¥æºæ¨å¯¼
  instanceId String @map("instance_id")
  configId   String @map("config_id")

  assetName String @map("asset_name")
  assetType String @map("asset_type") // VOUCHER, TIMES_CARD

  balance        Decimal @default(0) @db.Decimal(12, 2)
  initialBalance Decimal @map("initial_balance") @db.Decimal(12, 2)

  status AssetStatus @default(UNUSED)

  expireTime DateTime? @map("expire_time")
  createTime DateTime  @default(now()) @map("create_time")
  updateTime DateTime  @updatedAt @map("update_time")

  @@index([memberId, status])
  @@index([instanceId])
  @@map("mkt_user_asset")
}

// ============================================
// è¥é”€ç©æ³•æ‰©å±•è¡¨
// ============================================

/// è¯¾ç¨‹æ‹¼å›¢æ‰©å±•è¡¨
/// ç”¨äºå­˜å‚¨è¯¾ç¨‹æ‹¼å›¢çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ’è¯¾ã€è€ƒå‹¤ç­‰
model CourseGroupBuyExtension {
  id       String @id @default(cuid())
  tenantId String @map("tenant_id")

  // å…³è”å®ä¾‹
  instanceId String @unique @map("instance_id")
  groupId    String @map("group_id") // å›¢IDï¼ˆå›¢é•¿å®ä¾‹IDï¼‰

  // è¯¾ç¨‹ä¿¡æ¯
  totalLessons     Int       @map("total_lessons") // æ€»è¯¾æ—¶æ•°
  completedLessons Int       @default(0) @map("completed_lessons") // å·²å®Œæˆè¯¾æ—¶æ•°
  classAddress     String?   @map("class_address") // ä¸Šè¯¾åœ°å€
  classStartTime   DateTime? @map("class_start_time") // ä¸Šè¯¾å¼€å§‹æ—¶é—´
  classEndTime     DateTime? @map("class_end_time") // ä¸Šè¯¾ç»“æŸæ—¶é—´

  // å›¢é•¿ä¿¡æ¯
  leaderId       String  @map("leader_id") // å›¢é•¿ID
  leaderDiscount Decimal @default(0) @map("leader_discount") @db.Decimal(10, 2) // å›¢é•¿ä¼˜æƒ é‡‘é¢

  // çŠ¶æ€
  status     String   @default("ACTIVE") // ACTIVE, COMPLETED, CANCELLED
  delFlag    DelFlag  @default(NORMAL) @map("del_flag")
  createTime DateTime @default(now()) @map("create_time")
  updateTime DateTime @updatedAt @map("update_time")

  // å…³è”
  instance    PlayInstance       @relation(fields: [instanceId], references: [id], onDelete: Cascade)
  schedules   CourseSchedule[]
  attendances CourseAttendance[]

  @@index([groupId])
  @@index([leaderId])
  @@index([tenantId])
  @@map("mkt_course_group_buy_ext")
}

/// è¯¾ç¨‹æ’è¯¾è¡¨
/// è®°å½•æ¯èŠ‚è¯¾çš„æ—¶é—´å®‰æ’
model CourseSchedule {
  id          String @id @default(cuid())
  tenantId    String @map("tenant_id")
  extensionId String @map("extension_id")

  // æ’è¯¾ä¿¡æ¯
  date      DateTime @db.Date // ä¸Šè¯¾æ—¥æœŸ
  startTime String   @map("start_time") // å¼€å§‹æ—¶é—´ "09:00"
  endTime   String   @map("end_time") // ç»“æŸæ—¶é—´ "11:00"
  lessons   Int // è¯¾æ—¶æ•°

  // çŠ¶æ€
  status     String   @default("SCHEDULED") @map("status") // SCHEDULED, COMPLETED, CANCELLED
  remark     String?  @db.Text // å¤‡æ³¨
  delFlag    DelFlag  @default(NORMAL) @map("del_flag")
  createTime DateTime @default(now()) @map("create_time")
  updateTime DateTime @updatedAt @map("update_time")

  // å…³è”
  extension CourseGroupBuyExtension @relation(fields: [extensionId], references: [id], onDelete: Cascade)

  @@index([extensionId, date])
  @@index([tenantId])
  @@map("mkt_course_schedule")
}

/// è¯¾ç¨‹è€ƒå‹¤è¡¨
/// è®°å½•å­¦å‘˜çš„å‡ºå‹¤æƒ…å†µ
model CourseAttendance {
  id          String  @id @default(cuid())
  tenantId    String  @map("tenant_id")
  extensionId String  @map("extension_id")
  scheduleId  String? @map("schedule_id") // å…³è”æ’è¯¾ï¼ˆå¯é€‰ï¼‰

  // è€ƒå‹¤ä¿¡æ¯
  memberId String   @map("member_id") // å­¦å‘˜ID
  date     DateTime @db.Date // è€ƒå‹¤æ—¥æœŸ
  attended Boolean  @default(false) // æ˜¯å¦å‡ºå‹¤
  remark   String?  @db.Text // å¤‡æ³¨

  // çŠ¶æ€
  delFlag    DelFlag  @default(NORMAL) @map("del_flag")
  createTime DateTime @default(now()) @map("create_time")
  updateTime DateTime @updatedAt @map("update_time")

  // å…³è”
  extension CourseGroupBuyExtension @relation(fields: [extensionId], references: [id], onDelete: Cascade)

  @@unique([extensionId, memberId, date])
  @@index([memberId])
  @@index([tenantId])
  @@map("mkt_course_attendance")
}

// ==========================================
// ğŸ“Œ ä¼˜æƒ åˆ¸å’Œç§¯åˆ†ç³»ç»Ÿ
// ==========================================

/// ä¼˜æƒ åˆ¸ç±»å‹æšä¸¾
enum CouponType {
  DISCOUNT // æ»¡å‡åˆ¸
  PERCENTAGE // æŠ˜æ‰£åˆ¸
  EXCHANGE // å…‘æ¢åˆ¸
}

/// ä¼˜æƒ åˆ¸çŠ¶æ€æšä¸¾
enum CouponStatus {
  ACTIVE // å¯ç”¨ä¸­
  INACTIVE // å·²åœç”¨
  EXPIRED // å·²è¿‡æœŸ
}

/// ç”¨æˆ·ä¼˜æƒ åˆ¸çŠ¶æ€æšä¸¾
enum UserCouponStatus {
  UNUSED // æœªä½¿ç”¨
  LOCKED // å·²é”å®šï¼ˆè®¢å•åˆ›å»ºæ—¶ï¼‰
  USED // å·²ä½¿ç”¨
  EXPIRED // å·²è¿‡æœŸ
  CANCELLED // å·²å–æ¶ˆ
}

/// ä¼˜æƒ åˆ¸æœ‰æ•ˆæœŸç±»å‹æšä¸¾
enum CouponValidityType {
  FIXED // å›ºå®šæ—¶é—´æ®µ
  RELATIVE // ç›¸å¯¹æ—¶é—´ï¼ˆé¢†å–åNå¤©ï¼‰
}

/// ä¼˜æƒ åˆ¸å‘æ”¾æ–¹å¼æšä¸¾
enum CouponDistributionType {
  MANUAL // æ‰‹åŠ¨å‘æ”¾
  AUTO // è‡ªåŠ¨å‘æ”¾
  ACTIVITY // æ´»åŠ¨å‘æ”¾
  ORDER // è®¢å•èµ é€
}

/// ç§¯åˆ†äº¤æ˜“ç±»å‹æšä¸¾
enum PointsTransactionType {
  EARN_ORDER // æ¶ˆè´¹è·å¾—
  EARN_SIGNIN // ç­¾åˆ°è·å¾—
  EARN_TASK // ä»»åŠ¡è·å¾—
  EARN_ADMIN // ç®¡ç†å‘˜è°ƒæ•´ï¼ˆå¢åŠ ï¼‰
  USE_ORDER // è®¢å•æŠµæ‰£
  USE_COUPON // å…‘æ¢ä¼˜æƒ åˆ¸
  USE_PRODUCT // å…‘æ¢å•†å“
  FREEZE // å†»ç»“
  UNFREEZE // è§£å†»
  EXPIRE // è¿‡æœŸæ‰£å‡
  REFUND // é€€æ¬¾è¿”è¿˜
  DEDUCT_ADMIN // ç®¡ç†å‘˜è°ƒæ•´ï¼ˆæ‰£å‡ï¼‰
}

/// ç§¯åˆ†äº¤æ˜“çŠ¶æ€æšä¸¾
enum PointsTransactionStatus {
  PENDING // å¾…å¤„ç†
  COMPLETED // å·²å®Œæˆ
  CANCELLED // å·²å–æ¶ˆ
}

/// ä¼˜æƒ åˆ¸æ¨¡æ¿è¡¨
model MktCouponTemplate {
  id       String @id @default(uuid())
  tenantId String @map("tenant_id") @db.VarChar(20)

  // åŸºç¡€ä¿¡æ¯
  name        String     @db.VarChar(100)
  description String?    @db.VarChar(500)
  type        CouponType

  // ä¼˜æƒ é‡‘é¢é…ç½®
  discountAmount    Decimal? @map("discount_amount") @db.Decimal(10, 2) // æ»¡å‡é‡‘é¢
  discountPercent   Int?     @map("discount_percent") // æŠ˜æ‰£ç™¾åˆ†æ¯”(1-99)
  maxDiscountAmount Decimal? @map("max_discount_amount") @db.Decimal(10, 2) // æœ€é«˜ä¼˜æƒ é‡‘é¢

  // ä½¿ç”¨æ¡ä»¶
  minOrderAmount       Decimal  @default(0) @map("min_order_amount") @db.Decimal(10, 2) // æœ€ä½æ¶ˆè´¹é‡‘é¢
  minActualPayAmount   Decimal? @map("min_actual_pay_amount") @db.Decimal(10, 2) // æœ€ä½å®ä»˜é‡‘é¢ï¼ˆä½¿ç”¨ä¼˜æƒ åˆ¸åï¼‰
  applicableProducts   String[] @map("applicable_products") // é€‚ç”¨å•†å“IDåˆ—è¡¨
  applicableCategories Int[]    @map("applicable_categories") // é€‚ç”¨åˆ†ç±»IDåˆ—è¡¨
  memberLevels         Int[]    @map("member_levels") // é€‚ç”¨ä¼šå‘˜ç­‰çº§

  // å…‘æ¢åˆ¸ä¸“å±
  exchangeProductId String? @map("exchange_product_id") // å¯å…‘æ¢çš„å•†å“ID
  exchangeSkuId     String? @map("exchange_sku_id") // å¯å…‘æ¢çš„SKU ID

  // æœ‰æ•ˆæœŸé…ç½®
  validityType CouponValidityType @map("validity_type")
  startTime    DateTime?          @map("start_time") // å›ºå®šæ—¶é—´æ®µ-å¼€å§‹æ—¶é—´
  endTime      DateTime?          @map("end_time") // å›ºå®šæ—¶é—´æ®µ-ç»“æŸæ—¶é—´
  validDays    Int?               @map("valid_days") // ç›¸å¯¹æ—¶é—´-æœ‰æ•ˆå¤©æ•°

  // å‘æ”¾é…ç½®
  totalStock     Int @map("total_stock") // å‘æ”¾æ€»é‡
  remainingStock Int @map("remaining_stock") // å‰©ä½™åº“å­˜
  limitPerUser   Int @default(1) @map("limit_per_user") // æ¯äººé™é¢†æ•°é‡

  // çŠ¶æ€
  status CouponStatus @default(ACTIVE)

  // å®¡è®¡å­—æ®µ
  createBy   String   @map("create_by") @db.VarChar(64)
  createTime DateTime @default(now()) @map("create_time")
  updateBy   String?  @map("update_by") @db.VarChar(64)
  updateTime DateTime @updatedAt @map("update_time")

  // å…³è”
  userCoupons MktUserCoupon[]

  @@index([tenantId, status])
  @@index([tenantId, type])
  @@map("mkt_coupon_template")
}

/// ç”¨æˆ·ä¼˜æƒ åˆ¸è¡¨
model MktUserCoupon {
  id         String @id @default(uuid())
  tenantId   String @map("tenant_id") @db.VarChar(20)
  memberId   String @map("member_id")
  templateId String @map("template_id")

  // ä¼˜æƒ åˆ¸ä¿¡æ¯å¿«ç…§ï¼ˆé˜²æ­¢æ¨¡æ¿ä¿®æ”¹å½±å“å·²å‘æ”¾çš„åˆ¸ï¼‰
  couponName        String     @map("coupon_name") @db.VarChar(100)
  couponType        CouponType @map("coupon_type")
  discountAmount    Decimal?   @map("discount_amount") @db.Decimal(10, 2)
  discountPercent   Int?       @map("discount_percent")
  maxDiscountAmount Decimal?   @map("max_discount_amount") @db.Decimal(10, 2)
  minOrderAmount    Decimal    @map("min_order_amount") @db.Decimal(10, 2)

  // æœ‰æ•ˆæœŸ
  startTime DateTime @map("start_time")
  endTime   DateTime @map("end_time")

  // çŠ¶æ€
  status UserCouponStatus @default(UNUSED)

  // å‘æ”¾ä¿¡æ¯
  distributionType   CouponDistributionType @map("distribution_type")
  distributionSource String?                @map("distribution_source") @db.VarChar(100) // å‘æ”¾æ¥æºæè¿°

  // ä½¿ç”¨ä¿¡æ¯
  usedTime DateTime? @map("used_time")
  orderId  String?   @map("order_id")

  // å®¡è®¡å­—æ®µ
  receiveTime DateTime @default(now()) @map("receive_time")

  // å…³è”
  template     MktCouponTemplate  @relation(fields: [templateId], references: [id])
  usageRecords MktCouponUsage[]

  @@index([tenantId, memberId, status])
  @@index([templateId])
  @@index([orderId])
  @@map("mkt_user_coupon")
}

/// ä¼˜æƒ åˆ¸ä½¿ç”¨è®°å½•è¡¨
model MktCouponUsage {
  id           String @id @default(uuid())
  tenantId     String @map("tenant_id") @db.VarChar(20)
  userCouponId String @map("user_coupon_id")
  memberId     String @map("member_id")
  orderId      String @map("order_id")

  // ä½¿ç”¨ä¿¡æ¯
  discountAmount Decimal @map("discount_amount") @db.Decimal(10, 2)
  orderAmount    Decimal @map("order_amount") @db.Decimal(10, 2)

  // å®¡è®¡å­—æ®µ
  usedTime DateTime @default(now()) @map("used_time")

  // å…³è”
  userCoupon MktUserCoupon @relation(fields: [userCouponId], references: [id])

  @@index([tenantId, memberId])
  @@index([orderId])
  @@index([userCouponId])
  @@map("mkt_coupon_usage")
}

/// ç§¯åˆ†è§„åˆ™é…ç½®è¡¨
model MktPointsRule {
  id       String @id @default(uuid())
  tenantId String @unique @map("tenant_id") @db.VarChar(20)

  // æ¶ˆè´¹ç§¯åˆ†è§„åˆ™
  orderPointsEnabled Boolean @default(true) @map("order_points_enabled")
  orderPointsRatio   Decimal @default(1) @map("order_points_ratio") @db.Decimal(10, 2) // æ¯æ¶ˆè´¹Nå…ƒè·å¾—Mç§¯åˆ†
  orderPointsBase    Decimal @default(1) @map("order_points_base") @db.Decimal(10, 2) // Nå…ƒ

  // ç­¾åˆ°ç§¯åˆ†è§„åˆ™
  signinPointsEnabled Boolean @default(true) @map("signin_points_enabled")
  signinPointsAmount  Int     @default(10) @map("signin_points_amount")

  // ç§¯åˆ†æœ‰æ•ˆæœŸ
  pointsValidityEnabled Boolean @default(false) @map("points_validity_enabled")
  pointsValidityDays    Int?    @map("points_validity_days") // ç§¯åˆ†æœ‰æ•ˆå¤©æ•°ï¼Œnullè¡¨ç¤ºæ°¸ä¹…æœ‰æ•ˆ

  // ç§¯åˆ†æŠµæ‰£è§„åˆ™
  pointsRedemptionEnabled Boolean @default(true) @map("points_redemption_enabled")
  pointsRedemptionRatio   Decimal @default(100) @map("points_redemption_ratio") @db.Decimal(10, 2) // æ¯Nç§¯åˆ†å¯æŠµæ‰£Må…ƒ
  pointsRedemptionBase    Decimal @default(1) @map("points_redemption_base") @db.Decimal(10, 2) // Må…ƒ

  // ç§¯åˆ†æŠµæ‰£é™åˆ¶
  maxPointsPerOrder       Int? @map("max_points_per_order") // å•ç¬”è®¢å•æœ€å¤šå¯ä½¿ç”¨ç§¯åˆ†æ•°é‡
  maxDiscountPercentOrder Int? @map("max_discount_percent_order") // å•ç¬”è®¢å•æœ€å¤šå¯æŠµæ‰£ç™¾åˆ†æ¯”(1-100)

  // ç³»ç»Ÿå¼€å…³
  systemEnabled Boolean @default(true) @map("system_enabled")

  // å®¡è®¡å­—æ®µ
  createBy   String   @map("create_by") @db.VarChar(64)
  createTime DateTime @default(now()) @map("create_time")
  updateBy   String?  @map("update_by") @db.VarChar(64)
  updateTime DateTime @updatedAt @map("update_time")

  @@map("mkt_points_rule")
}

/// ç§¯åˆ†è´¦æˆ·è¡¨
model MktPointsAccount {
  id       String @id @default(uuid())
  tenantId String @map("tenant_id") @db.VarChar(20)
  memberId String @map("member_id")

  // ç§¯åˆ†ä½™é¢
  totalPoints     Int @default(0) @map("total_points") // æ€»ç§¯åˆ†ï¼ˆç´¯è®¡è·å¾—ï¼‰
  availablePoints Int @default(0) @map("available_points") // å¯ç”¨ç§¯åˆ†
  frozenPoints    Int @default(0) @map("frozen_points") // å†»ç»“ç§¯åˆ†
  usedPoints      Int @default(0) @map("used_points") // å·²ä½¿ç”¨ç§¯åˆ†
  expiredPoints   Int @default(0) @map("expired_points") // å·²è¿‡æœŸç§¯åˆ†

  // ä¹è§‚é”
  version Int @default(0)

  // å®¡è®¡å­—æ®µ
  createTime DateTime @default(now()) @map("create_time")
  updateTime DateTime @updatedAt @map("update_time")

  // å…³è”
  transactions MktPointsTransaction[]

  @@unique([tenantId, memberId])
  @@index([tenantId, availablePoints])
  @@map("mkt_points_account")
}

/// ç§¯åˆ†äº¤æ˜“è®°å½•è¡¨
model MktPointsTransaction {
  id        String @id @default(uuid())
  tenantId  String @map("tenant_id") @db.VarChar(20)
  accountId String @map("account_id")
  memberId  String @map("member_id")

  // äº¤æ˜“ä¿¡æ¯
  type          PointsTransactionType
  amount        Int // ç§¯åˆ†å˜åŠ¨æ•°é‡ï¼ˆæ­£æ•°ä¸ºå¢åŠ ï¼Œè´Ÿæ•°ä¸ºå‡å°‘ï¼‰
  balanceBefore Int                   @map("balance_before") // äº¤æ˜“å‰ä½™é¢
  balanceAfter  Int                   @map("balance_after") // äº¤æ˜“åä½™é¢

  // å…³è”ä¿¡æ¯
  relatedId   String? @map("related_id") // å…³è”ä¸šåŠ¡IDï¼ˆè®¢å•IDã€ä»»åŠ¡IDç­‰ï¼‰
  relatedType String? @map("related_type") @db.VarChar(50) // å…³è”ä¸šåŠ¡ç±»å‹

  // æœ‰æ•ˆæœŸï¼ˆç”¨äºè¿‡æœŸæ‰£å‡ï¼‰
  expireTime DateTime? @map("expire_time")

  // çŠ¶æ€
  status PointsTransactionStatus @default(COMPLETED)

  // å¤‡æ³¨
  remark String? @db.VarChar(500)

  // å®¡è®¡å­—æ®µ
  createTime DateTime @default(now()) @map("create_time")

  // å…³è”
  account MktPointsAccount @relation(fields: [accountId], references: [id])

  @@index([tenantId, memberId, createTime])
  @@index([accountId, type])
  @@index([relatedId])
  @@index([expireTime])
  @@map("mkt_points_transaction")
}

/// ç§¯åˆ†ä»»åŠ¡é…ç½®è¡¨
model MktPointsTask {
  id       String @id @default(uuid())
  tenantId String @map("tenant_id") @db.VarChar(20)

  // ä»»åŠ¡ä¿¡æ¯
  taskKey         String  @map("task_key") @db.VarChar(50) // ä»»åŠ¡å”¯ä¸€æ ‡è¯†ï¼ˆå¦‚ï¼šCOMPLETE_PROFILEï¼‰
  taskName        String  @map("task_name") @db.VarChar(100)
  taskDescription String? @map("task_description") @db.VarChar(500)

  // ç§¯åˆ†å¥–åŠ±
  pointsReward Int @map("points_reward")

  // å®Œæˆæ¡ä»¶
  completionCondition Json @map("completion_condition") // å®Œæˆæ¡ä»¶é…ç½®ï¼ˆJSONæ ¼å¼ï¼‰

  // é™åˆ¶
  isRepeatable   Boolean @default(false) @map("is_repeatable") // æ˜¯å¦å¯é‡å¤å®Œæˆ
  maxCompletions Int?    @map("max_completions") // æœ€å¤šå®Œæˆæ¬¡æ•°

  // çŠ¶æ€
  isEnabled Boolean @default(true) @map("is_enabled")

  // å®¡è®¡å­—æ®µ
  createBy   String   @map("create_by") @db.VarChar(64)
  createTime DateTime @default(now()) @map("create_time")
  updateBy   String?  @map("update_by") @db.VarChar(64)
  updateTime DateTime @updatedAt @map("update_time")

  @@unique([tenantId, taskKey])
  @@index([tenantId, isEnabled])
  @@map("mkt_points_task")
}

/// ç”¨æˆ·ä»»åŠ¡å®Œæˆè®°å½•è¡¨
model MktUserTaskCompletion {
  id       String @id @default(uuid())
  tenantId String @map("tenant_id") @db.VarChar(20)
  memberId String @map("member_id")
  taskId   String @map("task_id")

  // å®Œæˆä¿¡æ¯
  completionTime DateTime @default(now()) @map("completion_time")
  pointsAwarded  Int      @map("points_awarded")
  transactionId  String   @map("transaction_id") // å…³è”çš„ç§¯åˆ†äº¤æ˜“è®°å½•ID

  @@index([tenantId, memberId, taskId])
  @@map("mkt_user_task_completion")
}

/// ç§¯åˆ†å‘æ”¾å¤±è´¥è®°å½•è¡¨
model MktPointsGrantFailure {
  id       String @id @default(uuid())
  memberId String @map("member_id")

  // ç§¯åˆ†ä¿¡æ¯
  amount     Int                   @map("amount")
  type       PointsTransactionType @map("type")
  relatedId  String?               @map("related_id")
  remark     String?               @db.VarChar(500)
  expireTime DateTime?             @map("expire_time")

  // å¤±è´¥ä¿¡æ¯
  failureReason    String   @map("failure_reason") @db.VarChar(500)
  failureTime      DateTime @map("failure_time")
  retryCount       Int      @default(0) @map("retry_count")
  lastRetryTime    DateTime? @map("last_retry_time")
  lastErrorMessage String?  @map("last_error_message") @db.VarChar(1000)

  // çŠ¶æ€: PENDING-å¾…é‡è¯•, COMPLETED-å·²å®Œæˆ, FAILED-æœ€ç»ˆå¤±è´¥
  status String @default("PENDING") @db.VarChar(20)

  // å®¡è®¡å­—æ®µ
  createTime DateTime @default(now()) @map("create_time")
  updateTime DateTime @updatedAt @map("update_time")

  @@index([memberId, status])
  @@index([relatedId])
  @@index([failureTime])
  @@map("mkt_points_grant_failure")
}
