# PMS Brand 品牌管理模块

该模块负责管理商品的**品牌信息**，提供标准的品牌目录，主要用于实物商品的业务场景。

## 📂 文件树与功能简述

```text
brand/
├── dto/                # 数据传输对象：定义品牌创建、更新及查询的分页/校验规则
├── vo/                 # 视图对象：定义返回前端的品牌数据结构
├── brand.controller.ts # 控制器：对外暴露品牌的 CRUD 接口
├── brand.repository.ts # 仓储层：封装 PmsBrand 表的底层查询与引用检查逻辑
├── brand.service.ts    # 服务层：核心业务逻辑（包含删除引用校验、事务管理）
└── brand.module.ts     # 模块配置：依赖注入与对外导出
```

---

## 🗄️ 数据库表与逻辑关联

模块核心涉及 **Prisma** 定义的 `PmsBrand` 表及其与商品库的关联：

1.  **PmsBrand (品牌表)**：
    *   存储品牌的核心元数据，包括 `name`（品牌名）和 `logo`（品牌图标）。
    *   作为实物商品（SPU）的重要筛选和属性维度。
2.  **逻辑关联链**：
    *   **商品引用**：`PmsBrand` -> `PmsProduct`。商品实体通过 `brandId` 关联品牌。
    *   **删除约束**：品牌属于系统级元数据。在删除前，必须通过 `isUsedByProducts` 逻辑检查 `PmsProduct` 中是否存在关联引用。

---

## 🛠️ 核心接口作用

| 接口名称 | 技术关键词 | 业务闭环描述 |
| :--- | :--- | :--- |
| **findAll** | 分页助手 / 模糊搜索 | **商品录入闭环**。为后台商品编辑提供可搜索的分页列表，确保录入时能快速定位品牌。 |
| **create/update** | `@Transactional` | **元数据管理闭环**。实现品牌信息的事务化入库与修改，保证基础档案的一致性。 |
| **remove** | 引用前置校验 | **数据安全闭环**。强制检查商品库是否引用当前品牌，防止删除导致的历史订单或商品数据展示异常。 |
| **findOne** | 精确查找 | **详情展示闭环**。根据品牌 ID 获取完整信息，用于品牌墙或后台编辑回显。 |

---

## 💡 核心逻辑亮点

*   **Repository 模式封装**：继承 `BaseRepository`，通过标准化的仓储模式减少重复查询逻辑，保持代码整洁。
*   **强解耦引用检查**：删除逻辑中加入显式的 count 校验，不仅在数据库层面保证一致性，更从业务代码层面提供了清晰的异常提示（BusinessException）。
