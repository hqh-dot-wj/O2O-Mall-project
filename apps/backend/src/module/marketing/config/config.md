# Marketing Config 营销商品配置模块

## 📂 文件树与功能简述
```text
config/
├── dto/
│   └── config.dto.ts      # 数据传输对象 (参数验证与类型定义)
├── vo/
│   └── config.vo.ts       # 视图对象 (前端展示模型)
├── config.controller.ts   # 控制器 (定义配置 CRUD、上下架、状态流转接口)
├── config.module.ts       # 模块配置 (管理依赖注入与策略工厂关联)
├── config.repository.ts   # 仓储层 (持久化操作，支持租户隔离与软删除)
├── config.service.ts      # 业务逻辑 (核心校验、库存策略自动判定、数据增强组装)
└── config.md              # 模块文档
```
- **核心定位**：营销系统的“控制面板”，负责将具体的**营销玩法模板**（如拼团、砍价）应用到**基础商品/SKU**上。

## 🗄️ 数据库表与逻辑关联
该模块协同多个核心表完成配置管理：
- **`StorePlayConfig` (门店营销配置表)**: 
    - **逻辑核心**: 存储营销实例的静态配置，包括规则 JSON (`rules`)、状态 (`status`)。
    - **多维关联**: 
        - 关联 `PlayTemplate`: 决定使用的营销算法逻辑。
        - 关联 `PmsProduct / PmsGlobalSku`: 绑定具体销售的基础商品。
        - 关联 `SysStore`: 标识配置所属的门店空间。
- **库存策略逻辑**: 
    - 系统自动判定：**实物商品** (`REAL`) 采用 `STRONG_LOCK` (强互斥锁库存)；**虚拟服务** (`VIRTUAL`) 采用 `LAZY_CHECK` (弱互斥延迟校验)。

## ⚙️ 核心接口作用
| 接口 | 技术关键词 | 业务闭环能力 |
| :--- | :--- | :--- |
| **查询列表** | `MemoryJoin`, `N+1 Fix` | 批量组装商品库信息（名称、主图、上下架状态），实现跨模块数据的高效聚合展示。 |
| **查询详情** | `StrategyFactory`, `DisplayData` | 联动策略工厂动态计算玩法特有的展示增强数据（如渲染规则预览）。 |
| **创建配置** | `@Transactional`, `TemplateInlet` | 包含模板有效性预检、商品存在性校验及库存模式的自动强制覆盖。 |
| **快捷上下架** | `StatusSwitch` | 实现营销商品在 C 端的小程序可见性精准控制。 |

---
*注：本模块负责“静态配置”，实际参与活动时的动态实例（如具体的团、订单）由 `marketing/play` 模块处理。*
