è¿™æ˜¯ä¸€ä¸ªéå¸¸é«˜é˜¶çš„ **â€œæµé‡å˜ç° vs æˆæœ¬å½’å±â€** çš„åšå¼ˆé—®é¢˜ã€‚

ä½ æå‡ºçš„â€œè·¨åº—åˆ†é”€å¼€å…³â€æ˜¯ä¸€ä¸ªéå¸¸æ£’çš„åˆ‡å…¥ç‚¹ï¼Œä½†å®ƒåªæ˜¯å†°å±±ä¸€è§’ã€‚åœ¨ S2B2b2C æ¶æ„ä¸­ï¼Œå¤„ç†â€œAåº—çš„äººæŠŠå®¢æˆ·æ‹‰åˆ°äº†Båº—æ¶ˆè´¹â€è¿™ä¸ªé—®é¢˜ï¼Œæ¶‰åŠåˆ° **åˆ©ç›Šé‡æ–°åˆ†é…**ã€‚

ä½œä¸ºæ¶æ„å¸ˆï¼Œæˆ‘ä¸ºä½ æä¾› **ä¸‰ç§ä¸»æµè§£å†³æ–¹æ¡ˆ**ï¼Œå¹¶æ·±åº¦å‰–æå…¶æ³¨å†Œé€»è¾‘ã€èµ„é‡‘æµå‘å’Œæ½œåœ¨é£é™©ã€‚

---

### ğŸ•µï¸ æ ¸å¿ƒçŸ›ç›¾åˆ†æ

* **æ¨èäºº (User B)**ï¼šå½’å± **é›¨èŠ±åº— (Tenant Y)**ã€‚ä»–ä»˜å‡ºäº†åŠ³åŠ¨æ‹‰æ–°ã€‚
* **æ–°ç”¨æˆ· (User A)**ï¼šä½åœ¨ **å¤©å¿ƒåº— (Tenant X)** é™„è¿‘ï¼Œå¹¶åœ¨å¤©å¿ƒåº—æ³¨å†Œ/ä¸‹å•ã€‚
* **çŸ›ç›¾ç‚¹**ï¼š
  * **æ”¶ç›Š**ï¼šå¤©å¿ƒåº—èµšäº†è®¢å•é’±ã€‚
  * **æˆæœ¬**ï¼šè°å‡ºä½£é‡‘ï¼Ÿå¤©å¿ƒåº—æ„¿æ„ç»™ä¸€ä¸ªâ€œå¤–äººï¼ˆé›¨èŠ±åº—çš„äººï¼‰â€å‘é’±å—ï¼Ÿ

---

### ğŸš€ æ–¹æ¡ˆä¸€ï¼šç”»åœ°ä¸ºç‰¢æ¨¡å¼ (Local Protection) â€”â€” **é»˜è®¤æ¨è**

**é€»è¾‘**ï¼š**äº²å…„å¼Ÿæ˜ç®—è´¦ï¼Œè·¨åº—ä¸è®¤äººã€‚**

* **è§„åˆ™**ï¼šåˆ†é”€å…³ç³»ä»…åœ¨ **â€œå½’å±ç§Ÿæˆ·â€** å†…æœ‰æ•ˆã€‚
* **æ³¨å†Œæµç¨‹**ï¼š
  1. User B (é›¨èŠ±åº—) åˆ†äº«é“¾æ¥ç»™ User Aã€‚
  2. User A ç‚¹å‡»é“¾æ¥ï¼Œæ ¹æ® LBS å®šä½åˆ° **å¤©å¿ƒåº—**ã€‚
  3. **åˆ¤å®š**ï¼šç³»ç»Ÿå‘ç° User B æ˜¯é›¨èŠ±åº—çš„ï¼Œè€Œå½“å‰ User A æ­£åœ¨æ³¨å†Œè¿›å¤©å¿ƒåº—ã€‚
  4. **å¤„ç†**ï¼š**æ–©æ–­å…³ç³»**ã€‚User A æ³¨å†Œä¸ºå¤©å¿ƒåº—çš„â€œè‡ªç„¶æµé‡ç”¨æˆ·â€ï¼ˆæ— ä¸Šçº§ï¼‰ï¼Œæˆ–è€…å½’å±åˆ°å¤©å¿ƒåº—çš„â€œé»˜è®¤åº—é•¿å·â€ä¸‹ã€‚
* **èµ„é‡‘æµ**ï¼šå¤©å¿ƒåº—ç‹¬ååˆ©æ¶¦ï¼ŒUser B ä¸€åˆ†é’±æ‹¿ä¸åˆ°ã€‚
* **ä¼˜ç‚¹**ï¼šè´¢åŠ¡æåº¦ç®€å•ï¼Œé—¨åº—ä¹‹é—´æ— çº çº·ã€‚
* **ç¼ºç‚¹**ï¼šä¸¥é‡æ‰“å‡»åˆ†é”€å‘˜ç§¯ææ€§ï¼ˆæˆ‘æ‹‰äº†äººï¼Œå› ä¸ºä»–ä½å¾—è¿œæˆ‘å°±æ²¡é’±ï¼Ÿï¼‰ã€‚

---

### ğŸš€ æ–¹æ¡ˆäºŒï¼šæµé‡é‡‡è´­æ¨¡å¼ (Traffic Buying) â€”â€” **ä½ çš„â€œå¼€å…³â€æ–¹æ¡ˆ**

**é€»è¾‘**ï¼š**å¤©å¿ƒåº—æŠŠä½£é‡‘è§†ä¸ºâ€œå¹¿å‘Šè´¹â€ï¼Œä»˜è´¹è´­ä¹°é›¨èŠ±åº—çš„æµé‡ã€‚**

* **é…ç½®**ï¼šåœ¨ `SysDistributionConfig` è¡¨ä¸­å¢åŠ å¼€å…³ `enableCrossTenant: boolean`ã€‚
* **æ³¨å†Œæµç¨‹**ï¼š
  1. User B (é›¨èŠ±åº—) åˆ†äº«é“¾æ¥ã€‚
  2. User A åœ¨å¤©å¿ƒåº—æ³¨å†Œã€‚
  3. **åˆ¤å®š**ï¼š
     * å¤©å¿ƒåº—å¼€å…³ **OFF**ï¼šæ–©æ–­å…³ç³»ï¼ˆåŒæ–¹æ¡ˆä¸€ï¼‰ã€‚
     * å¤©å¿ƒåº—å¼€å…³ **ON**ï¼š**å»ºç«‹è·¨ç§Ÿæˆ·ç»‘å®š**ã€‚User A çš„ `referrerId` æŒ‡å‘ User Bã€‚
* **èµ„é‡‘æµ**ï¼š
  * User A åœ¨å¤©å¿ƒåº—æ¶ˆè´¹ 100 å…ƒã€‚
  * å¤©å¿ƒåº—æ”¯å‡º 10 å…ƒä½£é‡‘ã€‚
  * èµ„é‡‘ä» **å¤©å¿ƒåº—è´¦æˆ·** æµå‘ **User B çš„é’±åŒ…**ã€‚
* **ä¼˜ç‚¹**ï¼šå®ç°å…¨ç½‘è£‚å˜ï¼Œæµé‡æœ€å¤§åŒ–ã€‚
* **ç¼ºç‚¹**ï¼šå¤©å¿ƒåº—è€æ¿å¯èƒ½ä¼šè§‰å¾—â€œé’±è¢«å¤–äººèµšäº†â€è€Œä¸çˆ½ã€‚

---

### ğŸš€ æ–¹æ¡ˆä¸‰ï¼šå½±å­èº«ä»½æ¨¡å¼ (Shadow Identity) â€”â€” **æœ€çµæ´»çš„æŠ˜ä¸­æ–¹æ¡ˆ**

**é€»è¾‘**ï¼š**å…¥ä¹¡éšä¿—ã€‚User B åœ¨å¤©å¿ƒåº—ç”Ÿæˆä¸€ä¸ªâ€œä¸´æ—¶å·¥â€èº«ä»½ã€‚**

* **æ³¨å†Œæµç¨‹**ï¼š
  1. User B (é›¨èŠ±åº—) æ‹‰æ¥äº† User A (å¤©å¿ƒåº—)ã€‚
  2. ç³»ç»Ÿæ£€æµ‹åˆ°è·¨ç§Ÿæˆ·ã€‚
  3. **è‡ªåŠ¨æ“ä½œ**ï¼šç³»ç»Ÿåœ¨ `Member` è¡¨ä¸­ï¼Œä¸º User B åˆ›å»ºä¸€ä¸ªå½’å±äº å¤©å¿ƒåº— çš„å½±å­è´¦å·ï¼ˆæˆ–è€…åœ¨ä¸­é—´è¡¨è®°å½• User B åœ¨å¤©å¿ƒåº—çš„åˆ†é”€èµ„æ ¼ï¼‰ã€‚
  4. User A ç»‘å®šè¿™ä¸ªâ€œå¤©å¿ƒç‰ˆ User Bâ€ã€‚
* **èµ„é‡‘æµ**ï¼š
  * ä½£é‡‘è¿›å…¥ User B åœ¨å¤©å¿ƒåº—çš„ **â€œå½±å­é’±åŒ…â€**ã€‚
  * User B çœ‹åˆ°è‡ªå·±æœ‰ä¸¤ä¸ªé’±åŒ…ï¼šé›¨èŠ±åº—èµšäº† 500ï¼Œå¤©å¿ƒåº—èµšäº† 20ã€‚
* **ä¼˜ç‚¹**ï¼šè´¢åŠ¡éš”ç¦»æœ€å½»åº•ï¼Œå¤©å¿ƒåº—è€æ¿æ„Ÿè§‰æ˜¯â€œè‡ªå·±åº—é‡Œçš„ä¸´æ—¶å·¥â€èµšäº†é’±ï¼Œå¿ƒç†æ›´å®¹æ˜“æ¥å—ã€‚

---

### ğŸ› ï¸ æ·±åº¦æ‰©å±•ï¼šé£é™©ä¸è¾¹ç•Œæƒ…å†µ (Risk & Edge Cases)

ä½ æåˆ°çš„â€œè€ƒè™‘ä¸å…¨é¢â€ï¼Œé€šå¸¸å‡ºåœ¨ä»¥ä¸‹ 5 ç§æç«¯æƒ…å†µï¼š

#### 1. ä½£é‡‘å€’æŒ‚é£é™© (The Margin Risk)

* **åœºæ™¯**ï¼š
  * é›¨èŠ±åº—ï¼ˆæ¨èäººæ‰€åœ¨åº—ï¼‰åˆ©æ¶¦é«˜ï¼Œè®¾ç½®åˆ†ä½£ **20%**ã€‚
  * å¤©å¿ƒåº—ï¼ˆä¸‹å•åº—ï¼‰æ˜¯ä½ä»·åº—ï¼Œåˆ©æ¶¦è–„ï¼Œè®¾ç½®åˆ†ä½£ **5%**ã€‚
* **å†²çª**ï¼šUser B ä¹ æƒ¯äº†æ‹¿ 20%ï¼Œç»“æœæ‹‰äººå»å¤©å¿ƒåº—åªæ‹¿åˆ° 5%ï¼Œä»–ä¼šæŠ•è¯‰å¹³å°â€œåé’±â€ã€‚
* **è§£å†³**ï¼šå‰ç«¯å¿…é¡»æ˜ç¡®æç¤ºï¼š*â€œå½“å‰ä¸‹å•é—¨åº—ä¸º[å¤©å¿ƒåº—]ï¼Œé¢„è®¡ä½£é‡‘æŒ‰ç…§è¯¥åº—æ ‡å‡†æ‰§è¡Œï¼ˆ5%ï¼‰â€*ã€‚**åŸåˆ™ï¼šè°å‡ºé’±ï¼ŒæŒ‰è°çš„è§„åˆ™åŠã€‚**

#### 2. â€œå†…å¥¸â€åˆ‡é‡é£é™© (The Spy Risk)

* **åœºæ™¯**ï¼š
  * å¤©å¿ƒåº—å¼€å¯äº†â€œå…è®¸è·¨åº—åˆ†é”€â€ã€‚
  * éš”å£é›¨èŠ±åº—è€æ¿æ´¾äº† 100 ä¸ªå‘˜å·¥ï¼Œä¸“é—¨å»å¤©å¿ƒåº—é—¨å£æ‹‰å®¢ï¼Œè®©å®¢æˆ·æ‰«é›¨èŠ±åº—å‘˜å·¥çš„ç ï¼Œä½†åœ¨å¤©å¿ƒåº—ä¸‹å•ã€‚
  * **ç»“æœ**ï¼šå¤©å¿ƒåº—çš„åˆ©æ¶¦è¢«é›¨èŠ±åº—å‘˜å·¥å¤§é‡å¸èµ°ã€‚
* **è§£å†³**ï¼š
  * åå°å¢åŠ  **â€œé»‘åå•æœºåˆ¶â€**ï¼šå¤©å¿ƒåº—å¯ä»¥æŠŠç‰¹å®šçš„ User IDï¼ˆç«å¯¹å‘˜å·¥ï¼‰æ‹‰é»‘ï¼Œä¸ç»™ä»–ä»¬å‘ä½£é‡‘ã€‚
  * å¢åŠ  **â€œè·¨åº—ä½£é‡‘ä¸Šé™â€**ï¼šè·¨åº—åˆ†é”€æœ€é«˜åªèƒ½æ‹¿ 3%ï¼Œä¿æŠ¤æœ¬åº—åˆ©æ¶¦ã€‚

#### 3. å¾ªç¯ç»‘å®šæ­»é” (Infinite Loop)

* **åœºæ™¯**ï¼š
  * å¼ ä¸‰ï¼ˆå¤©å¿ƒï¼‰æ¨èäº† æå››ï¼ˆé›¨èŠ±ï¼‰ã€‚
  * æå››ï¼ˆé›¨èŠ±ï¼‰æ¨èäº† ç‹äº”ï¼ˆå¤©å¿ƒï¼‰ã€‚
  * ç‹äº”ï¼ˆå¤©å¿ƒï¼‰åˆæ¨èäº† å¼ ä¸‰ï¼ˆå¤©å¿ƒï¼‰ã€‚
* **é£é™©**ï¼šè®¡ç®—é—´æ¥ä½£é‡‘ï¼ˆäºŒçº§åˆ†é”€ï¼‰æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°æ— é™é€’å½’ï¼Œå¯¼è‡´æœåŠ¡å™¨å´©æºƒã€‚
* **è§£å†³**ï¼šåç«¯åˆ†é”€ç®—æ³•å¿…é¡»æœ‰ **â€œæœ€å¤§æ·±åº¦é™åˆ¶â€**ï¼ˆMax Depth = 2ï¼‰ï¼Œä¸”æ£€æµ‹åˆ°é—­ç¯æ—¶è‡ªåŠ¨ç†”æ–­ã€‚

#### 4. æç°çš„èµ„é‡‘æ± éš”ç¦» (Fund Isolation)

* **åœºæ™¯**ï¼šUser B æ˜¯è·¨åº—ç‹‚é­”ï¼Œåœ¨ 10 ä¸ªåº—éƒ½èµšäº†é’±ã€‚
* **é£é™©**ï¼šUser B å‘èµ·æç° 1000 å…ƒã€‚è¿™ 1000 å…ƒé‡Œï¼Œå¤©å¿ƒåº—è¯¥å‡º 100ï¼Œé›¨èŠ±åº—è¯¥å‡º 900ã€‚å¦‚æœç›´æ¥ä»å¹³å°å¤§æ± å­å‡ºï¼Œä¼šå¯¼è‡´è´¦ç›®æ··ä¹±ã€‚
* **è§£å†³**ï¼š
  * **æ–¹æ¡ˆ Aï¼ˆç®€å•ï¼‰**ï¼šæç°æ—¶ç”±å¹³å°å«ä»˜ï¼Œæœˆåº•å¹³å°è·Ÿå„é—¨åº—ç»“ç®—ã€‚
  * **æ–¹æ¡ˆ Bï¼ˆå¤æ‚ä½†åˆè§„ï¼‰**ï¼šUser B å¿…é¡»**åˆ†åˆ«**å‘å¤©å¿ƒåº—å’Œé›¨èŠ±åº—å‘èµ·æç°ï¼ˆç±»ä¼¼å¤šå•†æˆ·ç”µå•†ï¼‰ï¼Œæˆ–è€…æç°æ—¶ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆå¤šç¬”æ‰“æ¬¾å•ã€‚

#### 5. è·¨åŒºåŸŸä»·æ ¼æ­§è§† (Price Discrimination)

* **åœºæ™¯**ï¼šåŒä¸€ä¸ªå•†å“ï¼Œå¤©å¿ƒåº—å– 100ï¼Œé›¨èŠ±åº—å– 120ã€‚
* **é£é™©**ï¼šUser B å‘ç°å¤©å¿ƒåº—ä¾¿å®œï¼Œäºæ˜¯ä¸“é—¨æŠŠé›¨èŠ±åº—çš„å®¢æˆ·å¼•å¯¼åˆ°å¤©å¿ƒåº—ä¸‹å•ï¼ˆä¸ºäº†æˆäº¤ç‡ï¼‰ï¼Œå¯¼è‡´é›¨èŠ±åº—å®¢æºæµå¤±ã€‚
* **è§£å†³**ï¼šè¿™æ˜¯å•†ä¸šç«äº‰ï¼Œç³»ç»Ÿå±‚é¢**ä¸åšå¹²é¢„**ï¼Œä½†å¯ä»¥ç»™é›¨èŠ±åº—è€æ¿æä¾›â€œæµå¤±é¢„è­¦æŠ¥è¡¨â€ã€‚

#### 6.æ³¨å†Œå½’å±æƒå†²çª (Registration Hijacking)

- **åœºæ™¯**ï¼šå°æ˜ä½åœ¨å¤©å¿ƒåŒºï¼Œæ‰«äº†é›¨èŠ±åŒºè€ç‹çš„ç æ³¨å†Œã€‚

- **é—®é¢˜**ï¼šå°æ˜è¿™ä¸ªç”¨æˆ·ï¼Œåˆ°åº•å½’è°ç®¡ï¼Ÿ

- **è§£å†³æ–¹æ¡ˆ**ï¼š
  
  - **æµé‡å½’å± (Referrer)**ï¼šæ°¸ä¹…å½’Â **è€ç‹**ã€‚
  
  - **æ•°æ®å½’å± (Tenant)**ï¼š**åŠ¨æ€å½’å±**ã€‚å°æ˜ä»Šå¤©åœ¨å¤©å¿ƒåº—ä¸‹å•ï¼Œæ•°æ®å½’å¤©å¿ƒåº—ï¼›æ˜å¤©å»é›¨èŠ±åº—ä¸‹å•ï¼Œæ•°æ®å½’é›¨èŠ±åº—ã€‚
  
  - æ³¨æ„ï¼šä¸è¦åœ¨Â UmsMemberÂ è¡¨é‡Œå¼ºè¡Œé”æ­»Â tenantIdï¼Œé‚£ä¸ªå­—æ®µåº”è¯¥è¡¨ç¤ºâ€œæ³¨å†Œæ¥æºâ€æˆ–â€œå¸¸é©»åœ°â€ï¼Œè€Œä¸åº”é™åˆ¶ä»–åªèƒ½å»é‚£å®¶åº—ã€‚

#### 7. æ•°æ®éšç§æ³„éœ² (Privacy Leak)

- **åœºæ™¯**ï¼šè€ç‹æ˜¯é›¨èŠ±åº—çš„äººã€‚å°æ˜åœ¨å¤©å¿ƒåº—ä¹°äº†â€œç§å¯†æŠ¤ç†æœåŠ¡â€ã€‚

- **é£é™©**ï¼šè€ç‹ä½œä¸ºæ¨èäººï¼Œåœ¨ä»–çš„ App é‡Œçœ‹åˆ°äº†åˆ†é”€æ˜ç»†ï¼šâ€œå°æ˜æ¶ˆè´¹äº† ç§å¯†æŠ¤ç†â€ã€‚è¿™æ³„éœ²äº†ç”¨æˆ·åœ¨å…¶ä»–åº—çš„éšç§ã€‚

- **è§£å†³æ–¹æ¡ˆ**ï¼š**è·¨åº—è„±æ•**ã€‚
  
  - å¦‚æœÂ isLocal === falseÂ (è·¨åº—è®¢å•)ã€‚
  
  - ç»™è€ç‹å‘ä½£é‡‘é€šçŸ¥æ—¶ï¼Œå•†å“åç§°æ˜¾ç¤ºä¸ºÂ **â€œè·¨åº—æ¶ˆè´¹è®¢å•â€**Â æˆ–Â **â€œå®¶æ”¿æœåŠ¡â€**ï¼Œ**éšè—å…·ä½“ SKU å’Œ é—¨åº—åç§°**ã€‚

#### 8. ä½£é‡‘æˆæœ¬å€’æŒ‚ (Negative Profit)

- **åœºæ™¯**ï¼šå¤©å¿ƒåº—æç‰¹ä»·ï¼Œåˆ©æ¶¦åªæœ‰ 3%ã€‚

- **é£é™©**ï¼šè·¨åº—é…ç½®é‡Œè®¾ç½®äº† 5% çš„ä½£é‡‘ã€‚å¤–äººæ¥ä¹°ï¼Œå¤©å¿ƒåº—åè€Œäº 2%ã€‚

- **è§£å†³æ–¹æ¡ˆ**ï¼š**ä¼˜å…ˆçº§é€»è¾‘**ã€‚
  
  - å•†å“ SKU ä¸Šçš„Â distModeÂ (æ˜¯å¦å‚ä¸åˆ†é”€) ä¼˜å…ˆçº§ > å…¨å±€é…ç½®ã€‚
  
  - åº—é•¿å¯ä»¥åœ¨ç‰¹ä»·å•†å“ä¸Šè®¾ç½®Â distMode = NONEã€‚
  
  - è¿™æ ·å³ä½¿å¼€äº†è·¨åº—å¼€å…³ï¼Œè¿™ä¸ªç‰¹ä»·å•†å“ä¹Ÿä¸åˆ†é’±ã€‚

#### 9. æ¶æ„åˆ·å•/æ´—é’± (Fraud)

- **åœºæ™¯**ï¼šè€ç‹å’Œå¤©å¿ƒåº—é•¿å‹¾ç»“ï¼ˆæˆ–è€…è€ç‹è‡ªå·±æ”»å‡»ï¼‰ï¼Œåˆ©ç”¨è·¨åº—è§„åˆ™æ´—é’±ã€‚

- **è§£å†³æ–¹æ¡ˆ**ï¼š**é£æ§é˜ˆå€¼**ã€‚
  
  - é™åˆ¶å•äººå•æ—¥è·¨åº—è·å–ä½£é‡‘ä¸Šé™ï¼ˆå¦‚ 500å…ƒï¼‰ã€‚
  
  - åŒä¸€ä¸ª IP / è®¾å¤‡å· é¢‘ç¹åˆ‡æ¢ç§Ÿæˆ·ä¸‹å•ï¼Œè§¦å‘æŠ¥è­¦ã€‚

#### 10. è·¨åŒºåŸŸé€€æ¬¾çš„æ­»è´¦

- **åœºæ™¯**ï¼šé’±å·²ç»åˆ†ç»™å¤–åº—çš„è€ç‹äº†ï¼Œè€ç‹æç°äº†ã€‚å¤©å¿ƒåº—è¿™è¾¹ç”¨æˆ·é€€æ¬¾äº†ã€‚

- **å›°éš¾**ï¼šå¤©å¿ƒåº—é•¿å¾ˆéš¾å»è¿½æ€é›¨èŠ±åº—çš„è€ç‹è¦é’±ã€‚

- **è§£å†³æ–¹æ¡ˆ**ï¼š**å¹³å°æ‹…ä¿æ‰£é™¤**ã€‚
  
  - åˆ†é”€ç³»ç»Ÿå¿…é¡»ç”±**å¹³å°ç»Ÿä¸€æ§ç›˜**ã€‚
  
  - å½“å‘ç”Ÿé€€æ¬¾æ—¶ï¼Œå¹³å°ç›´æ¥ä»è€ç‹çš„ä½™é¢é‡Œæ‰£æˆè´Ÿæ•°ã€‚å¦‚æœè€ç‹è·‘è·¯äº†ï¼Œè¿™å°±å˜æˆäº†å¹³å°çš„åè´¦ï¼ˆSaaS è¿è¥æˆæœ¬ï¼‰ï¼Œé€šå¸¸ç”±å¹³å°å…ˆèµ”ä»˜ç»™å¤©å¿ƒåº—ï¼Œå†å°æ€è€ç‹è´¦å·ã€‚---

### ğŸ—ï¸ åç«¯æ¶æ„å®ç°å»ºè®®

#### 1. æ•°æ®åº“å˜æ›´

**é—¨åº—é…ç½®è¡¨ (`SysDistributionConfig`) å¢åŠ å¼€å…³**ï¼š

```prisma
model SysDistributionConfig {
  // ... åŸæœ‰å­—æ®µ

  // [æ–°å¢] è·¨åº—ç­–ç•¥
  enableCrossTenant Boolean @default(false) @map("enable_cross_tenant") // æ˜¯å¦å…è®¸å¤–äººåˆ†æˆ‘çš„é’±

  // [æ–°å¢] è·¨åº—åˆ†ä½£æŠ˜æ‰£ (ä¾‹å¦‚ 0.8 è¡¨ç¤ºå¤–äººåªèƒ½æ‹¿ 80% çš„æ ‡å‡†ä½£é‡‘)
  crossTenantRate   Decimal @default(1.00) @map("cross_tenant_rate") 
}
```

**åˆ†é”€å…³ç³»è¡¨ (`UmsMember` æˆ– æ–°å¢ `DistributionRelation`)**ï¼š
å»ºè®®æŠŠåˆ†é”€å…³ç³»ç‹¬ç«‹å‡ºæ¥ï¼Œå› ä¸ºå…³ç³»å¯èƒ½éšç§Ÿæˆ·å˜åŒ–ã€‚

```prisma
// [å»ºè®®æ–°å¢] åˆ†é”€ç»‘å®šå…³ç³»è¡¨
// è§£å†³ï¼šå¼ ä¸‰åœ¨å¤©å¿ƒåº—çš„ä¸Šçº§æ˜¯æå››ï¼Œåœ¨é›¨èŠ±åº—çš„ä¸Šçº§æ˜¯ç‹äº”
model MktDistributionRelation {
  id         Int     @id @default(autoincrement())
  tenantId   String  @map("tenant_id") // å…³ç³»å½’å±å“ªä¸ªåº—

  memberId   String  @map("member_id") // ä¸‹çº¿
  referrerId String  @map("referrer_id") // ä¸Šçº¿

  createTime DateTime @default(now())

  @@unique([tenantId, memberId]) // ä¸€ä¸ªç”¨æˆ·åœ¨ä¸€ä¸ªåº—åªèƒ½æœ‰ä¸€ä¸ªä¸Šçº¿
  @@map("mkt_dist_relation")
}
```

#### 2. æ³¨å†Œç»‘å®šé€»è¾‘ (ä¼ªä»£ç )

```typescript
async bindReferrer(currentTenantId: string, memberId: string, referrerId: string) {
  // 1. æŸ¥æ¨èäººçš„å½’å±ç§Ÿæˆ·
  const referrer = await prisma.umsMember.findUnique({ where: { memberId: referrerId } });

  // 2. æŸ¥å½“å‰é—¨åº—çš„é…ç½®
  const config = await prisma.sysDistributionConfig.findUnique({ where: { tenantId: currentTenantId } });

  // 3. åˆ¤å®šé€»è¾‘
  if (referrer.tenantId !== currentTenantId) {
    // --- è·¨åº—åœºæ™¯ ---
    if (!config.enableCrossTenant) {
      console.log("è¯¥åº—ç¦æ­¢è·¨åº—åˆ†é”€ï¼Œç»‘å®šå¤±è´¥ï¼Œè§†ä¸ºè‡ªç„¶æµé‡");
      return; 
    }
    // å…è®¸è·¨åº—ï¼Œç»§ç»­æ‰§è¡Œç»‘å®š...
  }

  // 4. å†™å…¥å…³ç³»è¡¨
  await prisma.mktDistributionRelation.create({
    data: {
      tenantId: currentTenantId,
      memberId: memberId,
      referrerId: referrerId
    }
  });
}
```

### æ€»ç»“

å¯¹äºä½ çš„é¡¹ç›®ï¼Œæˆ‘å¼ºçƒˆå»ºè®®é‡‡ç”¨ **æ–¹æ¡ˆäºŒï¼ˆæµé‡é‡‡è´­æ¨¡å¼ - å¼€å…³æ§åˆ¶ï¼‰** + **ç‹¬ç«‹å…³ç³»è¡¨** çš„ç»„åˆã€‚

* **çµæ´»**ï¼šåº—é•¿è‡ªå·±å†³å®šå¼€ä¸å¼€ã€‚
* **å¢åŠ **ï¼šÂ **â€œè·¨åº—å¼€å…³â€**Â å’ŒÂ **â€œç‹¬ç«‹æ¯”ä¾‹â€**Â æ˜¯ä¸€ä¸ªæä½³çš„æ–¹æ¡ˆ
* **æ¸…æ™°**ï¼šå…³ç³»ç»‘å®šåœ¨å…·ä½“çš„ `Tenant` ä¸‹ï¼ˆUser A åœ¨å¤©å¿ƒåº—æ˜¯ User B çš„ä¸‹çº¿ï¼Œåœ¨é›¨èŠ±åº—å¯ä»¥æ˜¯ User C çš„ä¸‹çº¿ï¼‰ï¼Œè¿™æ ·äº’ä¸å¹²æ‰°ï¼Œé€»è¾‘æœ€ä¸¥å¯†ã€‚


